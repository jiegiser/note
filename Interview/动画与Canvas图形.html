<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 requestAnimationFrame | 学习笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/note/assets/css/0.styles.5e98f1a2.css" as="style"><link rel="preload" href="/note/assets/js/app.63e6b075.js" as="script"><link rel="preload" href="/note/assets/js/2.00905bb4.js" as="script"><link rel="preload" href="/note/assets/js/15.d742ac3a.js" as="script"><link rel="preload" href="/note/assets/js/62.fad51c04.js" as="script"><link rel="prefetch" href="/note/assets/js/10.b17bf4da.js"><link rel="prefetch" href="/note/assets/js/100.77182575.js"><link rel="prefetch" href="/note/assets/js/101.919de1be.js"><link rel="prefetch" href="/note/assets/js/102.7eddf54d.js"><link rel="prefetch" href="/note/assets/js/103.6f755c44.js"><link rel="prefetch" href="/note/assets/js/104.e8e808a5.js"><link rel="prefetch" href="/note/assets/js/105.56c9b38e.js"><link rel="prefetch" href="/note/assets/js/106.dfa8003d.js"><link rel="prefetch" href="/note/assets/js/107.ab2b9376.js"><link rel="prefetch" href="/note/assets/js/108.80c4321e.js"><link rel="prefetch" href="/note/assets/js/109.1e8beca1.js"><link rel="prefetch" href="/note/assets/js/11.b3c62f7c.js"><link rel="prefetch" href="/note/assets/js/110.54090cac.js"><link rel="prefetch" href="/note/assets/js/111.849d57d5.js"><link rel="prefetch" href="/note/assets/js/112.956d52c9.js"><link rel="prefetch" href="/note/assets/js/113.1bd66522.js"><link rel="prefetch" href="/note/assets/js/114.5df0a704.js"><link rel="prefetch" href="/note/assets/js/115.ee872649.js"><link rel="prefetch" href="/note/assets/js/116.5957aa17.js"><link rel="prefetch" href="/note/assets/js/117.47a8757b.js"><link rel="prefetch" href="/note/assets/js/118.13bd59a3.js"><link rel="prefetch" href="/note/assets/js/119.478b421c.js"><link rel="prefetch" href="/note/assets/js/12.98436b51.js"><link rel="prefetch" href="/note/assets/js/120.bba2576d.js"><link rel="prefetch" href="/note/assets/js/121.b8a49532.js"><link rel="prefetch" href="/note/assets/js/122.c0be1ad6.js"><link rel="prefetch" href="/note/assets/js/123.a13ecc43.js"><link rel="prefetch" href="/note/assets/js/124.c7c91480.js"><link rel="prefetch" href="/note/assets/js/125.a598a53e.js"><link rel="prefetch" href="/note/assets/js/126.c46ed890.js"><link rel="prefetch" href="/note/assets/js/127.df978541.js"><link rel="prefetch" href="/note/assets/js/128.0fbfdb50.js"><link rel="prefetch" href="/note/assets/js/129.5ef6d2f1.js"><link rel="prefetch" href="/note/assets/js/13.6a288467.js"><link rel="prefetch" href="/note/assets/js/130.e0f91cfb.js"><link rel="prefetch" href="/note/assets/js/131.f306698c.js"><link rel="prefetch" href="/note/assets/js/132.99ef05e9.js"><link rel="prefetch" href="/note/assets/js/133.33367225.js"><link rel="prefetch" href="/note/assets/js/134.12934d9d.js"><link rel="prefetch" href="/note/assets/js/135.10fc17b5.js"><link rel="prefetch" href="/note/assets/js/136.f99fbb7e.js"><link rel="prefetch" href="/note/assets/js/137.400cb143.js"><link rel="prefetch" href="/note/assets/js/138.c84726ec.js"><link rel="prefetch" href="/note/assets/js/139.44a919cd.js"><link rel="prefetch" href="/note/assets/js/14.5c61b999.js"><link rel="prefetch" href="/note/assets/js/140.129a9c61.js"><link rel="prefetch" href="/note/assets/js/141.333d183b.js"><link rel="prefetch" href="/note/assets/js/142.e20c2504.js"><link rel="prefetch" href="/note/assets/js/143.bcbd342a.js"><link rel="prefetch" href="/note/assets/js/144.fd3ce98a.js"><link rel="prefetch" href="/note/assets/js/145.67965ba8.js"><link rel="prefetch" href="/note/assets/js/146.d3546486.js"><link rel="prefetch" href="/note/assets/js/147.4e3db615.js"><link rel="prefetch" href="/note/assets/js/148.5f397230.js"><link rel="prefetch" href="/note/assets/js/149.0b7112d8.js"><link rel="prefetch" href="/note/assets/js/150.5c299715.js"><link rel="prefetch" href="/note/assets/js/151.15e14402.js"><link rel="prefetch" href="/note/assets/js/152.142623d6.js"><link rel="prefetch" href="/note/assets/js/153.9d6d4dbb.js"><link rel="prefetch" href="/note/assets/js/154.166e3746.js"><link rel="prefetch" href="/note/assets/js/155.fec8f916.js"><link rel="prefetch" href="/note/assets/js/156.3424d7c1.js"><link rel="prefetch" href="/note/assets/js/157.54efd6f4.js"><link rel="prefetch" href="/note/assets/js/158.9c779061.js"><link rel="prefetch" href="/note/assets/js/159.657b1474.js"><link rel="prefetch" href="/note/assets/js/16.a1fdb24f.js"><link rel="prefetch" href="/note/assets/js/17.647058e5.js"><link rel="prefetch" href="/note/assets/js/18.0d64c376.js"><link rel="prefetch" href="/note/assets/js/19.6aac06af.js"><link rel="prefetch" href="/note/assets/js/20.cdf6a848.js"><link rel="prefetch" href="/note/assets/js/21.ba24e797.js"><link rel="prefetch" href="/note/assets/js/22.fa50ecc0.js"><link rel="prefetch" href="/note/assets/js/23.1df0f59d.js"><link rel="prefetch" href="/note/assets/js/24.83d3b036.js"><link rel="prefetch" href="/note/assets/js/25.090fa5e2.js"><link rel="prefetch" href="/note/assets/js/26.279573da.js"><link rel="prefetch" href="/note/assets/js/27.b6f4e08e.js"><link rel="prefetch" href="/note/assets/js/28.0f6a1eb7.js"><link rel="prefetch" href="/note/assets/js/29.4bcf962b.js"><link rel="prefetch" href="/note/assets/js/3.8b2b0a88.js"><link rel="prefetch" href="/note/assets/js/30.23d21d7e.js"><link rel="prefetch" href="/note/assets/js/31.d2b4eff7.js"><link rel="prefetch" href="/note/assets/js/32.00daae44.js"><link rel="prefetch" href="/note/assets/js/33.d133dbaf.js"><link rel="prefetch" href="/note/assets/js/34.5c3f41dc.js"><link rel="prefetch" href="/note/assets/js/35.8ebb22ad.js"><link rel="prefetch" href="/note/assets/js/36.5e12369b.js"><link rel="prefetch" href="/note/assets/js/37.44ba09f9.js"><link rel="prefetch" href="/note/assets/js/38.b9d4e81f.js"><link rel="prefetch" href="/note/assets/js/39.dce0525f.js"><link rel="prefetch" href="/note/assets/js/4.1600936a.js"><link rel="prefetch" href="/note/assets/js/40.48147662.js"><link rel="prefetch" href="/note/assets/js/41.c65ff36a.js"><link rel="prefetch" href="/note/assets/js/42.4a5a9b07.js"><link rel="prefetch" href="/note/assets/js/43.d93e7d95.js"><link rel="prefetch" href="/note/assets/js/44.795f16ae.js"><link rel="prefetch" href="/note/assets/js/45.a33b7f8d.js"><link rel="prefetch" href="/note/assets/js/46.eed61c4e.js"><link rel="prefetch" href="/note/assets/js/47.bcf4090d.js"><link rel="prefetch" href="/note/assets/js/48.acc3c884.js"><link rel="prefetch" href="/note/assets/js/49.72f1e58a.js"><link rel="prefetch" href="/note/assets/js/5.87936d19.js"><link rel="prefetch" href="/note/assets/js/50.c97b52c6.js"><link rel="prefetch" href="/note/assets/js/51.90589216.js"><link rel="prefetch" href="/note/assets/js/52.58261de3.js"><link rel="prefetch" href="/note/assets/js/53.cd30b162.js"><link rel="prefetch" href="/note/assets/js/54.f8b1d84c.js"><link rel="prefetch" href="/note/assets/js/55.996d4021.js"><link rel="prefetch" href="/note/assets/js/56.8aae7519.js"><link rel="prefetch" href="/note/assets/js/57.a1f13f10.js"><link rel="prefetch" href="/note/assets/js/58.019afd32.js"><link rel="prefetch" href="/note/assets/js/59.87d6812c.js"><link rel="prefetch" href="/note/assets/js/6.9fd6592e.js"><link rel="prefetch" href="/note/assets/js/60.2e2fed2a.js"><link rel="prefetch" href="/note/assets/js/61.9a454c7e.js"><link rel="prefetch" href="/note/assets/js/63.02d476cb.js"><link rel="prefetch" href="/note/assets/js/64.4d495eea.js"><link rel="prefetch" href="/note/assets/js/65.8d40f46d.js"><link rel="prefetch" href="/note/assets/js/66.06245118.js"><link rel="prefetch" href="/note/assets/js/67.a55b714b.js"><link rel="prefetch" href="/note/assets/js/68.6138399b.js"><link rel="prefetch" href="/note/assets/js/69.dc48da07.js"><link rel="prefetch" href="/note/assets/js/7.a2368c1d.js"><link rel="prefetch" href="/note/assets/js/70.22562f75.js"><link rel="prefetch" href="/note/assets/js/71.ad7cb2ab.js"><link rel="prefetch" href="/note/assets/js/72.4ad91807.js"><link rel="prefetch" href="/note/assets/js/73.fd9d75fb.js"><link rel="prefetch" href="/note/assets/js/74.ebd0d9f3.js"><link rel="prefetch" href="/note/assets/js/75.1e5c5a02.js"><link rel="prefetch" href="/note/assets/js/76.8c5ad7d5.js"><link rel="prefetch" href="/note/assets/js/77.1ed7d5ba.js"><link rel="prefetch" href="/note/assets/js/78.2e9d2c7c.js"><link rel="prefetch" href="/note/assets/js/79.4de53922.js"><link rel="prefetch" href="/note/assets/js/8.13d265f5.js"><link rel="prefetch" href="/note/assets/js/80.ad1777d0.js"><link rel="prefetch" href="/note/assets/js/81.d3a47650.js"><link rel="prefetch" href="/note/assets/js/82.98cc2664.js"><link rel="prefetch" href="/note/assets/js/83.8b927996.js"><link rel="prefetch" href="/note/assets/js/84.3cae09b0.js"><link rel="prefetch" href="/note/assets/js/85.ae586d46.js"><link rel="prefetch" href="/note/assets/js/86.c9da5286.js"><link rel="prefetch" href="/note/assets/js/87.1c9a7016.js"><link rel="prefetch" href="/note/assets/js/88.6ea2b490.js"><link rel="prefetch" href="/note/assets/js/89.b07daca0.js"><link rel="prefetch" href="/note/assets/js/9.39436669.js"><link rel="prefetch" href="/note/assets/js/90.ad9e3a82.js"><link rel="prefetch" href="/note/assets/js/91.e616bb87.js"><link rel="prefetch" href="/note/assets/js/92.d8d5f483.js"><link rel="prefetch" href="/note/assets/js/93.e3505bbf.js"><link rel="prefetch" href="/note/assets/js/94.9da93427.js"><link rel="prefetch" href="/note/assets/js/95.54cdb000.js"><link rel="prefetch" href="/note/assets/js/96.8d528907.js"><link rel="prefetch" href="/note/assets/js/97.f0c8ee4e.js"><link rel="prefetch" href="/note/assets/js/98.910b4cba.js"><link rel="prefetch" href="/note/assets/js/99.3c1de67b.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.5e98f1a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html" class="sidebar-link">forEach、for in、for of、map之间的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#foreach" class="sidebar-link">1️⃣ forEach</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#语法" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#不同点" class="sidebar-link">不同点</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#for-in" class="sidebar-link">2️⃣ for...in</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#语法-2" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#遍历数组的缺点" class="sidebar-link">遍历数组的缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#for-of" class="sidebar-link">3️⃣ for...of</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#语法-3" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#示例-2" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#跳出循环" class="sidebar-link">跳出循环</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#与-for-in-的区别" class="sidebar-link">与 for...in 的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#map" class="sidebar-link">4️⃣ map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#语法-4" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#参数-2" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#返回值" class="sidebar-link">返回值</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html#补充说明" class="sidebar-link">✏️ 补充说明</a></li></ul></li><li><a href="/note/Interview/HTML中的JavaScript.html" class="sidebar-link">HTML中的JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/HTML中的JavaScript.html#script-元素" class="sidebar-link">script 元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/HTML中的JavaScript.html#推迟执行脚本" class="sidebar-link">推迟执行脚本</a></li><li class="sidebar-sub-header"><a href="/note/Interview/HTML中的JavaScript.html#异步执行脚本" class="sidebar-link">异步执行脚本</a></li><li class="sidebar-sub-header"><a href="/note/Interview/HTML中的JavaScript.html#动态加载脚本" class="sidebar-link">动态加载脚本</a></li></ul></li></ul></li><li><a href="/note/Interview/数据类型.html" class="sidebar-link">数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/数据类型.html#数据类型" class="sidebar-link">💫 数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/数据类型.html#number" class="sidebar-link">👉 Number</a></li><li class="sidebar-sub-header"><a href="/note/Interview/数据类型.html#string" class="sidebar-link">👉 String</a></li><li class="sidebar-sub-header"><a href="/note/Interview/数据类型.html#object" class="sidebar-link">👉 Object</a></li></ul></li></ul></li><li><a href="/note/Interview/操作符.html" class="sidebar-link">操作符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#操作符" class="sidebar-link">操作符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#一元操作符" class="sidebar-link">一元操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#布尔操作符" class="sidebar-link">布尔操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#逻辑或" class="sidebar-link">逻辑或</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#乘法操作符" class="sidebar-link">乘法操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#除法操作符" class="sidebar-link">除法操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#求模" class="sidebar-link">求模</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#加性操作符" class="sidebar-link">加性操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#关系操作符" class="sidebar-link">关系操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#相等操作符" class="sidebar-link">相等操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#逗号操作符" class="sidebar-link">逗号操作符</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#breack-和-continue-语句" class="sidebar-link">breack 和 continue 语句</a></li><li class="sidebar-sub-header"><a href="/note/Interview/操作符.html#switch-语句" class="sidebar-link">switch 语句</a></li></ul></li></ul></li><li><a href="/note/Interview/变量、作用域和内存.html" class="sidebar-link">变量、作用域和内存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/变量、作用域和内存.html#变量、作用域和内存问题" class="sidebar-link">变量、作用域和内存问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/变量、作用域和内存.html#检测类型" class="sidebar-link">检测类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/变量、作用域和内存.html#执行环境以及作用域" class="sidebar-link">执行环境以及作用域</a></li><li class="sidebar-sub-header"><a href="/note/Interview/变量、作用域和内存.html#垃圾收集" class="sidebar-link">垃圾收集</a></li><li class="sidebar-sub-header"><a href="/note/Interview/变量、作用域和内存.html#javascript-v8-引擎的垃圾回收机制" class="sidebar-link">JavaScript V8 引擎的垃圾回收机制</a></li></ul></li></ul></li><li><a href="/note/Interview/引用类型.html" class="sidebar-link">引用类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#object-类型" class="sidebar-link">Object 类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#array-类型" class="sidebar-link">Array 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#date-类型" class="sidebar-link">Date 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#regexp-类型" class="sidebar-link">RegExp 类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#函数声明与函数表达式" class="sidebar-link">函数声明与函数表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#函数的内部属性" class="sidebar-link">函数的内部属性</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#函数属性和方法" class="sidebar-link">函数属性和方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#基本包装类型" class="sidebar-link">基本包装类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#boolean-对象" class="sidebar-link">Boolean 对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#number-类型" class="sidebar-link">Number 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#string-类型" class="sidebar-link">String 类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#单体内置对象" class="sidebar-link">单体内置对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#global-对象" class="sidebar-link">Global 对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/引用类型.html#math-对象" class="sidebar-link">Math 对象</a></li></ul></li></ul></li><li><a href="/note/Interview/集合引用类型.html" class="sidebar-link">集合引用类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#定型数组" class="sidebar-link">定型数组</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#arraybuffer" class="sidebar-link">ArrayBuffer</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#dataview" class="sidebar-link">DataView</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#map" class="sidebar-link">Map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#基本-api" class="sidebar-link">基本 API</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#顺序与迭代" class="sidebar-link">顺序与迭代</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#选择-object-还是-map" class="sidebar-link">选择 Object 还是 Map</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#weakmap" class="sidebar-link">WeakMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#基本-api-2" class="sidebar-link">基本 API</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#弱键" class="sidebar-link">弱键</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#不可迭代键" class="sidebar-link">不可迭代键</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#使用弱映射" class="sidebar-link">使用弱映射</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#set" class="sidebar-link">Set</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#基本-api-3" class="sidebar-link">基本 API</a></li><li class="sidebar-sub-header"><a href="/note/Interview/集合引用类型.html#顺序与迭代-2" class="sidebar-link">顺序与迭代</a></li></ul></li></ul></li><li><a href="/note/Interview/迭代器与生成器.html" class="sidebar-link">迭代器与生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#迭代器模式" class="sidebar-link">迭代器模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#迭代器协议" class="sidebar-link">迭代器协议</a></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#自定义迭代器" class="sidebar-link">自定义迭代器</a></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#提前终止迭代器" class="sidebar-link">提前终止迭代器</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#生成器" class="sidebar-link">生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#生成器基础" class="sidebar-link">生成器基础</a></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#通过-yield-中断执行" class="sidebar-link">通过 yield 中断执行</a></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#生成器作为默认迭代器" class="sidebar-link">生成器作为默认迭代器</a></li><li class="sidebar-sub-header"><a href="/note/Interview/迭代器与生成器.html#提前终止生成器" class="sidebar-link">提前终止生成器</a></li></ul></li></ul></li><li><a href="/note/Interview/对象、类与面向对象编程.html" class="sidebar-link">对象、类与面向对象编程</a></li><li><a href="/note/Interview/代理与反射.html" class="sidebar-link">代理与反射</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#代理基础" class="sidebar-link">代理基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#创建代理" class="sidebar-link">创建代理</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#定义捕获器" class="sidebar-link">定义捕获器</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#捕获器参数和反射-api" class="sidebar-link">捕获器参数和反射 API</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#捕获器不变式" class="sidebar-link">捕获器不变式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#可撤销代理" class="sidebar-link">可撤销代理</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#实用反射-api" class="sidebar-link">实用反射 API</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#代理另一个代理" class="sidebar-link">代理另一个代理</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#代理的问题与不足" class="sidebar-link">代理的问题与不足</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#代理捕获器与反射方法" class="sidebar-link">代理捕获器与反射方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#get" class="sidebar-link">get()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#set" class="sidebar-link">set()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#has" class="sidebar-link">has()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#defineproperty" class="sidebar-link">defineProperty()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#getownpropertydescriptor" class="sidebar-link">getOwnPropertyDescriptor()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#deleteproperty" class="sidebar-link">deleteProperty()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#ownkeys" class="sidebar-link">ownKeys()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#getprototypeof" class="sidebar-link">getPrototypeOf()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#setprototypeof" class="sidebar-link">setPrototypeOf()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#isextensible" class="sidebar-link">isExtensible()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#preventextensions" class="sidebar-link">preventExtensions()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#apply" class="sidebar-link">apply()</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#construct" class="sidebar-link">construct()</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#代理模式" class="sidebar-link">代理模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#跟踪属性访问" class="sidebar-link">跟踪属性访问</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#隐藏属性" class="sidebar-link">隐藏属性</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#属性验证" class="sidebar-link">属性验证</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#函数与构造函数参数验证" class="sidebar-link">函数与构造函数参数验证</a></li><li class="sidebar-sub-header"><a href="/note/Interview/代理与反射.html#数据绑定与可观察对象" class="sidebar-link">数据绑定与可观察对象</a></li></ul></li></ul></li><li><a href="/note/Interview/对象的创建模式.html" class="sidebar-link">对象的创建模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#理解对象" class="sidebar-link">理解对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#属性类型" class="sidebar-link">属性类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#创建对象" class="sidebar-link">创建对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#工厂模式" class="sidebar-link">工厂模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#构造函数模式" class="sidebar-link">构造函数模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#原型模式" class="sidebar-link">原型模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#组合使用构造函数模式和原型模式-最常用的模式" class="sidebar-link">组合使用构造函数模式和原型模式（最常用的模式）</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#动态原型模式" class="sidebar-link">动态原型模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#寄生构造函数模式" class="sidebar-link">寄生构造函数模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/对象的创建模式.html#稳妥构造函数模式" class="sidebar-link">稳妥构造函数模式</a></li></ul></li></ul></li><li><a href="/note/Interview/继承.html" class="sidebar-link">继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#原型链" class="sidebar-link">原型链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#默认的原型" class="sidebar-link">默认的原型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#确定原型和实例之间的关系" class="sidebar-link">确定原型和实例之间的关系</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#谨慎地定义方法" class="sidebar-link">谨慎地定义方法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#原型链的问题" class="sidebar-link">原型链的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#借用构造函数" class="sidebar-link">借用构造函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#传递参数" class="sidebar-link">传递参数</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#借用构造函数存在的问题" class="sidebar-link">借用构造函数存在的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#组合继承-最常用" class="sidebar-link">组合继承（最常用）</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#原型式继承" class="sidebar-link">原型式继承</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#寄生式继承" class="sidebar-link">寄生式继承</a></li><li class="sidebar-sub-header"><a href="/note/Interview/继承.html#寄生组合式继承" class="sidebar-link">寄生组合式继承</a></li></ul></li><li><a href="/note/Interview/函数表达式.html" class="sidebar-link">函数表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#函数定义" class="sidebar-link">函数定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#函数声明" class="sidebar-link">函数声明</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#函数表达式" class="sidebar-link">函数表达式</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#递归" class="sidebar-link">递归</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#闭包" class="sidebar-link">闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#创建闭包" class="sidebar-link">创建闭包</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#闭包与变量" class="sidebar-link">闭包与变量</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#关于-this-对象" class="sidebar-link">关于 this 对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#内存泄漏" class="sidebar-link">内存泄漏</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#模仿块级作用域" class="sidebar-link">模仿块级作用域</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#私有变量" class="sidebar-link">私有变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#静态私有变量" class="sidebar-link">静态私有变量</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#模块模式" class="sidebar-link">模块模式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/函数表达式.html#增强的模块模式" class="sidebar-link">增强的模块模式</a></li></ul></li></ul></li><li><a href="/note/Interview/promise与异步函数.html" class="sidebar-link">promise与异步函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#promise" class="sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#基础" class="sidebar-link">基础</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#promise-的实例方法" class="sidebar-link">Promise 的实例方法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#promise-连用以及合并请求" class="sidebar-link">Promise 连用以及合并请求</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#promise-的扩展" class="sidebar-link">Promise 的扩展</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#异步函数" class="sidebar-link">异步函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#async" class="sidebar-link">async</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#await" class="sidebar-link">await</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#await-的限制" class="sidebar-link">await 的限制</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#停止和恢复执行" class="sidebar-link">停止和恢复执行</a></li><li class="sidebar-sub-header"><a href="/note/Interview/promise与异步函数.html#异步函数策略" class="sidebar-link">异步函数策略</a></li></ul></li></ul></li><li><a href="/note/Interview/BOM.html" class="sidebar-link">BOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#window-对象" class="sidebar-link">window 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#全局作用域" class="sidebar-link">全局作用域</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#窗口关系及框架" class="sidebar-link">窗口关系及框架</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#窗口位置" class="sidebar-link">窗口位置</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#窗口大小" class="sidebar-link">窗口大小</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#导航和打开窗口" class="sidebar-link">导航和打开窗口</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#settimeout-setinterval" class="sidebar-link">setTimeout/setInterval</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#系统对话框" class="sidebar-link">系统对话框</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#location-对象" class="sidebar-link">location 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#查询字符串参数" class="sidebar-link">查询字符串参数</a></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#位置操作" class="sidebar-link">位置操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#nagigator-对象" class="sidebar-link">nagigator 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#检查插件" class="sidebar-link">检查插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/BOM.html#history-对象" class="sidebar-link">history 对象</a></li></ul></li><li><a href="/note/Interview/DOM.html" class="sidebar-link">DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#节点层次" class="sidebar-link">节点层次</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#node-类型" class="sidebar-link">Node 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#document-类型" class="sidebar-link">Document 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#element-类型" class="sidebar-link">Element 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#text-类型" class="sidebar-link">Text 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#comment-类型" class="sidebar-link">Comment 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#documenttype-类型" class="sidebar-link">DocumentType 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#documentfragment-类型" class="sidebar-link">DocumentFragment 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#attr-属性" class="sidebar-link">Attr 属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#dom-操作技术" class="sidebar-link">DOM 操作技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#动态脚本" class="sidebar-link">动态脚本</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#动态样式" class="sidebar-link">动态样式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM.html#操作表格" class="sidebar-link">操作表格</a></li></ul></li></ul></li><li><a href="/note/Interview/DOM扩展.html" class="sidebar-link">DOM扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#选择符-api" class="sidebar-link">选择符 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#queryselector-方法" class="sidebar-link">querySelector() 方法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#querysekectorall-方法" class="sidebar-link">querySekectorAll() 方法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#matches-方法" class="sidebar-link">matches() 方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#元素遍历" class="sidebar-link">元素遍历</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#html-5" class="sidebar-link">HTML 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#css-类扩展" class="sidebar-link">CSS 类扩展</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#焦点管理" class="sidebar-link">焦点管理</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#htmldocument-扩展" class="sidebar-link">HTMLDocument 扩展</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#字符集属性" class="sidebar-link">字符集属性</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#自定义属性" class="sidebar-link">自定义属性</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#插入标记" class="sidebar-link">插入标记</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#专有扩展" class="sidebar-link">专有扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#children-属性" class="sidebar-link">children 属性</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM扩展.html#contains-方法" class="sidebar-link">contains() 方法</a></li></ul></li></ul></li><li><a href="/note/Interview/DOM2和DOM3.html" class="sidebar-link">DOM2和DOM3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#dom2、dom3" class="sidebar-link">DOM2、DOM3</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#dom-变化" class="sidebar-link">DOM 变化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#documenttype-类型的变化" class="sidebar-link">DocumentType 类型的变化</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#document-的变化" class="sidebar-link">Document 的变化</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#node-的变化" class="sidebar-link">Node 的变化</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#框架的变化" class="sidebar-link">框架的变化</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#样式" class="sidebar-link">样式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#dom-样式属性和方法" class="sidebar-link">DOM 样式属性和方法</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#计算的样式" class="sidebar-link">计算的样式</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#操作样式表" class="sidebar-link">操作样式表</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#元素大小" class="sidebar-link">元素大小</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#遍历" class="sidebar-link">遍历</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#nodeiterator" class="sidebar-link">NodeIterator</a></li><li class="sidebar-sub-header"><a href="/note/Interview/DOM2和DOM3.html#treewalker" class="sidebar-link">TreeWalker</a></li></ul></li></ul></li><li><a href="/note/Interview/事件.html" class="sidebar-link">事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件流" class="sidebar-link">事件流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件冒泡" class="sidebar-link">事件冒泡</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件捕获" class="sidebar-link">事件捕获</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#dom-事件流" class="sidebar-link">DOM 事件流</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件处理程序" class="sidebar-link">事件处理程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#html-事件处理程序" class="sidebar-link">HTML 事件处理程序</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#dom0-事件处理程序" class="sidebar-link">DOM0 事件处理程序</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#dom2-事件处理程序" class="sidebar-link">DOM2 事件处理程序</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#ie-事件处理程序" class="sidebar-link">IE 事件处理程序</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#跨浏览器的事件处理程序" class="sidebar-link">跨浏览器的事件处理程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件对象" class="sidebar-link">事件对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#dom-中的事件对象" class="sidebar-link">DOM 中的事件对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#ie-中的事件对象" class="sidebar-link">IE 中的事件对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#跨浏览器事件对象" class="sidebar-link">跨浏览器事件对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件类型" class="sidebar-link">事件类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#用户界面事件" class="sidebar-link">用户界面事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#焦点事件" class="sidebar-link">焦点事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#鼠标和滚轮事件" class="sidebar-link">鼠标和滚轮事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#键盘与输入事件" class="sidebar-link">键盘与输入事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#html5-事件" class="sidebar-link">HTML5 事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#触摸及手势事件" class="sidebar-link">触摸及手势事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#内存与性能" class="sidebar-link">内存与性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#事件委托" class="sidebar-link">事件委托</a></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#删除事件处理程序" class="sidebar-link">删除事件处理程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#模拟事件" class="sidebar-link">模拟事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/事件.html#dom-事件模拟" class="sidebar-link">DOM 事件模拟</a></li></ul></li></ul></li><li><a href="/note/Interview/动画与Canvas图形.html" class="active sidebar-link">动画与Canvas图形</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#使用-requestanimationframe" class="sidebar-link">使用 requestAnimationFrame</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#requestanimationframe" class="sidebar-link">requestAnimationFrame</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#cancelanimationframe" class="sidebar-link">cancelAnimationFrame</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#通过-requestanimationframe-节流" class="sidebar-link">通过 requestAnimationFrame 节流</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#基本的画布功能" class="sidebar-link">基本的画布功能</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#_2d-绘图上下文" class="sidebar-link">2D 绘图上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#填充和描边" class="sidebar-link">填充和描边</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#绘制矩形" class="sidebar-link">绘制矩形</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#绘制路径" class="sidebar-link">绘制路径</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#绘制文本" class="sidebar-link">绘制文本</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#变换" class="sidebar-link">变换</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#绘制对象" class="sidebar-link">绘制对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#阴影" class="sidebar-link">阴影</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#渐变" class="sidebar-link">渐变</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#图案" class="sidebar-link">图案</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#图像数据" class="sidebar-link">图像数据</a></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#合成" class="sidebar-link">合成</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#webgl" class="sidebar-link">WebGL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/动画与Canvas图形.html#webgl-基础" class="sidebar-link">webgl 基础</a></li></ul></li></ul></li><li><a href="/note/Interview/客户端存储.html" class="sidebar-link">客户端存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#cookie" class="sidebar-link">cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#限制" class="sidebar-link">限制</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#cookie-的构成" class="sidebar-link">cookie 的构成</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#javascript-中的-cookie" class="sidebar-link">JavaScript 中的 cookie</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#子-cookie" class="sidebar-link">子 cookie</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#使用-cookie-的注意事项" class="sidebar-link">使用 cookie 的注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#web-storage" class="sidebar-link">Web Storage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#storage-类型" class="sidebar-link">Storage 类型</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#sessionstorage-对象" class="sidebar-link">sessionStorage 对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#localstorage-对象" class="sidebar-link">localStorage 对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#存储事件" class="sidebar-link">存储事件</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#限制-2" class="sidebar-link">限制</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#indexeddb" class="sidebar-link">IndexedDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#数据库" class="sidebar-link">数据库</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#对象存储" class="sidebar-link">对象存储</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#插入对象" class="sidebar-link">插入对象</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#通过游标查询" class="sidebar-link">通过游标查询</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#键范围" class="sidebar-link">键范围</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#设置游标方向" class="sidebar-link">设置游标方向</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/note/Interview/客户端存储.html#限制-3" class="sidebar-link">限制</a></li></ul></li></ul></li><li><a href="/note/Interview/模块.html" class="sidebar-link">模块</a></li><li><a href="/note/Interview/工作者线程.html" class="sidebar-link">工作者线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/工作者线程.html#工作者线程简介" class="sidebar-link">工作者线程简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Interview/工作者线程.html#工作者线程与线程" class="sidebar-link">工作者线程与线程</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="使用-requestanimationframe"><a href="#使用-requestanimationframe" class="header-anchor">#</a> 使用 requestAnimationFrame</h2> <h3 id="requestanimationframe"><a href="#requestanimationframe" class="header-anchor">#</a> requestAnimationFrame</h3> <p>用以通知浏览器某些 JavaScript 代码要执行动画了。这样浏览器就可以在运行某些代码后进行适当的优化。</p> <p>requestAnimationFrame() 方法接收一个参数，此参数是一个要在重绘屏幕前调用的函数。这个函数就是修改 DOM 样式以反映下一次重绘有什么变化的地方。为了实现动画循环，可以把多个 requestAnimationFrame() 调用串联起来，就像以前使用 setTimeout() 时一样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'status'</span><span class="token punctuation">)</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">!==</span> <span class="token string">'100%'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateProgress<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateProgress<span class="token punctuation">)</span>
</code></pre></div><p>因为 requestAnimationFrame() 只会调用一次传入的函数，所以每次更新用户界面时需要再手动调用它一次。同样，也需要控制动画何时停止。结果就会得到非常平滑的动画。</p> <p>传给 requestAnimationFrame() 的函数实际上可以接收一个参数，此参数是一个 DOMHighRes-TimeStamp 的实例（比如 performance.now() 返回的值），表示下次重绘的时间。这一点非常重要：requestAnimationFrame() 实际上把重绘任务安排在了未来一个已知的时间点上，而且通过这个参数告诉了开发者。基于这个参数，就可以更好地决定如何调优动画了。</p> <h3 id="cancelanimationframe"><a href="#cancelanimationframe" class="header-anchor">#</a> cancelAnimationFrame</h3> <p>requestAnimationFrame() 返回一个请求 ID，可以用于通过方法 cancelAnimationFrame() 来取消重绘任务。下面的例子展示了刚把一个任务加入队列又立即将其取消：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> requestId <span class="token operator">=</span> widow<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Repaint!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span>
</code></pre></div><h3 id="通过-requestanimationframe-节流"><a href="#通过-requestanimationframe-节流" class="header-anchor">#</a> 通过 requestAnimationFrame 节流</h3> <p>这个方法的会暴露出作为钩子的回调队列。所谓钩子（hook），就是浏览器在执行下一次重绘之前的一个点。这个回调队列是一个可修改的函数列表，包含应该在重绘之前调用的函数。每次调用 requestAnimationFrame() 都会在队列上推入一个回调函数，队列的长度没有限制。</p> <p>这个回调队列的行为不一定跟动画有关。不过，通过 requestAnimationFrame() 递归地向队列中加入回调函数，可以保证每次重绘最多只调用一次回调函数。这是一个非常好的节流工具。在频繁执行影响页面外观的代码时（比如滚动事件监听器），可以利用这个回调队列进行节流。</p> <p>比如下面的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">expensiveOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invoked at'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expensiveOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果想把事件处理程序的调用限制在每次重绘前发生，那么可以像这样下面把它封装到 requestAnimationFrame() 调用中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">expensiveOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invoked at'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>expensiveOperation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样会把所有回调的执行集中在重绘钩子，但不会过滤掉每次重绘的多余调用。此时，定义一个标志变量，由回调设置其开关状态，就可以将多余的调用屏蔽：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> enqueued <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">expensiveOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invoked at'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  enqueued <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enqueued<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enqueued <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>expensiveOperation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因为重绘是非常频繁的操作，所以这还算不上真正的节流。更好的办法是配合使用一个计时器来限制操作执行的频率。这样，计时器可以限制实际的操作执行间隔，而 requestAnimationFrame 控制在浏览器的哪个渲染周期中执行。下面的例子可以将回调限制为不超过 50 毫秒执行一次：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">expensiveOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invoked at'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>expensiveOperation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="基本的画布功能"><a href="#基本的画布功能" class="header-anchor">#</a> 基本的画布功能</h2> <p>创建 canvas 元素时至少要设置其 width 和 height 属性，这样才能告诉浏览器在多大面积上绘图。出现在开始和结束标签之间的内容是后备数据，会在浏览器不支持 canvas 元素时显示。比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>drawing<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A drawing of something.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>与其他元素一样，width 和 height 属性也可以在 DOM 节点上设置，因此可以随时修改。整个元素还可以通过 CSS 添加样式，并且元素在添加样式或实际绘制内容前是不可见的；要在画布上绘制图形，首先要取得绘图上下文。使用 getContext() 方法可以获取对绘图上下文的引用。对于平面图形，需要给这个方法传入参数 &quot;2d&quot; ，表示要获取 2D 上下文对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>

<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token comment">// 其他代码</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以使用 toDataURL() 方法导出 canvas 元素上的图像。这个方法接收一个参数：要生成图像的 MIME 类型（与用来创建图形的上下文无关）。例如，要从画布上导出一张 PNG 格式的图片，可以这样做：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'draeing'</span><span class="token punctuation">)</span>

<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取图像的数据 URI</span>
  <span class="token keyword">let</span> imgURI <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>

  <span class="token comment">// 显示图片</span>
  <span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> imgURI
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注意 如果画布中的图像是其他域绘制过来的，toDataURL() 方法就会抛出错误。</p></blockquote> <h2 id="_2d-绘图上下文"><a href="#_2d-绘图上下文" class="header-anchor">#</a> 2D 绘图上下文</h2> <p>2D 上下文的坐标原点(0, 0)在 canvas 元素的左上角。所有坐标值都相对于该点计算，因此 x 坐标向右增长，y 坐标向下增长。默认情况下， width 和 height 表示两个方向上像素的最大值。</p> <h3 id="填充和描边"><a href="#填充和描边" class="header-anchor">#</a> 填充和描边</h3> <p>2D 上下文有两个基本绘制操作：填充和描边。填充以指定样式（颜色、渐变或图像）自动填充形状，而描边只为图形边界着色。大多数 2D 上下文操作有填充和描边的变体，显示效果取决于两个属性：fillStyle 和 strokeStyle 。</p> <p>这两个属性可以是字符串、渐变对象或图案对象，默认值都为 &quot;#000000&quot; 。字符串表示颜色值，可以是 CSS 支持的任意格式：名称、十六进制代码、 rgb 、 rgba 、 hsl 或 hsla 。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'red'</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#0000ff'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="绘制矩形"><a href="#绘制矩形" class="header-anchor">#</a> 绘制矩形</h3> <p>矩形是唯一一个可以直接在 2D 绘图上下文中绘制的形状。与绘制矩形相关的方法有 3 个：fillRect() 、 strokeRect() 和 clearRect() 。这些方法都接收 4 个参数：矩形 x 坐标、矩形 y 坐标、矩形宽度和矩形高度。这几个参数的单位都是像素。</p> <p>fillRect() 方法用于以指定颜色在画布上绘制并填充矩形。填充的颜色使用 fillStyle 属性指定。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制红色矩形</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
  context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制半透明蓝色矩形</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 255, 0.5)'</span>
  context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>strokeRect() 方法使用通过 strokeStyle 属性指定的颜色绘制矩形轮廓。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制红色轮廓的矩形</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
  context<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制半透明蓝色轮廓的矩形</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 255, 0.5)'</span>
  context<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注意 描边宽度由 lineWidth 属性控制，它可以是任意整数值。类似地， lineCap 属性控制线条端点的形状［ &quot;butt&quot; （平头）、 &quot;round&quot; （出圆头）或 &quot;square&quot; （出方头）］，而 lineJoin 属性控制线条交点的形状［ &quot;round&quot; （圆转）、 &quot;bevel&quot; （取平）或 &quot;miter&quot; （出尖）］。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制红色轮廓的矩形</span>
  context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">30</span>
  context<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">'round'</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
  context<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制半透明蓝色轮廓的矩形</span>
  context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">10</span>
  context<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">'miter'</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 255, 0.5)'</span>
  context<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 clearRect() 方法可以擦除画布中某个区域。该方法用于把绘图上下文中的某个区域变透明。通过先绘制形状再擦除指定区域，可以创建出有趣的效果，比如从已有矩形中开个孔。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token comment">// 绘制红色矩形</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
  context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制半透明蓝色矩形</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 255, 0.5)'</span>
  context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

  <span class="token comment">// 在前两个矩形重叠的区域擦除一个矩形区域</span>
  context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="绘制路径"><a href="#绘制路径" class="header-anchor">#</a> 绘制路径</h3> <p>2D 绘图上下文支持很多在画布上绘制路径的方法。通过路径可以创建复杂的形状和线条。要绘制路径，必须首先调用 beginPath() 方法以表示要开始绘制新路径。然后，再调用下列方法来绘制路径。</p> <ul><li><p>arc(x, y, radius, startAngle, endAngle, counterclockwise) ：以坐标 (x, y) 为圆心，以 radius 为半径绘制一条弧线，起始角度为 startAngle ，结束角度为 endAngle （都是弧度）。最后一个参数 counterclockwise 表示是否逆时针计算起始角度和结束角度（默认为顺时针）。</p></li> <li><p>arcTo(x1, y1, x2, y2, radius) ：以给定半径 radius ，经由 (x1, y1) 绘制一条从上一点到 (x2, y2) 的弧线。</p></li> <li><p>bezierCurveTo(c1x, c1y, c2x, c2y, x, y) ：以 (c1x, c1y) 和 (c2x, c2y) 为控制点，绘制一条从上一点到 (x, y) 的弧线（三次贝塞尔曲线）。</p></li> <li><p>lineTo(x, y) ：绘制一条从上一点到 (x, y) 的直线。</p></li> <li><p>moveTo(x, y) ：不绘制线条，只把绘制光标移动到 (x, y) 。</p></li> <li><p>quadraticCurveTo(cx, cy, x, y) ：以 (cx, cy) 为控制点，绘制一条从上一点到 (x, y)的弧线（二次贝塞尔曲线）。</p></li> <li><p>rect(x, y, width, height) ：以给定宽度和高度在坐标点 (x, y) 绘制一个矩形。这个方法与 strokeRect() 和 fillRect() 的区别在于，它创建的是一条路径，而不是独立的图形。</p></li></ul> <p>创建路径之后，可以使用 closePath() 方法绘制一条返回起点的线。如果路径已经完成，则既可以指定 fillStyle 属性并调用 fill() 方法来填充路径，也可以指定 strokeStyle 属性并调用 stroke() 方法来描画路径，还可以调用 clip() 方法基于已有路径创建一个新剪切区域。如下例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>

<span class="token comment">// 确保浏览器可用</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>

  <span class="token comment">// 创建路径</span>
  context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制外圆</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制内圆---在绘制内圆之前，必须先把路径移动到内圆上的一点，以避免绘制出多余的线条。</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

  <span class="token comment">// 描画路径</span>
  context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在绘制内圆之前，必须先把路径移动到内圆上的一点，以避免绘制出多余的线条。</p> <p>绘制路径还有一个 isPointInPath() 方法，接收 x 轴和 y 轴坐标作为参数，这个方法用于确定指定的点是否在路径上，可以在关闭路径前随时调用，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isPointInPath</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Point (10, 100) is in the path.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="绘制文本"><a href="#绘制文本" class="header-anchor">#</a> 绘制文本</h3> <p>2D 绘图上下文提供了绘制文本的方法，即 fillText() 和 strokeText() 。这两个方法都接收 4 个参数：要绘制的字符串、x 坐标、y 坐标和可选的最大像素宽度。而且，这两个方法最终绘制的结果都取决于以下 3 个属性:</p> <ul><li>font ：以 CSS 语法指定的字体样式、大小、字体族等，比如 &quot;10px Arial&quot; 。</li> <li>textAlign ：指定文本的对齐方式，可能的值包括 &quot;start&quot;、&quot;end&quot;、&quot;left&quot;、&quot;right&quot; 和 &quot;center&quot;。推荐使用 &quot;start&quot; 和 &quot;end&quot; ，不使用 &quot;left&quot; 和 &quot;right&quot; ，因为前者无论在从左到右书写的语言还是从右到左书写的语言中含义都更明确。</li> <li>textBaseLine ：指定文本的基线，可能的值包括 &quot;top&quot;、&quot;hanging&quot;、&quot;middle&quot;、&quot;alphabetic&quot;、&quot;ideographic&quot; 和 &quot;bottom&quot; 。</li></ul> <p>fillText() 方法使用 fillStyle 属性绘制文本，而 strokeText() 方法使用 strokeStyle 属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 正常</span>
context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'blod 14px Arial'</span>
context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span>
context<span class="token punctuation">.</span>textBaseLine <span class="token operator">=</span> <span class="token string">'middle'</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment">// 与开头对齐</span>
context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'start'</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment">// 与末尾对齐</span>
context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'end'</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
</code></pre></div><p>2D 上下文提供了用于辅助确定文本大小的 measureText() 方法。这个方法接收一个参数，即要绘制的文本，然后返回一个 TextMetrics 对象。这个返回的对象目前只有一个属性 width ，不过将来应该会增加更多度量指标。</p> <p>measureText() 方法使用 font、textAlign 和 textBaseline 属性当前的值计算绘制指定文本后的大小。例如，假设要把文本 &quot;Hello world!&quot; 放到一个 140 像素宽的矩形中，可以使用以下代码，从 100 像素的字体大小开始计算，不断递减，直到文本大小合适：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> fontSize <span class="token operator">=</span> <span class="token number">100</span>
context<span class="token punctuation">.</span>font <span class="token operator">=</span> fontSize <span class="token operator">+</span> <span class="token string">'px Arial'</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">&gt;</span> <span class="token number">140</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fontSize<span class="token operator">--</span>
  context<span class="token punctuation">.</span>font <span class="token operator">=</span> fontSize <span class="token operator">+</span> <span class="token string">'px Arial'</span>
<span class="token punctuation">}</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'Hello Wodld!'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'Font size is '</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p>fillText() 和 strokeText() 方法还有第四个参数，即文本的最大宽度。如果调用 fillText() 和 strokeText() 时提供了此参数，但要绘制的字符串超出了最大宽度限制，则文本会以正确的字符高度绘制，这时字符会被水平压缩，以达到限定宽度。</p> <h3 id="变换"><a href="#变换" class="header-anchor">#</a> 变换</h3> <p>上下文变换可以操作绘制在画布上的图像。2D 绘图上下文支持所有常见的绘制变换。在创建绘制上下文时，会以默认值初始化变换矩阵，从而让绘制操作如实应用到绘制结果上。对绘制上下文应用变换，可以导致以不同的变换矩阵应用绘制操作，从而产生不同的结果。</p> <p>以下方法可用于改变绘制上下文的变换矩阵:</p> <ul><li>rotate(angle) ：围绕原点把图像旋转 angle 弧度。</li> <li>scale(scaleX, scaleY) ：通过在 x 轴乘以 scaleX 、在 y 轴乘以 scaleY 来缩放图像。 scaleX 和 scaleY 的默认值都是 1.0。</li> <li>translate(x, y) ：把原点移动到 (x, y) 。执行这个操作后，坐标(0, 0)就会变成 (x, y) 。</li> <li>transform(m1_1, m1_2, m2_1, m2_2, dx, dy) ：像下面这样通过矩阵乘法直接修改矩阵。
m1_1 m1_2 dx
m2_1 m2_2 dy
0    0    1</li> <li>setTransform(m1_1, m1_2, m2_1, m2_2, dx, dy) ：把矩阵重置为默认值，再以传入的参数调用 transform() 。</li></ul> <p>下面例子是将前面的绘制的表单例子中，坐标原点移动到表盘中心，那再绘制表针就非常简单了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>

<span class="token comment">// 确保浏览器可用</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>

  <span class="token comment">// 创建路径</span>
  context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制外圆</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制内圆</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 移动原点到表盘中心</span>
  context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">85</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// 描画路径</span>
  context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isPointInPath</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Point (10, 100) is in the path.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'blod 14px Arial'</span>
  context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span>
  context<span class="token punctuation">.</span>textBaseLine <span class="token operator">=</span> <span class="token string">'middle'</span>
  context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把原点移动到(100, 100)，也就是表盘的中心后，要绘制表针只需简单的数学计算即可。这是因为所有计算都是基于(0, 0)，而不是(100, 100)了。当然，也可以使用 rotate() 方法来转动表针：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drawing'</span><span class="token punctuation">)</span>

<span class="token comment">// 确保浏览器可用</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>

  <span class="token comment">// 创建路径</span>
  context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制外圆</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制内圆</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 移动原点到表盘中心</span>
  context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  
  <span class="token comment">// 旋转表针</span>
  context<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">85</span><span class="token punctuation">)</span>

  <span class="token comment">// 绘制分针</span>
  context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// 描画路径</span>
  context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isPointInPath</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Point (10, 100) is in the path.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'blod 14px Arial'</span>
  context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span>
  context<span class="token punctuation">.</span>textBaseLine <span class="token operator">=</span> <span class="token string">'middle'</span>
  context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所有这些变换，包括 fillStyle 和 strokeStyle 属性，会一直保留在上下文中，直到再次修改它们。如果想着什么时候再回到当前的属性和变换状态，可以调用 save() 方法。调用这个方法后，所有这一时刻的设置会被放到一个暂存栈中。保存之后，可以继续修改上下文。而在需要恢复之前的上下文时，可以调用 restore() 方法。这个方法会从暂存栈中取出并恢复之前保存的设置。多次调用 save() 方法可以在暂存栈中存储多套设置，然后通过 restore() 可以系统地恢复。</p> <div class="language-js extra-class"><pre class="language-js"><code>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#00ff00'</span>
context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#0000ff'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment">// 在 (100, 100) 绘制蓝色矩形</span>

context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment">// 在 (100, 100) 绘制绿色矩形</span>

context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment">// 在 (0, 0) 绘制红色矩形</span>
</code></pre></div><blockquote><p>注意， save() 方法只保存应用到绘图上下文的设置和变换，不保存绘图上下文的内容。</p></blockquote> <h3 id="绘制对象"><a href="#绘制对象" class="header-anchor">#</a> 绘制对象</h3> <p>可以使用 drawImage() 方法将图像绘制到画布上。这个方法可以接收 3 组不同的参数，并产生不同的结果。</p> <ol><li>传入 HTML 的 img 元素以及绘制目标的 x 和 y 坐标，将结果绘制到指定的位置。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><p>上面绘制出来的图像跟原图一样大，如果想改变绘制的大小，可以再传入另外两个参数：目标宽度和目标高度。这里的缩放只会影响绘制的图像，不影响上下文的变换矩阵。</p> <div class="language-js extra-class"><pre class="language-js"><code>context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>把图像绘制到上下文中的一个区域</li></ol> <p>需要给 drawImage() 提供 9 个参数：要绘制的图像、源图像 x 坐标、源图像 y 坐标、源图像宽度、源图像高度、目标区域 x 坐标、目标区域 y 坐标、目标区域宽度和目标区域高度。这个重载后的 drawImage() 方法可以实现最大限度的控制，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>第一个参数除了可以是 HTML 的 img 元素，还可以是另一个 canvas 元素，这样就会把另一个画布的内容绘制到当前画布上。</p></blockquote> <h3 id="阴影"><a href="#阴影" class="header-anchor">#</a> 阴影</h3> <p>绘制阴影需要根据下面的几个属性来生成：</p> <ul><li>shadowColor ：CSS 颜色值，表示要绘制的阴影颜色，默认为黑色。</li> <li>shadowOffsetX ：阴影相对于形状或路径的 x 坐标的偏移量，默认为 0。</li> <li>shadowOffsetY ：阴影相对于形状或路径的 y 坐标的偏移量，默认为 0。</li> <li>shadowBlur ：像素，表示阴影的模糊量。默认值为 0，表示不模糊。</li></ul> <p>这些属性都是可以通过 context 对象来读写设置。只要在绘制图形或路径前给这些属性设置好适当的值，阴影就会自动生成。如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
<span class="token comment">// 设置阴影</span>
context<span class="token punctuation">.</span>shadowOffsetX <span class="token operator">=</span> <span class="token number">5</span>
context<span class="token punctuation">.</span>shadowOffsetY <span class="token operator">=</span> <span class="token number">5</span>
context<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> <span class="token number">4</span>
context<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 0, 0.5)'</span>

<span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// 绘制蓝色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(0, 0, 255, 1)'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="avatar"></p> <h3 id="渐变"><a href="#渐变" class="header-anchor">#</a> 渐变</h3> <p>渐变通过 CanvasGradient 的实例表示，要创建一个新的线性渐变，可以调用上下文的 createLinearGradient() 方法。这个方法接收 4 个参数：起点 x 坐标、起点 y 坐标、终点 x 坐标和终点 y 坐标。调用之后，该方法会以指定大小创建一个新的 CanvasGradient 对象并返回实例。有了 gradient 对象后，接下来要使用 addColorStop() 方法为渐变指定色标。这个方法接收两个参数：色标位置和 CSS 颜色字符串。色标位置通过 0～1 范围内的值表示，0 是第一种颜色，1 是最后一种颜色。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> gradient <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span>
</code></pre></div><p>创建的渐变对象需要赋值给 fillStyle 或者 strokeStyle 属性，来绘制图形：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// 绘制渐变矩形</span>
context<span class="token punctuation">.</span>filStyle <span class="token operator">=</span> gradient
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="avatar"></p> <p>如果矩形没有绘制到渐变的范围内，则只会显示部分渐变。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADCCAIAAADWwPnxAAAACXBIWXMAABJ0AAASdAHeZh94AAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAT+SURBVHic7d3NbdtIHIfh2UWuacAVSFWkhxzSjtWCq9haDLiMIPB9Ad+s2YPhrCR+iLYViz/8n+cQMIo8YIwXwzGHSv7qvTdI8Pe1TwCWEisxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESowvFxvp1692f3+x0a5us2nb7bVPgiOXi/X+vn3/frHRrm63a7e31z4JjlgGEEOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLES48u1T+BT/fv168+bm95a77333nr///jwxd7701N/eDh8fer47Bve8YULbTab7XZ74e/RitWK9efNzT8/fjw/Pz8/P+9f/T4+Onh83N/dnfzRy6+990UjjB2cHeHFwr/Obre7vb39o9+xVakVa2/tsJIlB8OSzrb4kRHeNLNWUyzW3ofdzAR0WGHvfbS80QHfN4JS55WL9TCRl4CW5DtV4czXvnUEpZ5VK9bW+3xAw5IOax592/Cr3jGCUpeoFWtvbcnktz++NM+8bcbJCDNfrtSFisU6NsntXxeUU9Pe/tzUu2SE4VBKfatysU6VN5rgySvDH/mnchz+ODU6glLfpFasbWwZMDPt/X5l+WJg6g3DEZT6VrViHZ0dF179T+baqbctHEGp71Au1qm2Zu6GLlyALh9Bqe9TK9Z2MLcNmzu84p+91f++EZT6EbVifdluHZ0RR6M8OZi5n7pwBKV+xOVi3Wzabnex0f6Qp6f94+P79kKnXlw+glI/6HKxbrdt9U8A7R8e9nd3S2bEvd3U9Sm2DDi+b283NUutWNvrfVa7qYlqxToVlt3UCOVitZuaq1ysoxOh3dQItWJtx88G2E3NUivW0SLtpqYoGqvd1ETlYj28UW83NUutWNvrswHzs6nd1HWqFevwjtXopXzJnHoyglI/QcVY7aaGqhVrO/exlmG1dlPXo1asow+y7O2mhqgb60yOdlPXqVysZ0udutafvEGpn69irHZTQ9WKtU08G7CfvZ9qnboStWKdWgbYTY1QLtb5ndWpOdVu6hrUirW1tvzqf/JbpV5drVhPlgF2U7OUi3W4KWA3NUW5WIcX99EpVqkrVCvWNlizziwDlLo2tWIdfrrVbmqQcrFOXeuHy4NrnyynasXaln26VanrVCvWJZ9uVepq1fpfsc/+YxZKXbNyM+vMp1uVunK1Ym3Tn25V6voVXQbs7aYGqjWzju5XKTVF3ZlVqXFqxdqO16xKzVJuGWCdmqvWzPp7GaDURBVjVWqoWrG21pSaq1ys5BIrMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxKj18PVms9ntdtc+i4v59u3btU/hU/3lkTlSWAYQQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKDLESQ6zEECsxxEoMsRJDrMQQKzHESgyxEkOsxBArMcRKjP8AvM3qWqz+QdgAAAAASUVORK5CYII=" alt="avatar"></p> <p>保持渐变与形状的一致非常重要，有时候可能需要写个函数计算相应的坐标。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createRectLinearGradient</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> width<span class="token punctuation">,</span> y <span class="token operator">+</span> height<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> gradient <span class="token operator">=</span> <span class="token function">createRectLinearGradient</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span>

<span class="token comment">// 绘制渐变矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p>径向渐变（或放射性渐变）要使用 createRadialGradient() 方法来创建。这个方法接收 6个参数，分别对应两个圆形圆心的坐标和半径。前 3 个参数指定起点圆形中心的 x、y 坐标和半径，后 3 个参数指定终点圆形中心的 x、y 坐标和半径。在创建径向渐变时，可以把两个圆形想象成一个圆柱体的两个圆形表面。把一个表面定义得小一点，另一个定义得大一点，就会得到一个圆锥体。然后，通过移动两个圆形的圆心，就可以旋转这个圆锥体。</p> <p>要创建起点圆心在形状中心并向外扩散的径向渐变，需要将两个圆形设置为同心圆。比如，要在前面例子中矩形的中心创建径向渐变，则渐变的两个圆形的圆心都必须设置为(55, 55)。这是因为矩形的起点是(30, 30)，终点是(80, 80)。代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> gradient <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createRadialGradient</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>

gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span>
<span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// 绘制渐变矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="avatar"></p> <h3 id="图案"><a href="#图案" class="header-anchor">#</a> 图案</h3> <p>要创建新图案，可以调用 createPattern() 方法并传入两个参数：一个 HTML img 元素和一个表示该如何重复图像的字符串。第二个参数的值与 CSS 的 background-repeat 属性是一样的，包括 &quot;repeat&quot; 、 &quot;repeat-x&quot; 、 &quot;repeat-y&quot; 和 &quot;no-repeat&quot; 。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> pattern <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createPattern</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string">'repeat'</span><span class="token punctuation">)</span>
<span class="token comment">// 绘制矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> pattern
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span>
</code></pre></div><p>记住，跟渐变一样，图案的起点实际上是画布的原点(0, 0)。将填充样式设置为图案，表示在指定位置而不是开始绘制的位置显示图案。传给 createPattern() 方法的第一个参数也可以是 video 元素或者另一个 canvas 元素。</p> <h3 id="图像数据"><a href="#图像数据" class="header-anchor">#</a> 图像数据</h3> <p>可以使用 getImageData() 方法获取原始图像数据。这个方法接收 4 个参数：要取得数据中第一个像素的左上角坐标和要取得的像素宽度及高度。例如，要从(10, 5)
开始取得 50 像素宽、50 像素高的区域对应的数据，可以这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> imageData <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p>返回的对象是一个 ImageData 的实例。每个 ImageData 对象都包含 3 个属性：width 、height 和 data，其中，data 属性是包含图像的原始像素信息的数组。每个像素在 data 数组中都由 4 个值表示，分别代表红、绿、蓝和透明度值。换句话说，第一个像素的信息包含在第 0 到第 3 个值中，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data
<span class="token keyword">const</span> red <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> green <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> blue <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> alpha <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre></div><p>这个数组中的每个值都在 0~255 范围内（包括 0 和 255）。对原始图像数据进行访问可以更灵活地操作图像。例如，通过更改图像数据可以创建一个简单的灰阶过滤器：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 确保浏览器支持 canvas</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  cosnt image <span class="token operator">=</span> document<span class="token punctuation">.</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 绘制图像</span>
  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 取得图像数据</span>
  <span class="token keyword">const</span> imageData <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">let</span> len <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> red <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> green <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> blue <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> alpha <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 取得 RGB 平均值</span>
    <span class="token keyword">const</span> average <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>red <span class="token operator">+</span> green <span class="token operator">+</span> blue<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置颜色，不管透明度</span>
    data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> average<span class="token punctuation">;</span>
    data<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> average<span class="token punctuation">;</span>
    data<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> average<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将修改后的数据写回 ImageData 并应用到画布上显示出来</span>
  imageData<span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>每次循环中取得红、绿、蓝的颜色值，计算出它们的平均值。然后再把原来的值修改为这个平均值，实际上相当于过滤掉了颜色信息，只留下类似亮度的灰度信息。之后将 data 数组重写回 imageData 对象。最后调用 putImageData() 方法，把图像数据再绘制到画布上。结果就得到了原始图像的黑白版。</p> <h3 id="合成"><a href="#合成" class="header-anchor">#</a> 合成</h3> <p>2D 上下文中绘制的所有内容都会应用两个属性：globalAlpha 和 globalCompositionOperation，其中，globalAlpha 属性是一个范围在 0~1 的值（包括 0 和 1），用于指定所有绘制内容的透明度，默认值为 0。如果所有后来的绘制都需要使用同样的透明度，那么可以将 globalAlpha 设置为适当的值，执行绘制，然后再把 globalAlpha 设置为 0。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#ff0000&quot;</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 修改全局透明度</span>
context<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0.5</span>
<span class="token comment">// 绘制蓝色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(0,0,255,1)&quot;</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 重置</span>
context<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><p>globalCompositionOperation 属性表示新绘制的形状如何与上下文中已有的形状融合。这个属性是一个字符串，可以取下列值。</p> <ul><li>source-over ：默认值，新图形绘制在原有图形上面。</li> <li>source-in ：新图形只绘制出与原有图形重叠的部分，画布上其余部分全部透明。</li> <li>source-out ：新图形只绘制出不与原有图形重叠的部分，画布上其余部分全部透明。</li> <li>source-atop ：新图形只绘制出与原有图形重叠的部分，原有图形不受影响。</li> <li>destination-over ：新图形绘制在原有图形下面，重叠部分只有原图形透明像素下的部分可见。</li> <li>destination-in ：新图形绘制在原有图形下面，画布上只剩下二者重叠的部分，其余部分完全透明。</li> <li>destination-out ：新图形与原有图形重叠的部分完全透明，原图形其余部分不受影响。</li> <li>destination-atop ：新图形绘制在原有图形下面，原有图形与新图形不重叠的部分完全透明。</li> <li>lighter ：新图形与原有图形重叠部分的像素值相加，使该部分变亮。</li> <li>copy ：新图形将擦除并完全取代原有图形。</li> <li>xor ：新图形与原有图形重叠部分的像素执行“异或”计算。</li></ul> <p>如下例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

<span class="token comment">// 设置合成方式</span>
context<span class="token punctuation">.</span>globalCompositeOperation <span class="token operator">=</span> <span class="token string">'destination-over'</span>
<span class="token comment">// 绘制蓝色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(0,0,255,1)'</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOwAAAC6CAIAAAAiZjapAAAACXBIWXMAABJ0AAASdAHeZh94AAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAALOSURBVHic7d2xTVtRFIDhSxTvYBoaN3iLzMAq9Jh1XGWGlC6pLEUpUiEWoHYqohSRYoWLHj/6vgHOO8VfnOq+i+8/fg4ouzidTkvvAK/yaekF4LVETJ6IyRMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZi8z3PGPD6Ow2HOqPfg+npst0svwbkmRXw4jJubOaPeg/v7sdstvQTnck6QJ2LyREyeiMkTMXkiJk/E5ImYPBGTJ2LyREyeiMkTMXkiJk/E5ImYPBGTJ2LyREyeiMkTMXkiJk/E5ImYPBGTJ2LyJj1j9bHs92P/MHPgej3u7sZ6PXMmv4n4L47H09fjzIGbzbi9nTmQPzknyBMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZg8EZMnYvJETJ6IyRMxeSImT8TkiZg8EZMnYvIm/cfu+nrc388Z9WK/H8fjae7MM30bXxb5Lv9nUsTb7djt5ox6sX8Yc/+IyEflnCBPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZv0gtAb2C9HpvN0ktMcnU1Vqull/i4Lk6nZd47+6enp/H8vPQSk6xW4/JSx2/l/UYMZ3ITkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IiZPxOSJmDwRkydi8kRMnojJEzF5IibvF4OpLiM02dBrAAAAAElFTkSuQmCC" alt="avatar"></p> <blockquote><p>使用 globalCompositeOperation 属性时，一定记得要在不同浏览器上进行测试。不同浏览器在实现这些选项时可能存在差异。</p></blockquote> <h2 id="webgl"><a href="#webgl" class="header-anchor">#</a> WebGL</h2> <h3 id="webgl-基础"><a href="#webgl-基础" class="header-anchor">#</a> webgl 基础</h3> <p>可以在调用 getContext() 取得 WebGL上下文时指定一些选项。这些选项通过一个参数对象传入，选项就是参数对象的一个或多个属性。</p> <ul><li>alpha ：布尔值，表示是否为上下文创建透明通道缓冲区，默认为 true 。</li> <li>depth ：布尔值，表示是否使用 16 位深缓冲区，默认为 true 。</li> <li>stencil ：布尔值，表示是否使用 8 位模板缓冲区，默认为 false 。</li> <li>antialias ：布尔值，表示是否使用默认机制执行抗锯齿操作，默认为 true 。</li> <li>premultipliedAlpha ：布尔值，表示绘图缓冲区是否预乘透明度值，默认为 true 。</li> <li>preserveDrawingBuffer ：布尔值，表示绘图完成后是否保留绘图缓冲区，默认为 false 。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 确保浏览器支持&lt;canvas&gt;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> alpha<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用 WebGL</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果调用 getContext() 不能创建 WebGL 上下文，某些浏览器就会抛出错误。为此，最好把这个方法调用包装在 try / catch 块中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 确保浏览器支持&lt;canvas&gt;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    gl <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 什么也不做</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用 WebGL</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;WebGL context could not be created.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>准备绘图</li></ol> <p>准备使用 WebGL 上下文之前，通常需要先指定一种实心颜色清除 canvas 。为此，要调用clearColor() 方法并传入 4 个参数，分别表示红、绿、蓝和透明度值。每个参数必须是 0~1 范围内的值，表示各个组件在最终颜色的强度。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 黑色</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上代码把清理颜色缓冲区的值设置为黑色，然后调用 clear() 方法，这个方法相当于 OpenGL 中的 glClear() 方法。参数 gl.COLOR_BUFFER_BIT 告诉 WebGL 使用之前定义的颜色填充画布。通常，所有绘图操作之前都需要先清除绘制区域。</p> <ol start="2"><li>视口</li></ol> <p>绘图前还要定义 WebGL 视口。默认情况下，视口使用整个 canvas 区域。要改变视口，可以调用 viewport() 方法并传入视口相对于 canvas 元素的 x、y 坐标及宽度和高度。例如，以下代码表示要使用整个 canvas 元素：</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>width<span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
</code></pre></div><p>这个视口的坐标系统与网页中通常的坐标系统不一样。视口的 x 和 y 坐标起点(0, 0) 表示 canvas 元素的左下角，向上、向右增长可以用点(width–1, height–1)定义</p> <p><img src="data:image/png;base64,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KysrJaUGg8HR0VH5tlHjaCsrLi7esWNH9csfHBwcRo4ceZ9jtg4ODqWlpXPmzPnHP/5Rl417vtAbiLN58+bIyMjly5c3b9688nnglJSUDh06KJ/vihdeeEF5kJubu3379rKyMuXDKysrKyAgwDJb5Q8OR0dHy6lgb2/vRo0alZWVOTg4bN26NTw8XPk8ys3N/eijj9q2bavVart06XL06FE3NzdlEXd392bNmq1Zs0b5VPX39+/YsaPl80WlUrVo0WLKlCkpKSnvv/9+r169pk6d+uh/QI+aVqtVdvIs7OzsevbsuXLlyo4dO9rb28+fP/+Pf/zjvn37mjVrVv0agcOHDzs4OMiyXGUlD9SwYcNBgwZVn/4Ij0levnzZw8PjXhcdvPDCC//617+UvY1Dhw6FhIQoh20fyM7OLiQkpHopNRrNfS57Qy3xE4Q4oaGhZWVl8+bNGzhw4NChQy3HLlxdXQsKCmpcJC4uztfX13JFUFJS0pUrVx74RhqN5vXXXz948GD//v1dXV0DAwOV6atWrRo+fHhoaKjy1MvLy3IZq1qt7tevX0lJSVFRkSRJCQkJ58+fnzhxomWdOp1u69atSUlJEydOtKzwCde/f/+2bdtWuexq0KBBa9as2bx588yZM/Pz852dndeuXTtv3rzqiwcGBq5cufLkyZOBgYEmk6nGm0BrZGVl1aRJk0ewAfdgbW29bdu2CRMm+Pv7m83mhISEbt26VW6PWq1u1arVF1984ePjM3jwYFdX11penqdWq5UTV3VVUVFha2s7ZcqUh1j2+cH5G4jTqFGjyZMnL168uLCwcMqUKbt371buhPDy8rK3t798+bLyiWYwGPbv33/jxg1JksrKyho3biz971a72bNn6/V6Zbby8vKysjLlsdlsLikpqfzB2q5du9u3bx85ciQgIMDyzdTb21u5Uqu8vPznn39WTjgrd11kZWV99NFHWq3Wy8vLy8vL1tbWcndIXl7e6tWr//a3v3l5eS1evLhfv36WK52ecHZ2dra2titWrKg8sW/fvn5+fjqdzsvLy9fXNywsrLy83MfHR3n1xo0bWVlZyk9y8uTJ7u7u06ZNS0tL++WXX5KSko4fP67MduvWrdTUVFmWH+5efWWpysveuXPnu+++q5I05crDylNkWTYaje+9915eXt6oUaOWLl366aefbt++3Ww2V545PT39448/Pn/+fFRUVFRU1Nq1a8+ePVvlHRXKoTMrKyvl0sTa/MmDioqK6gfcIiMjJUn697//XbsfwHNK88knn9T3GPB8sbe379y586uvvmplZfXLL7/4+flJktS+ffuYmJj4+Pg7d+6kpqZeu3YtKCjIysqqffv2Fy5cuHHjhk6nO3bs2JgxY86cOdO4cWM3N7eTJ09evnxZeVxYWLhz505Zljt37qx8z1Wr1c7Ozjt27FCujlXe2t3d/dChQwaD4eDBg+np6RERERcvXnR2dvb09DSZTMePH7ezs4uLiyspKTl37tzo0aPt7e1LSkp27Njxhz/8ISwszN/fv063g9Q7lUpla2ublJQ0cuRIy9d/KysrZ2fn4ODgFi1aSJKkVqvt7e2DgoKUVzMzM/V6vYuLi6+vr5ubW/fu3Tdt2vTtt9+2aNHCycmpdevWXbp0MRqNmzdvPnz48IABA86fP9+8efN+/fo1bNjQaDSqVKrg4OAHHjdLSEjw8vJycnKyXB84ffr0zz//3M/Pr23btpbZdDpdampq165de/TooVKpSkpKXFxcWrZs6ePj4+7unpiY+PPPPwcEBMyaNcvGxqagoODSpUtdunTp1auXo6NjSkrK77//XlhYmJ+ff/PmzRUrVnTv3j09Pd3V1bVv377NmjWTZdlgMDg5OXXu3NnHxycmJmb9+vWdOnXy8vK6z8hLSkrOnj1rbW3duXPnykfY9u/f7+/vHxoaWpv7ip5bqupHKoH6kpubazQalV2QKtPt7e0rn+CpDZPJZDAYql9xVFBQoNVqazxpLMtyZmams7Pz07IH80AlJSUzZsyYMmWKcrG4Qrm4XDk7VflxjXJycpQ7eMrKypQrOJSJKpXKcvbr/6fT6eLj43/77be5c+fWcpG8vLzy8vIar2C+cuXKiRMnxo0bpzw1mUxxcXEZGRn3uTeooKCgtLT04Q6m5eTkDBkyZMeOHY/2QvBnD70BnnGJiYmLFi364osvHvrmEgFyc3MPHjwYFhZW128VNfrwww9zcnKmT5/epk0bSZISEhLS09PDwsIsvXy0Vq1a5eTkNHr0aHZu7o/eAM++o0eP3r17d8SIEfU9kHuqqKgwmUxVrnt+aNeuXZs7d25sbKydnZ2Tk9PQoUP/9Kc/ubi4PJKVV6fX6+/1l3JQGb0B8AwyGo0ZGRlms/lxXyyH2qM3AAARuB4aACAC93s+rWRZrtN/OoLnBHfC44nF7+XTKjo6+q9//Wt9jwJPnCFDhnz55Zf1PQqgBvTmaaXX69PS0oYNG8bfP4dCluXdu3fzv37hiUVvnmIajWbu3LnV/+tfPJ+MRuOJEyfqexTAPXG9AABABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHrztDp//rzRaMzIyKjvgeBJYTKZMjIyLly4UN8DAWpGb55Wvr6+Wq22SZMm9T0QPCk0Gk2TJk18fHzqeyBAzegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEIHeAABEoDcAABHoDQBABHoDABCB3gAARKA3AAAR6A0AQAR6AwAQgd4AAESgNwAAEegNAEAEegMAEEFb3wPAwzOZTHPmzHF1da3vgeCJIMtyRkaGv79/fQ8EqBm9eYrJshwVFVXfowCAWqE3T6uuXbuuWrWqvkeBJ07r1q3rewhAzVRms7m+xwAAePZxvQAAQAR6AwAQgfM3D8lgMKSkpLz88suSJOXk5Kxbt87BwWHUqFEeHh4PXHb//v3nzp1r2rRpeHi4RqORJCkzM7Nx48bKYwB4JrF/8zAOHz584sSJDh06SJJ09+7dGTNmdOrU6Y033pg9e3ZGRsb9l927d++uXbvGjx+fnJy8Zs0ak8lkMplWrFixatUqk8kkZPgAUA/oTZ3l5ORs2bKlXbt2Wq3WbDYvW7bMw8MjJCTE3d39xRdf/Pzzz2VZvs+yM2fOnDVrVpMmTWbPnv3VV19dunRJo9HMmjXrypUrKSkpIjcEAESiN3VjNpuXLFnSpEkTd3d3SZIKCws3bNhguePSxcXlu+++u3v37r0Wj4qK0ul0tra2kiRZW1urVKo1a9ZIkmRjY9OlS5fly5eziwPgWUVv6iY/P3/Tpk2WwJjNZjs7u7FjxypP33zzzQYNGtzrEvPy8vIff/xx+PDhnp6ekiTZ2tq+/fbbFRUVyqtDhw5NSEi4ePHi498IAKgH9KZu9Hq9ra3tmDFjLFNUKpW1tbXy2MrKSqVS3WvZioqK06dPV57HsqCybHFx8cqVKx/PwAGgntGbuomMjCwoKLCysnpM6y8vL39MawaA+kVv6sZgMFQ5XCbLcnFxsfK4pKTkPhcL2NjYBAUFWeYxGo0xMTGPdbQA8OSgN3XTo0cPBwcHy1O1Wm0ymTZt2qQ83bp1a3FxsVpd809Vq9UGBQXt2bMnMzNTkqSKioqzZ8/27t378Y8aAOofvambTp06mc3mhIQE5amLi8s777xTWFhoNpvNZnNBQcH48ePd3NwkSdLpdHq9vsriI0aMaNasWVFRkSRJp06dateuXUhIiOVVKyurPn36iNoUABCK3tSNg4NDx44dT506ZZkyZcqU0tLSffv2HT58OCMjY/r06SqVKj4+PiAgYOHChVUOvjVo0GDJkiWLFi26evXq9u3bJ0yY4OzsrLx05syZ1q1bDxo0SOj2AIAo/H3oOvvpp582bNiwevVqe3t7ZYrBYDh9+rTRaOzatatyb01RUdHmzZtLSkrGjRvXuHHjKmvIy8v74YcfgoKCPD09LdeqLV++vFGjRqNHjxa5LQAgDPs3dRYcHNypU6cDBw5YUm1jY9O9e/dXX31ViY0kSVqttm3btiqVSjm2VkXDhg1Hjx7dpEkTS2yOHz9+4sQJdm4APMPYv3kYBQUFW7ZsCQgIeOWVV2qc4ezZs/n5+YGBgXZ2drVZ4blz59zd3ZW/WQAAzyR68/AMBoONjU19jwIAng70BgAgAudvAAAi0BsAgAj0BgAgAr0BAIhAbwAAItAbAIAI9AYAIAK9AQCIQG8AACLQGwCACP8FzjFzkgIka7oAAAAASUVORK5CYII=" alt="avatar"></p> <p>知道如何定义视口就可以只使用 canvas 元素的一部分来绘图。比如下面的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 视口是&lt;canvas&gt; 左下角四分之一区域</span>
gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 视口是&lt;canvas&gt; 左上角四分之一区域</span>
gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 视口是&lt;canvas&gt; 右下角四分之一区域</span>
gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> drawing<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>定义视口的坐标系统与视口中的坐标系统不一样。在视口中，坐标原点(0, 0)是视口的中心点。左下角是(–1, –1)，右上角是(1, 1):</p> <p><img src="data:image/png;base64,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" alt="avatar"></p> <p>如果绘图时使用了视口外部的坐标，则绘制结果会被视口剪切。</p> <section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
    评 论：
  </h3> <div id="vcomments"></div></section></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新:</span> <span class="time">11/22/2020, 11:00:56 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/Interview/事件.html" class="prev">
        事件
      </a></span> <span class="next"><a href="/note/Interview/客户端存储.html">
        客户端存储
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.63e6b075.js" defer></script><script src="/note/assets/js/2.00905bb4.js" defer></script><script src="/note/assets/js/15.d742ac3a.js" defer></script><script src="/note/assets/js/62.fad51c04.js" defer></script>
  </body>
</html>
