<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>初始化项目 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/note/assets/css/0.styles.5e98f1a2.css" as="style"><link rel="preload" href="/note/assets/js/app.981df038.js" as="script"><link rel="preload" href="/note/assets/js/2.311cbb04.js" as="script"><link rel="preload" href="/note/assets/js/29.930561ae.js" as="script"><link rel="prefetch" href="/note/assets/js/10.664df595.js"><link rel="prefetch" href="/note/assets/js/100.f9bbb123.js"><link rel="prefetch" href="/note/assets/js/101.2c05313d.js"><link rel="prefetch" href="/note/assets/js/102.82f6c782.js"><link rel="prefetch" href="/note/assets/js/103.93fc677d.js"><link rel="prefetch" href="/note/assets/js/104.529f0ae0.js"><link rel="prefetch" href="/note/assets/js/105.d161bac6.js"><link rel="prefetch" href="/note/assets/js/106.4721ef1c.js"><link rel="prefetch" href="/note/assets/js/107.4453883d.js"><link rel="prefetch" href="/note/assets/js/108.36c8f3be.js"><link rel="prefetch" href="/note/assets/js/109.369a129a.js"><link rel="prefetch" href="/note/assets/js/11.01b0157b.js"><link rel="prefetch" href="/note/assets/js/110.8bfe124b.js"><link rel="prefetch" href="/note/assets/js/111.dc06980d.js"><link rel="prefetch" href="/note/assets/js/112.1f0e5417.js"><link rel="prefetch" href="/note/assets/js/113.e6187b45.js"><link rel="prefetch" href="/note/assets/js/114.9cb4ce8e.js"><link rel="prefetch" href="/note/assets/js/115.d24f7662.js"><link rel="prefetch" href="/note/assets/js/116.21685d0b.js"><link rel="prefetch" href="/note/assets/js/117.021e98f6.js"><link rel="prefetch" href="/note/assets/js/118.0b4b61b4.js"><link rel="prefetch" href="/note/assets/js/119.987461a0.js"><link rel="prefetch" href="/note/assets/js/12.42bc42e1.js"><link rel="prefetch" href="/note/assets/js/120.ade978ca.js"><link rel="prefetch" href="/note/assets/js/121.e73615a1.js"><link rel="prefetch" href="/note/assets/js/122.9eb81930.js"><link rel="prefetch" href="/note/assets/js/123.621c088f.js"><link rel="prefetch" href="/note/assets/js/124.eb851c6b.js"><link rel="prefetch" href="/note/assets/js/125.4708f471.js"><link rel="prefetch" href="/note/assets/js/126.8dff9f7e.js"><link rel="prefetch" href="/note/assets/js/127.232acd76.js"><link rel="prefetch" href="/note/assets/js/128.71d7896d.js"><link rel="prefetch" href="/note/assets/js/129.56bbf574.js"><link rel="prefetch" href="/note/assets/js/13.48279650.js"><link rel="prefetch" href="/note/assets/js/130.6300dff1.js"><link rel="prefetch" href="/note/assets/js/131.3493328c.js"><link rel="prefetch" href="/note/assets/js/132.99ae2904.js"><link rel="prefetch" href="/note/assets/js/133.fab4bb3b.js"><link rel="prefetch" href="/note/assets/js/134.43d7d1dd.js"><link rel="prefetch" href="/note/assets/js/135.b47a3b1a.js"><link rel="prefetch" href="/note/assets/js/136.6c8f2884.js"><link rel="prefetch" href="/note/assets/js/137.51766a3d.js"><link rel="prefetch" href="/note/assets/js/138.ee068b7b.js"><link rel="prefetch" href="/note/assets/js/139.7b258a1f.js"><link rel="prefetch" href="/note/assets/js/14.420e70c0.js"><link rel="prefetch" href="/note/assets/js/140.3d414796.js"><link rel="prefetch" href="/note/assets/js/141.ba09cea1.js"><link rel="prefetch" href="/note/assets/js/142.ba201a8c.js"><link rel="prefetch" href="/note/assets/js/143.c958d6b6.js"><link rel="prefetch" href="/note/assets/js/144.ed0de9ec.js"><link rel="prefetch" href="/note/assets/js/145.fccca3b5.js"><link rel="prefetch" href="/note/assets/js/146.fa1b0b68.js"><link rel="prefetch" href="/note/assets/js/147.f5341101.js"><link rel="prefetch" href="/note/assets/js/148.fe5df873.js"><link rel="prefetch" href="/note/assets/js/149.e33de248.js"><link rel="prefetch" href="/note/assets/js/15.57860ef7.js"><link rel="prefetch" href="/note/assets/js/150.90420b73.js"><link rel="prefetch" href="/note/assets/js/151.0dbef4f7.js"><link rel="prefetch" href="/note/assets/js/152.c2b4f6f9.js"><link rel="prefetch" href="/note/assets/js/153.85619705.js"><link rel="prefetch" href="/note/assets/js/154.9d3befc4.js"><link rel="prefetch" href="/note/assets/js/155.d75fc43a.js"><link rel="prefetch" href="/note/assets/js/156.d8a6589e.js"><link rel="prefetch" href="/note/assets/js/157.73f5b8cc.js"><link rel="prefetch" href="/note/assets/js/158.8fbc7a04.js"><link rel="prefetch" href="/note/assets/js/159.7cc4f914.js"><link rel="prefetch" href="/note/assets/js/16.3af552e9.js"><link rel="prefetch" href="/note/assets/js/160.94b3c8e2.js"><link rel="prefetch" href="/note/assets/js/161.f27ea88c.js"><link rel="prefetch" href="/note/assets/js/162.02af5a73.js"><link rel="prefetch" href="/note/assets/js/163.6694278d.js"><link rel="prefetch" href="/note/assets/js/164.5ebace33.js"><link rel="prefetch" href="/note/assets/js/165.b500084c.js"><link rel="prefetch" href="/note/assets/js/166.c3ebe87c.js"><link rel="prefetch" href="/note/assets/js/167.c2f1639d.js"><link rel="prefetch" href="/note/assets/js/168.3abe4b41.js"><link rel="prefetch" href="/note/assets/js/169.21048818.js"><link rel="prefetch" href="/note/assets/js/17.a20d5be0.js"><link rel="prefetch" href="/note/assets/js/170.5e2dcb37.js"><link rel="prefetch" href="/note/assets/js/171.ea57b3b6.js"><link rel="prefetch" href="/note/assets/js/172.0c382305.js"><link rel="prefetch" href="/note/assets/js/173.905ec41d.js"><link rel="prefetch" href="/note/assets/js/174.3c03479f.js"><link rel="prefetch" href="/note/assets/js/175.a06fc96d.js"><link rel="prefetch" href="/note/assets/js/176.df14a144.js"><link rel="prefetch" href="/note/assets/js/177.b0ea9d53.js"><link rel="prefetch" href="/note/assets/js/178.5be8caf4.js"><link rel="prefetch" href="/note/assets/js/179.d4b8b9a6.js"><link rel="prefetch" href="/note/assets/js/18.46dcef09.js"><link rel="prefetch" href="/note/assets/js/180.50c9974c.js"><link rel="prefetch" href="/note/assets/js/181.ede33d73.js"><link rel="prefetch" href="/note/assets/js/182.32945318.js"><link rel="prefetch" href="/note/assets/js/183.d4be1c34.js"><link rel="prefetch" href="/note/assets/js/184.82309467.js"><link rel="prefetch" href="/note/assets/js/19.e0a89ded.js"><link rel="prefetch" href="/note/assets/js/20.bad3b903.js"><link rel="prefetch" href="/note/assets/js/21.6f4a95be.js"><link rel="prefetch" href="/note/assets/js/22.4ed83a87.js"><link rel="prefetch" href="/note/assets/js/23.7529ff79.js"><link rel="prefetch" href="/note/assets/js/24.fb7f17a9.js"><link rel="prefetch" href="/note/assets/js/25.a23708f6.js"><link rel="prefetch" href="/note/assets/js/26.31121813.js"><link rel="prefetch" href="/note/assets/js/27.895c77a8.js"><link rel="prefetch" href="/note/assets/js/28.e0948a06.js"><link rel="prefetch" href="/note/assets/js/3.d4f1f423.js"><link rel="prefetch" href="/note/assets/js/30.5050dae6.js"><link rel="prefetch" href="/note/assets/js/31.a41a7341.js"><link rel="prefetch" href="/note/assets/js/32.32493f44.js"><link rel="prefetch" href="/note/assets/js/33.de832296.js"><link rel="prefetch" href="/note/assets/js/34.9b9acc8b.js"><link rel="prefetch" href="/note/assets/js/35.0d214042.js"><link rel="prefetch" href="/note/assets/js/36.1b333ece.js"><link rel="prefetch" href="/note/assets/js/37.8fc02437.js"><link rel="prefetch" href="/note/assets/js/38.72c4e747.js"><link rel="prefetch" href="/note/assets/js/39.90902816.js"><link rel="prefetch" href="/note/assets/js/4.2819838d.js"><link rel="prefetch" href="/note/assets/js/40.6592259d.js"><link rel="prefetch" href="/note/assets/js/41.39d44063.js"><link rel="prefetch" href="/note/assets/js/42.49aad173.js"><link rel="prefetch" href="/note/assets/js/43.fbf06b60.js"><link rel="prefetch" href="/note/assets/js/44.ed98de23.js"><link rel="prefetch" href="/note/assets/js/45.d0dac465.js"><link rel="prefetch" href="/note/assets/js/46.9dc9de18.js"><link rel="prefetch" href="/note/assets/js/47.4de115b9.js"><link rel="prefetch" href="/note/assets/js/48.5e4bf413.js"><link rel="prefetch" href="/note/assets/js/49.9b39fd3e.js"><link rel="prefetch" href="/note/assets/js/5.b2ee9f0a.js"><link rel="prefetch" href="/note/assets/js/50.54bfe53c.js"><link rel="prefetch" href="/note/assets/js/51.ae963f8e.js"><link rel="prefetch" href="/note/assets/js/52.eab5edf7.js"><link rel="prefetch" href="/note/assets/js/53.beba3081.js"><link rel="prefetch" href="/note/assets/js/54.ba9dad9b.js"><link rel="prefetch" href="/note/assets/js/55.fe20b974.js"><link rel="prefetch" href="/note/assets/js/56.a2722eaf.js"><link rel="prefetch" href="/note/assets/js/57.d1885582.js"><link rel="prefetch" href="/note/assets/js/58.0086e112.js"><link rel="prefetch" href="/note/assets/js/59.1eeb5d87.js"><link rel="prefetch" href="/note/assets/js/6.d73a81bc.js"><link rel="prefetch" href="/note/assets/js/60.da4f411e.js"><link rel="prefetch" href="/note/assets/js/61.adb78d23.js"><link rel="prefetch" href="/note/assets/js/62.8c1a8313.js"><link rel="prefetch" href="/note/assets/js/63.b007282b.js"><link rel="prefetch" href="/note/assets/js/64.aea44f73.js"><link rel="prefetch" href="/note/assets/js/65.6c92f7b7.js"><link rel="prefetch" href="/note/assets/js/66.957a0570.js"><link rel="prefetch" href="/note/assets/js/67.ed8ff64e.js"><link rel="prefetch" href="/note/assets/js/68.2fee594c.js"><link rel="prefetch" href="/note/assets/js/69.8af06e79.js"><link rel="prefetch" href="/note/assets/js/7.a5b714fc.js"><link rel="prefetch" href="/note/assets/js/70.686eeb67.js"><link rel="prefetch" href="/note/assets/js/71.3303d84c.js"><link rel="prefetch" href="/note/assets/js/72.9d15130f.js"><link rel="prefetch" href="/note/assets/js/73.c381cd57.js"><link rel="prefetch" href="/note/assets/js/74.6c9825e6.js"><link rel="prefetch" href="/note/assets/js/75.a6f40f9f.js"><link rel="prefetch" href="/note/assets/js/76.357099e7.js"><link rel="prefetch" href="/note/assets/js/77.8fe07367.js"><link rel="prefetch" href="/note/assets/js/78.eaf37c3d.js"><link rel="prefetch" href="/note/assets/js/79.c593dadc.js"><link rel="prefetch" href="/note/assets/js/8.e1d96763.js"><link rel="prefetch" href="/note/assets/js/80.912793c7.js"><link rel="prefetch" href="/note/assets/js/81.42a7e76f.js"><link rel="prefetch" href="/note/assets/js/82.830fcb74.js"><link rel="prefetch" href="/note/assets/js/83.35065763.js"><link rel="prefetch" href="/note/assets/js/84.96abab40.js"><link rel="prefetch" href="/note/assets/js/85.e73d1c35.js"><link rel="prefetch" href="/note/assets/js/86.2eb30991.js"><link rel="prefetch" href="/note/assets/js/87.218015ac.js"><link rel="prefetch" href="/note/assets/js/88.b6a04fee.js"><link rel="prefetch" href="/note/assets/js/89.ff895fb6.js"><link rel="prefetch" href="/note/assets/js/9.ad0982bc.js"><link rel="prefetch" href="/note/assets/js/90.35e4b5fb.js"><link rel="prefetch" href="/note/assets/js/91.a2b8f1a7.js"><link rel="prefetch" href="/note/assets/js/92.aaeaae28.js"><link rel="prefetch" href="/note/assets/js/93.061e2707.js"><link rel="prefetch" href="/note/assets/js/94.58e895e7.js"><link rel="prefetch" href="/note/assets/js/95.a94ffca7.js"><link rel="prefetch" href="/note/assets/js/96.ac7141ea.js"><link rel="prefetch" href="/note/assets/js/97.e470b005.js"><link rel="prefetch" href="/note/assets/js/98.0c20f597.js"><link rel="prefetch" href="/note/assets/js/99.f37558d0.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.5e98f1a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/angular/基础.html" class="nav-link">
  angular
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/js-gc/数据类型.html" class="nav-link">
  红宝书
</a></div><div class="nav-item"><a href="/note/interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/angular/基础.html" class="nav-link">
  angular
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/js-gc/数据类型.html" class="nav-link">
  红宝书
</a></div><div class="nav-item"><a href="/note/interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/angular/基础.html" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/基础.html#模板语法相关" class="sidebar-link">模板语法相关</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#组件相关" class="sidebar-link">组件相关</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#指令相关" class="sidebar-link">指令相关</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#转换数据的管道" class="sidebar-link">转换数据的管道</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#路由相关" class="sidebar-link">路由相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/基础.html#router-对象" class="sidebar-link">router 对象</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#activatedroute" class="sidebar-link">ActivatedRoute</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#路由守卫" class="sidebar-link">路由守卫</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#service-相关" class="sidebar-link">service 相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/基础.html#dom-操作" class="sidebar-link">DOM 操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#模块和懒加载" class="sidebar-link">模块和懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/基础.html#自定义模块" class="sidebar-link">自定义模块</a></li><li class="sidebar-sub-header"><a href="/note/angular/基础.html#配置路由模块懒加载" class="sidebar-link">配置路由模块懒加载</a></li></ul></li></ul></li><li><a href="/note/angular/项目相关.html" class="active sidebar-link">项目相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#初始化项目" class="sidebar-link">初始化项目</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#指令相关" class="sidebar-link">指令相关</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#事件处理和样式绑定" class="sidebar-link">事件处理和样式绑定</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#组件的声明周期" class="sidebar-link">组件的声明周期</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#模板在组件类中的引用" class="sidebar-link">模板在组件类中的引用</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#获取-dom-节点修改样式" class="sidebar-link">获取 DOM 节点修改样式</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#双向绑定" class="sidebar-link">双向绑定</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#模块" class="sidebar-link">模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#ngmodule-注解" class="sidebar-link">@NgModule 注解</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#模块的-坑" class="sidebar-link">模块的 “坑”</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#装饰器" class="sidebar-link">装饰器</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#组件嵌套和投影组件" class="sidebar-link">组件嵌套和投影组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#投影组件" class="sidebar-link">投影组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#自定义指令" class="sidebar-link">自定义指令</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#指令的样式和事件绑定" class="sidebar-link">指令的样式和事件绑定</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#组件中的-host" class="sidebar-link">组件中的 Host</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#路由" class="sidebar-link">路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#路径参数配置以及路由配置" class="sidebar-link">路径参数配置以及路由配置</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#激活路由" class="sidebar-link">激活路由</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#管道" class="sidebar-link">管道</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#依赖注入" class="sidebar-link">依赖注入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#自定义注入类" class="sidebar-link">自定义注入类</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#通过模块的形式进行注入" class="sidebar-link">通过模块的形式进行注入</a></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#注入数值" class="sidebar-link">注入数值</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/angular/项目相关.html#脏值检测" class="sidebar-link">脏值检测</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h2> <p>一般使用 ng new 项目名 这样的命令进行初始化项目。会比较慢，他会使用 npm 进行安装依赖。可以使用如下命令：</p> <p>可以指定 css 预编译以及不需要路由模块等。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ng new project --skip-install --style css --routing <span class="token boolean">false</span>
</code></pre></div><p>对于 package.json 文件中版本号的一些说明：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 前面有 ~ 就是说锁定前端两个版本号，6.5.x，最后一个如果有更新就会安装最新的</span>
<span class="token string">&quot;rxjs&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;~6.5.2&quot;</span>
<span class="token comment"># 前面有 ^ 就是说锁定前面的大版本号，1.x.x；后面的两个版本号如果有最新就安装</span>
<span class="token string">&quot;tslib&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;^1.9.0&quot;</span>

<span class="token comment"># 严格锁定版本</span>
<span class="token string">&quot;zone.js&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0.9.0&quot;</span>
</code></pre></div><h2 id="指令相关"><a href="#指令相关" class="header-anchor">#</a> 指令相关</h2> <p>ngFor 相关：获取索引、是否第一个元素、是否最后一个元素、可迭代对象中的索引号为奇数、是否偶数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>li <span class="token operator">*</span>ngFor<span class="token operator">=</span><span class="token string">&quot;let menu of menus;let i = index;let first = first;let last = last;let odd = odd; let even = even&quot;</span><span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">{</span>munu<span class="token punctuation">.</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>https://angular.cn/api/common/NgForOf</p></blockquote> <p>ngIf 相关</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>条件表达式 else elseContent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  条件为真展示
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">#elseContent</span><span class="token punctuation">&gt;</span></span>
  条件为假时展示
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="事件处理和样式绑定"><a href="#事件处理和样式绑定" class="header-anchor">#</a> 事件处理和样式绑定</h2> <ul><li><code>[class.样式类名]</code> = &quot;判断表达式&quot; 是在应用单个 clas 时的常用技巧；</li> <li>ngStyle <code>&lt;div [ngStyle]=&quot;{ 'color': someColor }&quot;&gt;&lt;/div&gt;</code> ngStyle 由于是嵌入式样式，他会覆盖掉其他样式，使用时需谨慎；</li> <li>使用方括号 [] 是数据绑定，如果带方括号，等号后面就是一个对象或表达式；</li> <li>不适用方括号，等号后面 angular 认为是一个字符串，但如果我们此时在等号后使用 {{}} 就是和方括号等效的；</li> <li>圆括号 () 用于事件绑定，等号后可以接表达式也可以是一个定义在类中的函数；</li></ul> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <p>我们一般封装组件，如果需要属性的绑定通过 @input 进行表示，对于事件，如果需要增加事件回调。告诉外部调用者执行。通过 @output 来标识。</p> <h3 id="组件的声明周期"><a href="#组件的声明周期" class="header-anchor">#</a> 组件的声明周期</h3> <ul><li>constructor：构造函数永远首先被调用</li> <li>ngOnChanges：输入属性变化时被调用</li> <li>ngOnInit：组件初始化被调用</li> <li>ngDoCheck：脏值检测时调用</li> <li>ngAfterContentInit：当内容投影 ng-content 完成时调用</li> <li>ngAfterContentChecked：angular 检测投影内容时调用（多次）</li> <li>ngAfterViewInit：当组件视图（子视图）初始化完成时</li> <li>ngAfterViewChecked：当检测视图变化时（多次）</li> <li>ngOnDestroy：当组件销毁时</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AfterContentChecked<span class="token punctuation">,</span> AfterContentInit<span class="token punctuation">,</span> AfterViewChecked<span class="token punctuation">,</span> AfterViewInit<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> EventEmitter<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> OnChanges<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> Output<span class="token punctuation">,</span> SimpleChanges <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ScrollableTabComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnChanges<span class="token punctuation">,</span> AfterContentInit<span class="token punctuation">,</span> AfterContentChecked<span class="token punctuation">,</span> AfterViewInit<span class="token punctuation">,</span> AfterViewChecked <span class="token punctuation">{</span>

  <span class="token comment">/**
   * 构造函数永远首先被调用
   */</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件初始化完成，在这个函数中，我们可以安全的使用组件的属性和方法
   */</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 监听自己组件本身数值变化-输入值的变化 @Input 属性发生变化</span>
  <span class="token comment">// 参数为索引对象，key 为属性的名字，value 为 SimpleChanges</span>
  <span class="token function">ngOnChanges</span><span class="token punctuation">(</span>value<span class="token operator">:</span> SimpleChanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件内容初始化
   */</span>
  <span class="token function">ngAfterContentInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件内容脏值检测
   */</span>
  <span class="token function">ngAfterContentChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件视图初始化-组件和他的子组件都初始化完成
   */</span>
  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件视图的脏值检测
   */</span>
  <span class="token function">ngAfterViewChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 组件销毁时执行
   */</span>
  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token comment">// ngDoCheck() {</span>
  <span class="token comment">//   console.log('组件脏值监测')</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span>

</code></pre></div><p>ng-content 相当于 vue 中的 slot 插槽。父组件向子组件传递内容。</p> <h3 id="模板在组件类中的引用"><a href="#模板在组件类中的引用" class="header-anchor">#</a> 模板在组件类中的引用</h3> <p><code>#</code> 后面是给模板或者 dom 元素起一个引用名字以便可以在组件类或模板中进行引用</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">#helloDiv</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后在类中引用：</p> <p>@ViewChild 是一个选择器，用来查找要引用的 dom 元素或者组件，ElementRef 是 dom 元素的一个包装类，因为 dom 元素不是 angular 中的类，所以需要一个包装类以便在 angular 中使用和标识其类型。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">ViewChild</span><span class="token punctuation">(</span><span class="token string">'helloDiv'</span><span class="token punctuation">)</span> helloDivRef<span class="token operator">:</span> ElementRef
<span class="token punctuation">}</span>
</code></pre></div><p>如果想获取组件，可以在 @ViewChild 中直接使用组件的名称，也就是定义组件的类名：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>app<span class="token operator">-</span>image<span class="token operator">-</span>slider<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>app<span class="token operator">-</span>image<span class="token operator">-</span>slider<span class="token operator">&gt;</span>

@<span class="token function">ViewChild</span><span class="token punctuation">(</span>ImageSliderComponent<span class="token punctuation">)</span> imageSlider<span class="token operator">:</span> ImageSliderComponent
</code></pre></div><p>如果想引用多个模板元素，需要使用 @ViewChildren</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>img
  #img
  <span class="token operator">*</span>ngFor<span class="token operator">=</span><span class="token string">&quot;let slider of sliders&quot;</span>
  <span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;slider.imgUrl&quot;</span>
  <span class="token punctuation">[</span>alt<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;slider.caption&quot;</span>
<span class="token operator">&gt;</span>

@<span class="token function">ViewChildren</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span> imgs<span class="token operator">:</span> QueryList<span class="token operator">&lt;</span>ElementRef<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="获取-dom-节点修改样式"><a href="#获取-dom-节点修改样式" class="header-anchor">#</a> 获取 DOM 节点修改样式</h3> <p>可以通过 Renderer2 去修改样式。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AfterViewInit<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> QueryList<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> ViewChild<span class="token punctuation">,</span> ViewChildren <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ImageSlider</span> <span class="token punctuation">{</span>
  imgUrl<span class="token operator">:</span> <span class="token builtin">string</span>
  link<span class="token operator">:</span> <span class="token builtin">string</span>
  caption<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-image-slider'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./image-slider.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./image-slider.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ImageSliderComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewInit <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> sliders<span class="token operator">:</span> ImageSlider<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// static 是否为静态，在 if 或者 for 中包含的是 false</span>
  @<span class="token function">ViewChild</span><span class="token punctuation">(</span><span class="token string">'imageSlider'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> imgSlider<span class="token operator">:</span> ElementRef
  @<span class="token function">ViewChildren</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span> imgs<span class="token operator">:</span> QueryList<span class="token operator">&lt;</span>ElementRef<span class="token operator">&gt;</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token comment">// 依赖注入</span>
    <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2
  <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token string">'100px'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="双向绑定"><a href="#双向绑定" class="header-anchor">#</a> 双向绑定</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">[value]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(input)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username = $event.target.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>还有 ngModel，是 FormsModel 中提供的指令，需要将其引入。使用 <code>[(ngModel)] = &quot;变量&quot;</code> 形式进行双向绑定。</p> <p>我们也可以自己实现双向绑定，如下代码：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">private</span> _username
<span class="token comment">// 子组件</span>
@<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> usernameChange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

@<span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_username
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">set</span> <span class="token function">username</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_username <span class="token operator">=</span> value
  <span class="token keyword">this</span><span class="token punctuation">.</span>usernameChange<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 父组件</span>
<span class="token operator">&lt;</span>child <span class="token punctuation">[</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <h3 id="ngmodule-注解"><a href="#ngmodule-注解" class="header-anchor">#</a> @NgModule 注解</h3> <ul><li>declarations 数组：为模块拥有的组件、指令或管道。注意每个组件、指令、管道只能在一个模块中声明；</li> <li>providers 数组：是模块中需要使用的服务；</li> <li>exports 数组：暴露给其他模块使用的组件、指令或管道等；</li> <li>imports 数组：导入本模块需要的依赖模块，注意只能是模块；</li></ul> <h3 id="模块的-坑"><a href="#模块的-坑" class="header-anchor">#</a> 模块的 “坑”</h3> <p>导入其他模块时，需要知道使用该模块的目的：</p> <ul><li>如果是组件，那么需要在每一个需要模块都进入导入；</li> <li>如果是服务，那么一般来说在根模块中导入一次即可；</li></ul> <p>需要在每个需要的模块中进行导入的：</p> <ul><li>CommonModule：提供绑定、*ngIf 和 *ngFor 等基础指令，基本上每个模块都需要导入它。</li> <li>FormsModule / ReactiveFormsModule：表单模块需要在每个需要的模块导入。</li> <li>提供组件、指令或管道的模块。</li></ul> <p>只在根模块导入一次的：</p> <ul><li>HttpClientModule / BrowserAnimationsModule / NoopAnimationsModule</li> <li>只提供服务的模块。</li></ul> <h3 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h3> <p>如下例子：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 对字符串</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Emoji</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

    <span class="token keyword">const</span> <span class="token function-variable function">getter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">setter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 1</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>

    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token operator">:</span> getter<span class="token punctuation">,</span>
      <span class="token keyword">set</span><span class="token operator">:</span> setter<span class="token punctuation">,</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      configurable<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对函数</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Confirmable</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> PropertyDescriptor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> original <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value
    descriptor<span class="token punctuation">.</span><span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> allow <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>allow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> descriptor
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Confirmable<span class="token punctuation">,</span> Emoji <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../decorators'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-horizontal-grid'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./horizontal-grid.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./horizontal-grid.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HorizontalGridComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token comment">// 实现自定义注解</span>
  @<span class="token function">Emoji</span><span class="token punctuation">(</span><span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token string">'Hello'</span>

  @<span class="token function">Confirmable</span><span class="token punctuation">(</span><span class="token string">'您确认要执行吗'</span><span class="token punctuation">)</span>
  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击执行'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="组件嵌套和投影组件"><a href="#组件嵌套和投影组件" class="header-anchor">#</a> 组件嵌套和投影组件</h2> <p>避免组件嵌套导致冗余数据和事件传递，可以通过下面几种方式：</p> <ul><li>内容投影</li> <li>路由</li> <li>指令</li> <li>服务</li></ul> <h3 id="投影组件"><a href="#投影组件" class="header-anchor">#</a> 投影组件</h3> <p>投影组件就是 ng-content 标签。简单来说 ng-content 就是动态内容；跟 vue 的插槽是很类似的。如下格式：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-content</span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>样式类/HTML标签/指令<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-content</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>select 可以选择很多，比如选择有 AppGridItem 的指令元素：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-content</span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[AppGridItem]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-content</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>选择 class 还有 span-wrapper 的元素：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-content</span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.span-wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-content</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h2> <h3 id="自定义指令"><a href="#自定义指令" class="header-anchor">#</a> 自定义指令</h3> <p>自定义指令，如下代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">appGridItem</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of channels<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">[src]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">appGridItemImage</span> <span class="token attr-name">[fitMode]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>none<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">appGridItemTitle</span><span class="token punctuation">&gt;</span></span>{{item.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对应指令：appGridItem</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appGridItem]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GridItemDirective</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> elr<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'display'</span><span class="token punctuation">,</span> <span class="token string">'grid'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'grid-template-areas'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'image' 'title'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'place-items'</span><span class="token punctuation">,</span> <span class="token string">'center'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token string">'4rem'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>对应指令：appGridItemImage，可以传递参数。指令跟组件一样，也是有声明周期的。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appGridItemImage]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GridItemImageDirective</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可以接收传入的值</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> appGridItemImage <span class="token operator">=</span> <span class="token string">'2rem'</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> fitMode <span class="token operator">=</span> <span class="token string">'cover'</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> elr<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'grid-srea'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appGridItemImage<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appGridItemImage<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>elr<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">'object-fit'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fitMode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="指令的样式和事件绑定"><a href="#指令的样式和事件绑定" class="header-anchor">#</a> 指令的样式和事件绑定</h3> <p>指令没有模板，指令要寄宿在一个元素之上——宿主（Host）</p> <ul><li>@HostBinding 绑定宿主的属性或者样式</li> <li>@HostListener 绑定宿主的事件</li></ul> <p>如下代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> HostBinding <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appGridItem]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GridItemDirective</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token comment">// 替换下面的写法</span>
  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.display'</span><span class="token punctuation">)</span> display <span class="token operator">=</span> <span class="token string">'grid'</span>
  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.grid-template-areas'</span><span class="token punctuation">)</span> template <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'image' 'title'</span><span class="token template-punctuation string">`</span></span>
  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.place-items'</span><span class="token punctuation">)</span> align <span class="token operator">=</span> <span class="token string">'center'</span>
  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.width'</span><span class="token punctuation">)</span> width <span class="token operator">=</span> <span class="token string">'4rem'</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> elr<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.rd2.setStyle(this.elr.nativeElement, 'display', 'grid')</span>
    <span class="token comment">// this.rd2.setStyle(this.elr.nativeElement, 'grid-template-areas', `'image' 'title'`)</span>
    <span class="token comment">// this.rd2.setStyle(this.elr.nativeElement, 'place-items', 'center')</span>
    <span class="token comment">// this.rd2.setStyle(this.elr.nativeElement, 'width', '4rem')</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>对于如果有外部需要传递参数的可以使用多个装饰器进行修饰，代码如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> HostBinding<span class="token punctuation">,</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appGridItemTitle]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GridItemTitleDirective</span> <span class="token punctuation">{</span>

  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.font-size'</span><span class="token punctuation">)</span> @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> appGridItemTitle <span class="token operator">=</span> <span class="token string">'1rem'</span>
  @<span class="token function">HostBinding</span><span class="token punctuation">(</span><span class="token string">'style.grid-area'</span><span class="token punctuation">)</span> area <span class="token operator">=</span> <span class="token string">'title'</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> elr<span class="token operator">:</span> ElementRef<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="组件中的-host"><a href="#组件中的-host" class="header-anchor">#</a> 组件中的 Host</h3> <p>我们在组件的样式中直接写：
是作用在组件的样式。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">:host</span> <span class="token punctuation">{</span>
  <span class="token comment">/*  */</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <h3 id="路径参数配置以及路由配置"><a href="#路径参数配置以及路由配置" class="header-anchor">#</a> 路径参数配置以及路由配置</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Routes<span class="token punctuation">,</span> RouterModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HomeContainerComponent<span class="token punctuation">,</span> HomeDetailComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./components'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> HomeContainerComponent<span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">/**
         * 路由节点可以没有 component
         * 一般用于重定向到一个默认子路由
         */</span>
        path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        redirectTo<span class="token operator">:</span> <span class="token string">'hot'</span><span class="token punctuation">,</span>
        pathMatch<span class="token operator">:</span> <span class="token string">'full'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">/**
         * 路径参数，看起来是 URL 的一部分
         */</span>
        path<span class="token operator">:</span> <span class="token string">':tabLink'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> HomeDetailComponent
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>RouterModule<span class="token punctuation">.</span><span class="token function">forChild</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>RouterModule<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeRoutingModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="激活路由"><a href="#激活路由" class="header-anchor">#</a> 激活路由</h3> <ul><li>导航式：通过 routerLink 属性：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">[routerLink]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[<span class="token punctuation">'</span>home<span class="token punctuation">'</span>, <span class="token punctuation">'</span>hot<span class="token punctuation">'</span>, { name: <span class="token punctuation">'</span>val1<span class="token punctuation">'</span> }]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>热门<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意，routerLinkActive 属性跟 react router 一样，是给激活的路由添加一个 active 的类。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">[routerLink]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[<span class="token punctuation">'</span>grand<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">routerLinkActive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>active<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>编程式导航</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'home'</span><span class="token punctuation">,</span> <span class="token string">'hot'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'val1'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>URL: http://localhost:4200/home/hot;name=val1</p> <p>读取参数：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActivatedRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeDetailComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> route<span class="token operator">:</span> ActivatedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 路径参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>paramMap<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>params <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectedTabLink <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'tabLink'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>如果是通过 queryParams 传递参数：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">[routerLink]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[<span class="token punctuation">'</span>/home<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[queryParams]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> {</span> <span class="token attr-name"><span class="token namespace">name:</span></span> <span class="token attr-name">'val1'</span> <span class="token attr-name">}</span><span class="token punctuation">&gt;</span></span>热门<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'home'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> queryParams<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'val1'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>URL: http://localhost:4200/home?name=val1</p> <p>读取参数：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActivatedRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeDetailComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> route<span class="token operator">:</span> ActivatedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">.</span>queryParamMap<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>params <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectedTabLink <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'tabLink'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="管道"><a href="#管道" class="header-anchor">#</a> 管道</h2> <p>自定义管道：ng g p 管道名称；</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Pipe<span class="token punctuation">,</span> PipeTransform <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Pipe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ago'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AgoPipe</span> <span class="token keyword">implements</span> <span class="token class-name">PipeTransform</span> <span class="token punctuation">{</span>

  <span class="token function">transform</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> seconds <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>seconds <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'刚刚'</span>
      <span class="token punctuation">}</span> 

      <span class="token keyword">const</span> intervals <span class="token operator">=</span> <span class="token punctuation">{</span>
         年<span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">365</span><span class="token punctuation">,</span>
         月<span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>
         周<span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span>
         天<span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">,</span>
         小时<span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
         分钟<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
         秒<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> unitName <span class="token keyword">in</span> intervals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>unitName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> unitValue <span class="token operator">=</span> intervals<span class="token punctuation">[</span>unitName<span class="token punctuation">]</span>
          counter <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>seconds <span class="token operator">/</span> unitValue<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>unitName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 前</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h2 id="依赖注入"><a href="#依赖注入" class="header-anchor">#</a> 依赖注入</h2> <p>我们在组件中使用服务的时候，直接是在组件的构造函数中通过属性的形式注入到组件中：没有通过 new 实例化，我们在组件中就可以直接使用。这其实就是依赖注入。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> route<span class="token operator">:</span> ActivatedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="自定义注入类"><a href="#自定义注入类" class="header-anchor">#</a> 自定义注入类</h3> <p>我们自定义一个服务，首先需要标记服务为 @injectable() 标记为可输入的服务，然后在模块中 provides 数组或则 import 对应模块进行声明。最后就可以在组件的构造函数中声明使用，angular 框架会帮你完成服务的注入。</p> <p>如下例子，是在组件中实现一个依赖注入：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Injectable<span class="token punctuation">,</span> Injector<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">PurchaseOrder</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> amount<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> product<span class="token operator">:</span> Product
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-home-grand'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./home-grand.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./home-grand.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeGrandComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> injector <span class="token operator">=</span> Injector<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> Product<span class="token punctuation">,</span>
          <span class="token comment">// useClass: Product,</span>
          <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">'j'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> PurchaseOrder<span class="token punctuation">,</span>
          useClass<span class="token operator">:</span> PurchaseOrder<span class="token punctuation">,</span>
          <span class="token comment">// 依赖</span>
          deps<span class="token operator">:</span> <span class="token punctuation">[</span>
            Product
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 获取</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>injector<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>Product<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>injector<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>PurchaseOrder<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="通过模块的形式进行注入"><a href="#通过模块的形式进行注入" class="header-anchor">#</a> 通过模块的形式进行注入</h3> <p>我们写一个依赖注入的时候，是不需要这样的引入的，可以直接在模块的 providers 数组中进行引入（如果是 useClass），如果是 useFactory 的服务：
如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    PurchaseOrder<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> Product<span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">'j'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="注入数值"><a href="#注入数值" class="header-anchor">#</a> 注入数值</h3> <p>当然我们可以注入一个数值；如下代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> injector <span class="token operator">=</span> Injector<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> <span class="token string">'baseUrl'</span><span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> <span class="token string">'http://localhost:3000/api'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样注入一个值是不太好的，因为如果项目很大；会出现重名。我们可以通过创建一个 InjectionToken，angular 框架会进行处理；避免冲突。如下代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InjectionToken<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">'baseUrl'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> injector <span class="token operator">=</span> Injector<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          provide<span class="token operator">:</span> token<span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> <span class="token string">'http://localhost:3000/api'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>可以将一个值通过在模块中进行注册，然后在组件中使用，如下代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./services'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> token<span class="token punctuation">,</span>
      useValue<span class="token operator">:</span> <span class="token string">'http://api'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

</code></pre></div><p>组件中使用：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Inject<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../services'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-home-container'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./home-container.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./home-container.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeContainerComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    @<span class="token function">Inject</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token keyword">private</span> baseUrl<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token punctuation">,</span> <span class="token string">'baseUrl'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>一般我们写注入，会使用：注入到根模块，每个模块都可以使用，推荐写法。就不用将注入的服务放入到模块的 providers 中。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">'root'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果需要注入到指定模块：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> HomeModule
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="脏值检测"><a href="#脏值检测" class="header-anchor">#</a> 脏值检测</h2> <p>什么是脏值检测：</p> <ul><li>首先脏值检测就是当数据改变时进行更新视图。类似其他框架，比如 vue 是使用数据代理。进行监听数值变化去生成虚拟 dom 更新视图。而 react 是直接刷新视图。</li></ul> <p>什么时候会触发：</p> <ul><li>浏览器事件（如 click、mouseover、keyup 等）</li> <li>setTimeout 和 setInterval</li> <li>http 请求</li></ul> <p>如何进行检测：检查两个状态值：当前状态和新状态。</p> <p>angular 会根据视图中 dom 绑定属性生成一个绑定的一个树状结构（就是哪个属性绑定哪个值的一种对象结构，绑定名，绑定表达式），从根组件到子组件。对于检查是单向的数据流。</p> <p><img src="/note/assets/img/znangzhi.1c9ab440.png" alt="avatar"></p> <p>对于组件的声明周期中。也有脏值检测过程。我们一般是在更新 DOM 之前进行数值属性的绑定，以避免引起无线循环的脏值检测。</p> <p><img src="/note/assets/img/zujian.2bbc6bf7.png" alt="avatar"></p> <p>如下代码，会导致无限循环，抛出异常：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> AfterViewInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-child'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./child.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./child.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewInit <span class="token punctuation">{</span>
  _title
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'脏值检测'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title
  <span class="token punctuation">}</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hi'</span>
  <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hee'</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// ERROR Error: ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value for 'textContent': 'hi'. Current value: 'hee'</span>
</code></pre></div><p>如果我们需要在脏值检测之后重新赋值，可以使用 ngZone 来实现; Zone 是一种用于拦截和跟踪异步工作的机制；Zone.js 将会对每一个异步操作创建一个 task。一个 task 运行于一个 Zone 中。通常来说， 在 Angular 应用中，每个 task 都会在 “Angular” Zone 中运行，这个 Zone 被称为 NgZone。一个 Angular 应用中只存在一个 Angular Zone，而变更检测只会由运行于这个 NgZone 中的异步操作触发。如下代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> AfterViewChecked<span class="token punctuation">,</span> NgZone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-child'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./child.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./child.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewChecked <span class="token punctuation">{</span>
  _title
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'脏值检测'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title
  <span class="token punctuation">}</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> ngZone<span class="token operator">:</span> NgZone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hi'</span>
  <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 运行在 angular 之外的 task</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ngZone<span class="token punctuation">.</span><span class="token function">runOutsideAngular</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hee'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>具体场景：倒计时展示；</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> formatDate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> AfterViewChecked<span class="token punctuation">,</span> NgZone<span class="token punctuation">,</span> ViewChild<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-child'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./child.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./child.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewChecked <span class="token punctuation">{</span>
  _title
  _time
  @<span class="token function">ViewChild</span><span class="token punctuation">(</span><span class="token string">'timeRef'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> timeRef<span class="token operator">:</span> ElementRef
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'脏值检测'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title
  <span class="token punctuation">}</span>

  
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_time
  <span class="token punctuation">}</span>
  
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> ngZone<span class="token operator">:</span> NgZone<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hi'</span>
  <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 运行在 angular 之外的 task</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ngZone<span class="token punctuation">.</span><span class="token function">runOutsideAngular</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// this.timeRef.nativeElement.innerText = Date.now()</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rd2<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>timeRef<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span>
          <span class="token string">'innerText'</span><span class="token punctuation">,</span>
          <span class="token function">formatDate</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'HH:mm:ss:SSS'</span><span class="token punctuation">,</span> <span class="token string">'en-US'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>注意这里的细节，可以在 Renderer2 中使用管道。</p> <p>脏值检测的检查是如果整个树结构有值的变化，那么脏值检测会将整个树结构跑一遍。如果树很大，会引起性能问题。可以使用脏值检测的 OnPush 策略去优化。 OnPush 策略是只对有 @input 注解的组件进行脏值检测。如果注解的值改变就会引发一次脏值检测。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> formatDate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> AfterViewChecked<span class="token punctuation">,</span> NgZone<span class="token punctuation">,</span> ViewChild<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> Renderer2<span class="token punctuation">,</span> ChangeDetectionStrategy<span class="token punctuation">,</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-child'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./child.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./child.component.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  changeDetection<span class="token operator">:</span> ChangeDetectionStrategy<span class="token punctuation">.</span>OnPush
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewChecked <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'脏值检测'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title
  <span class="token punctuation">}</span>

  
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_time
  <span class="token punctuation">}</span>
  
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> ngZone<span class="token operator">:</span> NgZone<span class="token punctuation">,</span> <span class="token keyword">private</span> rd2<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> <span class="token string">'hi'</span>
  <span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>他在之后 Input 的 str 属性改变的时候才会触发脏值检测进行更新页面。如果我们想强制更新。可以使用下面的方法：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> formatDate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> ChangeDetectionStrategy<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> ChangeDetectorRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-child'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./child.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./child.component.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  changeDetection<span class="token operator">:</span> ChangeDetectionStrategy<span class="token punctuation">.</span>OnPush
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewChecked <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> cd<span class="token operator">:</span> ChangeDetectorRef<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 手动触发，进行脏值检测</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cd<span class="token punctuation">.</span><span class="token function">markForCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新:</span> <span class="time">4/15/2021, 9:30:45 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/angular/基础.html" class="prev">
        基础
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.981df038.js" defer></script><script src="/note/assets/js/2.311cbb04.js" defer></script><script src="/note/assets/js/29.930561ae.js" defer></script>
  </body>
</html>
