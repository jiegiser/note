<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>颜色与纹理 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/note/assets/css/0.styles.747e5b72.css" as="style"><link rel="preload" href="/note/assets/js/app.cf3e5064.js" as="script"><link rel="preload" href="/note/assets/js/2.bfd5325d.js" as="script"><link rel="preload" href="/note/assets/js/6.b5c9cb4a.js" as="script"><link rel="preload" href="/note/assets/js/72.8b48baa3.js" as="script"><link rel="prefetch" href="/note/assets/js/10.5b570012.js"><link rel="prefetch" href="/note/assets/js/100.abff1e60.js"><link rel="prefetch" href="/note/assets/js/101.f660807a.js"><link rel="prefetch" href="/note/assets/js/102.4be025c2.js"><link rel="prefetch" href="/note/assets/js/103.80751001.js"><link rel="prefetch" href="/note/assets/js/104.c43e1876.js"><link rel="prefetch" href="/note/assets/js/105.fe3fa11b.js"><link rel="prefetch" href="/note/assets/js/106.f9c1e1e3.js"><link rel="prefetch" href="/note/assets/js/107.e8c81c17.js"><link rel="prefetch" href="/note/assets/js/108.d359af3a.js"><link rel="prefetch" href="/note/assets/js/109.a1c55d4f.js"><link rel="prefetch" href="/note/assets/js/11.6f02981e.js"><link rel="prefetch" href="/note/assets/js/110.6762c8c8.js"><link rel="prefetch" href="/note/assets/js/111.63b121ff.js"><link rel="prefetch" href="/note/assets/js/112.8326a98e.js"><link rel="prefetch" href="/note/assets/js/113.1edf66c2.js"><link rel="prefetch" href="/note/assets/js/114.ec216974.js"><link rel="prefetch" href="/note/assets/js/115.4270d4a6.js"><link rel="prefetch" href="/note/assets/js/116.743dfd44.js"><link rel="prefetch" href="/note/assets/js/117.cc27d9d7.js"><link rel="prefetch" href="/note/assets/js/118.ac64d1d6.js"><link rel="prefetch" href="/note/assets/js/119.0656c733.js"><link rel="prefetch" href="/note/assets/js/12.923e92f3.js"><link rel="prefetch" href="/note/assets/js/120.0eb2138d.js"><link rel="prefetch" href="/note/assets/js/121.042e272f.js"><link rel="prefetch" href="/note/assets/js/122.98e4aa07.js"><link rel="prefetch" href="/note/assets/js/123.dbc3ed9f.js"><link rel="prefetch" href="/note/assets/js/124.c955db94.js"><link rel="prefetch" href="/note/assets/js/125.521072ee.js"><link rel="prefetch" href="/note/assets/js/126.7a80b4bc.js"><link rel="prefetch" href="/note/assets/js/127.5b85438d.js"><link rel="prefetch" href="/note/assets/js/128.fa15b8e4.js"><link rel="prefetch" href="/note/assets/js/129.5f9a58f0.js"><link rel="prefetch" href="/note/assets/js/13.8c82174c.js"><link rel="prefetch" href="/note/assets/js/130.acb79e4a.js"><link rel="prefetch" href="/note/assets/js/131.1e665b20.js"><link rel="prefetch" href="/note/assets/js/132.3f06dbb2.js"><link rel="prefetch" href="/note/assets/js/133.b9c8ccd6.js"><link rel="prefetch" href="/note/assets/js/134.47501964.js"><link rel="prefetch" href="/note/assets/js/135.594267d4.js"><link rel="prefetch" href="/note/assets/js/136.fefb3e1d.js"><link rel="prefetch" href="/note/assets/js/137.d4877c2a.js"><link rel="prefetch" href="/note/assets/js/138.29686b5c.js"><link rel="prefetch" href="/note/assets/js/139.0790c0bf.js"><link rel="prefetch" href="/note/assets/js/14.94ac989e.js"><link rel="prefetch" href="/note/assets/js/140.4107c12b.js"><link rel="prefetch" href="/note/assets/js/141.c6d2fe3b.js"><link rel="prefetch" href="/note/assets/js/142.8742c2a7.js"><link rel="prefetch" href="/note/assets/js/143.f8c67711.js"><link rel="prefetch" href="/note/assets/js/144.f6a56d7c.js"><link rel="prefetch" href="/note/assets/js/145.d986cfcf.js"><link rel="prefetch" href="/note/assets/js/146.cda26ec4.js"><link rel="prefetch" href="/note/assets/js/147.fbaf09b3.js"><link rel="prefetch" href="/note/assets/js/148.24a17e54.js"><link rel="prefetch" href="/note/assets/js/149.5aa4395d.js"><link rel="prefetch" href="/note/assets/js/15.64e08857.js"><link rel="prefetch" href="/note/assets/js/150.b1a02410.js"><link rel="prefetch" href="/note/assets/js/151.da215993.js"><link rel="prefetch" href="/note/assets/js/152.a058bb87.js"><link rel="prefetch" href="/note/assets/js/153.163e5828.js"><link rel="prefetch" href="/note/assets/js/154.f98e9fc9.js"><link rel="prefetch" href="/note/assets/js/155.2daf69c5.js"><link rel="prefetch" href="/note/assets/js/156.0e244f81.js"><link rel="prefetch" href="/note/assets/js/157.bad7f892.js"><link rel="prefetch" href="/note/assets/js/158.f036d261.js"><link rel="prefetch" href="/note/assets/js/159.d0a4a509.js"><link rel="prefetch" href="/note/assets/js/16.01613856.js"><link rel="prefetch" href="/note/assets/js/160.8062db90.js"><link rel="prefetch" href="/note/assets/js/161.79e18696.js"><link rel="prefetch" href="/note/assets/js/162.bc94ff67.js"><link rel="prefetch" href="/note/assets/js/163.c0768380.js"><link rel="prefetch" href="/note/assets/js/164.c709e7fe.js"><link rel="prefetch" href="/note/assets/js/165.643eee0f.js"><link rel="prefetch" href="/note/assets/js/166.c7a2158f.js"><link rel="prefetch" href="/note/assets/js/167.b4eb4b44.js"><link rel="prefetch" href="/note/assets/js/168.2347d827.js"><link rel="prefetch" href="/note/assets/js/169.e4fd4d1c.js"><link rel="prefetch" href="/note/assets/js/17.3a3a17bd.js"><link rel="prefetch" href="/note/assets/js/170.4aba72db.js"><link rel="prefetch" href="/note/assets/js/171.f02e5a8b.js"><link rel="prefetch" href="/note/assets/js/172.6571415c.js"><link rel="prefetch" href="/note/assets/js/173.95b0908a.js"><link rel="prefetch" href="/note/assets/js/174.12005dea.js"><link rel="prefetch" href="/note/assets/js/175.9bab507a.js"><link rel="prefetch" href="/note/assets/js/176.0c6b7384.js"><link rel="prefetch" href="/note/assets/js/177.bb8069cc.js"><link rel="prefetch" href="/note/assets/js/178.a72546b4.js"><link rel="prefetch" href="/note/assets/js/179.b7e8c5b0.js"><link rel="prefetch" href="/note/assets/js/18.523e447e.js"><link rel="prefetch" href="/note/assets/js/180.a1083de9.js"><link rel="prefetch" href="/note/assets/js/181.dfb679fd.js"><link rel="prefetch" href="/note/assets/js/182.38258cdd.js"><link rel="prefetch" href="/note/assets/js/183.d2c255d5.js"><link rel="prefetch" href="/note/assets/js/184.85111a7a.js"><link rel="prefetch" href="/note/assets/js/185.849a961d.js"><link rel="prefetch" href="/note/assets/js/186.2b228da7.js"><link rel="prefetch" href="/note/assets/js/187.fc00f846.js"><link rel="prefetch" href="/note/assets/js/19.3aace9e7.js"><link rel="prefetch" href="/note/assets/js/20.47c5fed8.js"><link rel="prefetch" href="/note/assets/js/21.a3a950f4.js"><link rel="prefetch" href="/note/assets/js/22.b173613b.js"><link rel="prefetch" href="/note/assets/js/23.793556aa.js"><link rel="prefetch" href="/note/assets/js/24.a7179974.js"><link rel="prefetch" href="/note/assets/js/25.0172ba4b.js"><link rel="prefetch" href="/note/assets/js/26.29d78bab.js"><link rel="prefetch" href="/note/assets/js/27.e828d7aa.js"><link rel="prefetch" href="/note/assets/js/28.76c07f36.js"><link rel="prefetch" href="/note/assets/js/29.21d37a62.js"><link rel="prefetch" href="/note/assets/js/3.2f8c4349.js"><link rel="prefetch" href="/note/assets/js/30.a71629ca.js"><link rel="prefetch" href="/note/assets/js/31.5406b7e7.js"><link rel="prefetch" href="/note/assets/js/32.34ad0e3f.js"><link rel="prefetch" href="/note/assets/js/33.59711af3.js"><link rel="prefetch" href="/note/assets/js/34.23a2bc54.js"><link rel="prefetch" href="/note/assets/js/35.870b8ef7.js"><link rel="prefetch" href="/note/assets/js/36.0c624297.js"><link rel="prefetch" href="/note/assets/js/37.afdde6da.js"><link rel="prefetch" href="/note/assets/js/38.d4a78c75.js"><link rel="prefetch" href="/note/assets/js/39.052ee3ae.js"><link rel="prefetch" href="/note/assets/js/4.12a10528.js"><link rel="prefetch" href="/note/assets/js/40.18757722.js"><link rel="prefetch" href="/note/assets/js/41.2e4f15f2.js"><link rel="prefetch" href="/note/assets/js/42.63cea5ec.js"><link rel="prefetch" href="/note/assets/js/43.5187dca8.js"><link rel="prefetch" href="/note/assets/js/44.58cb40cb.js"><link rel="prefetch" href="/note/assets/js/45.1205afaf.js"><link rel="prefetch" href="/note/assets/js/46.54dc8625.js"><link rel="prefetch" href="/note/assets/js/47.aa364922.js"><link rel="prefetch" href="/note/assets/js/48.4e333104.js"><link rel="prefetch" href="/note/assets/js/49.431de4d8.js"><link rel="prefetch" href="/note/assets/js/5.b877f58b.js"><link rel="prefetch" href="/note/assets/js/50.cee7b6f3.js"><link rel="prefetch" href="/note/assets/js/51.f8b65632.js"><link rel="prefetch" href="/note/assets/js/52.2bb9e3ed.js"><link rel="prefetch" href="/note/assets/js/53.cd3b8287.js"><link rel="prefetch" href="/note/assets/js/54.553a0071.js"><link rel="prefetch" href="/note/assets/js/55.f3338279.js"><link rel="prefetch" href="/note/assets/js/56.9f066da7.js"><link rel="prefetch" href="/note/assets/js/57.ccc8b097.js"><link rel="prefetch" href="/note/assets/js/58.4581bacf.js"><link rel="prefetch" href="/note/assets/js/59.4d096266.js"><link rel="prefetch" href="/note/assets/js/60.af34f739.js"><link rel="prefetch" href="/note/assets/js/61.af3b0215.js"><link rel="prefetch" href="/note/assets/js/62.ce9c89b2.js"><link rel="prefetch" href="/note/assets/js/63.2b8bdcbb.js"><link rel="prefetch" href="/note/assets/js/64.d969ba5b.js"><link rel="prefetch" href="/note/assets/js/65.015afe58.js"><link rel="prefetch" href="/note/assets/js/66.42134bd7.js"><link rel="prefetch" href="/note/assets/js/67.07301389.js"><link rel="prefetch" href="/note/assets/js/68.443118b0.js"><link rel="prefetch" href="/note/assets/js/69.b9ad84be.js"><link rel="prefetch" href="/note/assets/js/7.634707c5.js"><link rel="prefetch" href="/note/assets/js/70.567a2f00.js"><link rel="prefetch" href="/note/assets/js/71.2dc8fd6f.js"><link rel="prefetch" href="/note/assets/js/73.6358d7ad.js"><link rel="prefetch" href="/note/assets/js/74.e14f45f8.js"><link rel="prefetch" href="/note/assets/js/75.76fc6e70.js"><link rel="prefetch" href="/note/assets/js/76.b570111b.js"><link rel="prefetch" href="/note/assets/js/77.f1dd74e8.js"><link rel="prefetch" href="/note/assets/js/78.15027c45.js"><link rel="prefetch" href="/note/assets/js/79.d7d6e1f3.js"><link rel="prefetch" href="/note/assets/js/8.7ccf6894.js"><link rel="prefetch" href="/note/assets/js/80.6fc12724.js"><link rel="prefetch" href="/note/assets/js/81.10c11c71.js"><link rel="prefetch" href="/note/assets/js/82.82e94675.js"><link rel="prefetch" href="/note/assets/js/83.99fa6a0f.js"><link rel="prefetch" href="/note/assets/js/84.30acd353.js"><link rel="prefetch" href="/note/assets/js/85.ca05377d.js"><link rel="prefetch" href="/note/assets/js/86.39411dc5.js"><link rel="prefetch" href="/note/assets/js/87.220e7702.js"><link rel="prefetch" href="/note/assets/js/88.9abd6b14.js"><link rel="prefetch" href="/note/assets/js/89.c56cb90d.js"><link rel="prefetch" href="/note/assets/js/9.b37c6d7c.js"><link rel="prefetch" href="/note/assets/js/90.44b2562f.js"><link rel="prefetch" href="/note/assets/js/91.fcfa145c.js"><link rel="prefetch" href="/note/assets/js/92.9e729c74.js"><link rel="prefetch" href="/note/assets/js/93.bc12e45e.js"><link rel="prefetch" href="/note/assets/js/94.e31b24e3.js"><link rel="prefetch" href="/note/assets/js/95.f1962ded.js"><link rel="prefetch" href="/note/assets/js/96.f5ee3bda.js"><link rel="prefetch" href="/note/assets/js/97.ef9301d2.js"><link rel="prefetch" href="/note/assets/js/98.1149dd77.js"><link rel="prefetch" href="/note/assets/js/99.93de9837.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.747e5b72.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/angular/基础.html" class="nav-link">
  angular
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/js-gc/数据类型.html" class="nav-link">
  红宝书
</a></div><div class="nav-item"><a href="/note/interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/angular/基础.html" class="nav-link">
  angular
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/js-gc/数据类型.html" class="nav-link">
  红宝书
</a></div><div class="nav-item"><a href="/note/interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div><div class="nav-item"><a href="/note/js-algorithm/栈.html" class="nav-link">
  算法与数据结构
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/graphics/图形学基础.html" class="sidebar-link">图形学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/图形学基础.html#图形学基础" class="sidebar-link">图形学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/图形学基础.html#三角形网格" class="sidebar-link">三角形网格</a></li></ul></li></ul></li><li><a href="/note/graphics/数学基础.html" class="sidebar-link">数学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#数学基础" class="sidebar-link">数学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#什么是向量" class="sidebar-link">什么是向量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#三维直角坐标系" class="sidebar-link">三维直角坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的表示" class="sidebar-link">向量的表示</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量乘以常数" class="sidebar-link">向量乘以常数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的长度" class="sidebar-link">向量的长度</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#线性组合" class="sidebar-link">线性组合</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#单位圆" class="sidebar-link">单位圆</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#弧度和角度" class="sidebar-link">弧度和角度</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#极坐标" class="sidebar-link">极坐标</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#极坐标系" class="sidebar-link">极坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#三角函数的性质" class="sidebar-link">三角函数的性质</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#旋转" class="sidebar-link">旋转</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的叉乘" class="sidebar-link">向量的叉乘</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_2d-叉乘符号的含义" class="sidebar-link">2d 叉乘符号的含义</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_3d-向量叉乘" class="sidebar-link">3d 向量叉乘</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_3d-叉乘的意义" class="sidebar-link">3D 叉乘的意义</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#矩阵" class="sidebar-link">矩阵</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl基础.html" class="sidebar-link">webgl基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-基础" class="sidebar-link">webGL 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-程序的结构" class="sidebar-link">webGL 程序的结构</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-渲染管线" class="sidebar-link">webgl 渲染管线</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#渲染过程" class="sidebar-link">渲染过程</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#glsl" class="sidebar-link">GLSL</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-坐标系统" class="sidebar-link">webgl 坐标系统</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-机制-缓冲区对象-buffer-object" class="sidebar-link">webgl 机制 —— 缓冲区对象（buffer object）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#移动、旋转、缩放" class="sidebar-link">移动、旋转、缩放</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl高级变换与动画基础.html" class="sidebar-link">webgl高级变换与动画基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级变换与动画基础.html#动画" class="sidebar-link">动画</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级变换与动画基础.html#requestanimationframe-方法" class="sidebar-link">requestAnimationFrame 方法</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl颜色与纹理.html" class="active sidebar-link">webgl颜色与纹理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#颜色与纹理" class="sidebar-link">颜色与纹理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#将非坐标数据传入顶点着色器" class="sidebar-link">将非坐标数据传入顶点着色器</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#顶点着色器与片元着色器之间通讯" class="sidebar-link">顶点着色器与片元着色器之间通讯</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#彩色三角形-几何形状的装配和光栅化" class="sidebar-link">彩色三角形——几何形状的装配和光栅化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#几何形状的装配和光栅化" class="sidebar-link">几何形状的装配和光栅化</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#调用片元着色器" class="sidebar-link">调用片元着色器</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#varying-变量的作用和内插过程" class="sidebar-link">varying 变量的作用和内插过程</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#矩形表面贴上图像" class="sidebar-link">矩形表面贴上图像</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#使用多幅纹理" class="sidebar-link">使用多幅纹理</a></li></ul></li></ul></li><li><a href="/note/graphics/OpenGLES着色器语言.html" class="sidebar-link">OpenGLES着色器语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#glsl-es-概述" class="sidebar-link">GLSL ES 概述</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#执行次序" class="sidebar-link">执行次序</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#注释" class="sidebar-link">注释</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#数据值类型-数值和布尔值" class="sidebar-link">数据值类型（数值和布尔值）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#变量" class="sidebar-link">变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#glsl-es-是强类型语言" class="sidebar-link">GLSL ES 是强类型语言</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#基本类型" class="sidebar-link">基本类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和类型转换" class="sidebar-link">赋值和类型转换</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符" class="sidebar-link">运算符</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矢量和矩阵" class="sidebar-link">矢量和矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和构造" class="sidebar-link">赋值和构造</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矢量构造函数" class="sidebar-link">矢量构造函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵构造函数" class="sidebar-link">矩阵构造函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#访问元素" class="sidebar-link">访问元素</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-2" class="sidebar-link">运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-3" class="sidebar-link">[] 运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-4" class="sidebar-link">运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵右乘矢量" class="sidebar-link">矩阵右乘矢量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵左乘矢量" class="sidebar-link">矩阵左乘矢量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵与矩阵相乘" class="sidebar-link">矩阵与矩阵相乘</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#结构体" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和构造-2" class="sidebar-link">赋值和构造</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#访问成员" class="sidebar-link">访问成员</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-5" class="sidebar-link">运算符</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#数组" class="sidebar-link">数组</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#取样器-纹理" class="sidebar-link">取样器（纹理）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符优先级" class="sidebar-link">运算符优先级</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#程序流程控制-分支和循环" class="sidebar-link">程序流程控制：分支和循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#if-语句和-if-else-语句" class="sidebar-link">if 语句和 if-else 语句</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#for-语句" class="sidebar-link">for 语句</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#continue、break-和-discard-语句" class="sidebar-link">continue、break 和 discard 语句</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#规范声明" class="sidebar-link">规范声明</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#参数限定词" class="sidebar-link">参数限定词</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#内置函数" class="sidebar-link">内置函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#存储限定字" class="sidebar-link">存储限定字</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#const-变量" class="sidebar-link">const 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#attribute-变量" class="sidebar-link">Attribute 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#uniform-变量" class="sidebar-link">uniform 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#varying-变量" class="sidebar-link">varying 变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#精度限定字" class="sidebar-link">精度限定字</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#预处理指令" class="sidebar-link">预处理指令</a></li></ul></li><li><a href="/note/graphics/webgl投影矩阵.html" class="sidebar-link">webgl投影矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#透视投影推导" class="sidebar-link">透视投影推导</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#视椎体" class="sidebar-link">视椎体</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#投影矩阵的本质" class="sidebar-link">投影矩阵的本质</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#投影矩阵推导" class="sidebar-link">投影矩阵推导</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#正交投影推导" class="sidebar-link">正交投影推导</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#示例代码" class="sidebar-link">示例代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#透视投影" class="sidebar-link">透视投影</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl投影矩阵.html#正射投影" class="sidebar-link">正射投影</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl视图矩阵.html" class="sidebar-link">webgl视图矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl视图矩阵.html#视图矩阵" class="sidebar-link">视图矩阵</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl视图矩阵.html#示例代码" class="sidebar-link">示例代码</a></li></ul></li><li><a href="/note/graphics/webgl三维世界.html" class="sidebar-link">webgl三维世界</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#立方体绘制" class="sidebar-link">立方体绘制</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#视点和视线" class="sidebar-link">视点和视线</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#视点、观察目标点和上方向" class="sidebar-link">视点、观察目标点和上方向</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#从指定视点观察旋转后的三角形" class="sidebar-link">从指定视点观察旋转后的三角形</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#使用键盘改变视点" class="sidebar-link">使用键盘改变视点</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#可视范围-正射类型" class="sidebar-link">可视范围（正射类型）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#可视空间" class="sidebar-link">可视空间</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#定义盒状可视空间" class="sidebar-link">定义盒状可视空间</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#结合视图矩阵正射投影矩阵" class="sidebar-link">结合视图矩阵正射投影矩阵</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#可视空间-透视投影" class="sidebar-link">可视空间（透视投影）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#定义透视投影可视空间" class="sidebar-link">定义透视投影可视空间</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#视图矩阵、模型矩阵和投影矩阵" class="sidebar-link">视图矩阵、模型矩阵和投影矩阵</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#正确处理对象的前后关系" class="sidebar-link">正确处理对象的前后关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#隐藏面消失" class="sidebar-link">隐藏面消失</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#示例代码-清除深度缓冲区" class="sidebar-link">示例代码（清除深度缓冲区）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#深度冲突" class="sidebar-link">深度冲突</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#立方体" class="sidebar-link">立方体</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#通过顶点索引绘制物体" class="sidebar-link">通过顶点索引绘制物体</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl三维世界.html#为立方体的每个面指定颜色" class="sidebar-link">为立方体的每个面指定颜色</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl光照.html" class="sidebar-link">webgl光照</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#光照原理" class="sidebar-link">光照原理</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#光源类型" class="sidebar-link">光源类型</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#反射类型" class="sidebar-link">反射类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#漫反射" class="sidebar-link">漫反射</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#环境反射" class="sidebar-link">环境反射</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#平行光下的漫反射" class="sidebar-link">平行光下的漫反射</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#法线-表面的朝向" class="sidebar-link">法线：表面的朝向</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#漫反射模型" class="sidebar-link">漫反射模型</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#示例代码" class="sidebar-link">示例代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#环境光下的漫反射" class="sidebar-link">环境光下的漫反射</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#运动物体的光照效果" class="sidebar-link">运动物体的光照效果</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#逆转置矩阵" class="sidebar-link">逆转置矩阵</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#示例程序" class="sidebar-link">示例程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#点光源" class="sidebar-link">点光源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#示例代码-2" class="sidebar-link">示例代码</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#逐片元光照" class="sidebar-link">逐片元光照</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl光照.html#phong-光照模型" class="sidebar-link">Phong 光照模型</a></li></ul></li><li><a href="/note/graphics/webgl层次模型.html" class="sidebar-link">webgl层次模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#多个简单模型组成的复杂模型" class="sidebar-link">多个简单模型组成的复杂模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#层次结构模型" class="sidebar-link">层次结构模型</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#实例代码" class="sidebar-link">实例代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#着色器和着色器程序对象" class="sidebar-link">着色器和着色器程序对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#创建着色器对象-gl-createshader-type" class="sidebar-link">创建着色器对象 (gl.createShader(type))</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#指定着色器对象的代码-gl-shandersource-shader-source" class="sidebar-link">指定着色器对象的代码 (gl.shanderSource(shader, source))</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#编译着色器-gl-compileshader-shader" class="sidebar-link">编译着色器 (gl.compileShader(shader))</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#创建程序对象-gl-createprogram" class="sidebar-link">创建程序对象 (gl.createProgram())</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#为程序对象分配着色器对象-gl-attachshader-program-shader" class="sidebar-link">为程序对象分配着色器对象 (gl.attachShader(program, shader))</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#连接程序对象-gl-linkprogram" class="sidebar-link">连接程序对象 (gl.linkProgram())</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#告知-webgl-系统所使用的程序对象-gl-useprogram" class="sidebar-link">告知 webgl 系统所使用的程序对象 (gl.useProgram())</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl层次模型.html#初始化着色器代码" class="sidebar-link">初始化着色器代码</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl高级技术.html" class="sidebar-link">webgl高级技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级技术.html#用鼠标控制物体旋转" class="sidebar-link">用鼠标控制物体旋转</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级技术.html#对象拾取" class="sidebar-link">对象拾取</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级技术.html#拾取立方体的一个表面" class="sidebar-link">拾取立方体的一个表面</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级技术.html#uhd-平视显示器" class="sidebar-link">UHD 平视显示器</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级技术.html#雾化-大气效果" class="sidebar-link">雾化（大气效果）</a></li></ul></li><li><a href="/note/graphics/threejs基础.html" class="sidebar-link">threejs基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#例子-渲染三角形" class="sidebar-link">例子-渲染三角形</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#世界坐标系到观察者坐标系" class="sidebar-link">世界坐标系到观察者坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#视图矩阵" class="sidebar-link">视图矩阵</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#投影矩阵" class="sidebar-link">投影矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#透视投影" class="sidebar-link">透视投影</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#正交投影" class="sidebar-link">正交投影</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#正交相机" class="sidebar-link">正交相机</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#shadow" class="sidebar-link">shadow</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="颜色与纹理"><a href="#颜色与纹理" class="header-anchor">#</a> 颜色与纹理</h2> <p>这篇文章主要讲三个问题：</p> <ul><li>将顶点的其他数据，比如颜色等，传入到顶点着色器进行渲染</li> <li>发生在顶点着色器和片元着色器之间的从图形到片元的转换，又称为图元光栅化</li> <li>将图形（或称纹理）映射到图形或三维对象的表面上</li></ul> <h3 id="将非坐标数据传入顶点着色器"><a href="#将非坐标数据传入顶点着色器" class="header-anchor">#</a> 将非坐标数据传入顶点着色器</h3> <p>前面写过绘制三角形，将顶点坐标传入到着色器，需要下面几个步骤：</p> <ol><li>创建缓冲区对象</li> <li>将缓冲区对象绑定到 target 上</li> <li>将顶点坐标数据写入到缓冲区对象</li> <li>将缓冲区对象分配给对应的 attribute 变量</li> <li>开启 attribute 变量</li></ol> <p>现在，我们希望把多个顶点相关数据通过缓冲区对象传入顶点着色器，其实只需要每种数据重复上面的步骤即可。</p> <p>下面代码是绘制一个指定大小的点，需要给顶点着色器传入点的坐标以及点的大小：</p> <p>关键代码</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'attribute float a_PointSize;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_PointSize = a_PointSize;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置顶点信息</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 绘制三个点</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">30.0</span>  <span class="token comment">// 点的尺寸</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">var</span> sizeBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexBuffer <span class="token operator">||</span> <span class="token operator">!</span>sizeBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将顶点坐标写入缓冲区对象并开启</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>a_Position <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将顶点尺寸写入缓冲区对象并开启</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sizeBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sizes<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_PointSize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>a_PointSize <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_PointSize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面代码是创建了两个缓冲区对象，一个是用来传递位置信息，一个是传递点的大小；这种情况比较适合数据量不大的情况，如果数据量大，可以将顶点的坐标和尺寸数据打包到同一个缓冲区对象中，并通过某种机制分别访问缓冲区对象中不同种类的数据。比如可以将顶点的坐标和尺寸数据按照下面的方式交错组织：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> verticesSizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 顶点坐标和点的尺寸</span>
     <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">10.0</span><span class="token punctuation">,</span>  <span class="token comment">// 第一个点</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">20.0</span><span class="token punctuation">,</span>  <span class="token comment">// 第二个点</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">30.0</span>   <span class="token comment">// 第三个点</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后可以根据 gl.vertexAttribPointer() 函数的第 5 个参数 stride 和第 6 个参数 offset 来读取特定的数据。如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'attribute float a_PointSize;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_PointSize = a_PointSize;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置坐标和尺寸</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> verticesSizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 顶点坐标和点的尺寸</span>
     <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">10.0</span><span class="token punctuation">,</span>  <span class="token comment">// the 1st point</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">20.0</span><span class="token punctuation">,</span>  <span class="token comment">// the 2nd point</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">30.0</span>   <span class="token comment">// the 3rd point</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexSizeBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexSizeBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将顶点坐标和尺寸写入缓冲区并开启</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexSizeBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticesSizes<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesSizes<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取 a_Position 的存储位置，分配缓冲区并开启</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_Position <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 开启分配</span>

  <span class="token comment">// 获取 a_PointSize 的存储位置，分配缓冲区并开启</span>
  <span class="token keyword">var</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_PointSize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>a_PointSize <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_PointSize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 开启缓冲区分配</span>

  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面代码将 verticesSizes 数组中每个元素的大小（字节数）存储到 FSIZE 中，用于后续获取坐标点以及点的大小设置步长；类型化数组具有 BYTES_PER_ELEMENT 属性，可以从中获取数组中每个元素所占的字节数。</p> <p>然后在将缓冲区对象分配给 attribute 变量时，首先需要获取 attribute 变量 a_Position 的存储地址，然后通过 gl.vertexAttribPointer() 函数，将缓冲区对象分配给 a_Position 变量，这里的参数设置跟之前我们写的例子是不一样的，因为在缓冲区对象中存储了两种类型的数据：顶点坐标和顶点尺寸，首先看一下这个函数的一些使用规范：</p> <p><img src="/note/assets/img/vertexAttributPointerFunc.49001fd4.png" alt="avatar"></p> <p>参数 stride 表示，在缓冲区对象中，单个顶点的所有数据（这里，就是顶点的坐标和大小）的字节数，也就是相邻两个顶点间的距离，即步进参数。在之前的例子中，因为缓冲区只有顶点坐标，所以这个参数设置为 0 ，在这个例子中，我们需要设置 stride 值：</p> <p><img src="/note/assets/img/stride.f55333ac.png" alt="avatar"></p> <p>如上图，每一个顶点有 3 个数据值（两个坐标数据和一个尺寸数据），因此 stride 应该设置为每项数据大小的三倍。参数 offset 表示当前考虑的数据项距离首个元素的距离，即偏移参数。在 verticesSizes 数组中，顶点的坐标数据是放在最前面的，所以 offset 应当为 0 。我们在获取点的大小的时候，offset 应该设置为 FSIZE * 2；</p> <h3 id="顶点着色器与片元着色器之间通讯"><a href="#顶点着色器与片元着色器之间通讯" class="header-anchor">#</a> 顶点着色器与片元着色器之间通讯</h3> <p>片元着色器可以用来处理颜色之类的属性，我们前面的代码只是向顶点着色器传入顶点坐标，我们需要使用一种新的变量 varying 变量向片元着色器中传入数据，实际上，varying 变量的作用是从顶点着色器向片元着色器传输数据；如下代码，实现将点的颜色传入到顶点着色器，然后顶点着色器与片元着色器之间通讯，获取点颜色：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'attribute vec4 a_Color;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec4 v_Color;\n'</span> <span class="token operator">+</span> <span class="token comment">// varying 变量</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_PointSize = 10.0;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  v_Color = a_Color;\n'</span> <span class="token operator">+</span>  <span class="token comment">// 将数据传给片元着色器</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token comment">// 片元着色器程序</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec4 v_Color;\n'</span> <span class="token operator">+</span>    <span class="token comment">// 从顶点着色器中接收数据</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = v_Color;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置顶点的坐标和颜色</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 顶点坐标和颜色</span>
     <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> 
     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span> 
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 顶点数量</span>

  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexColorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexColorBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将顶点坐标和颜色写入缓冲区对象</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexColorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticesColors<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取 a_Position 的存储位置，分配缓冲区并开启</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Enable the assignment of the buffer object</span>

  <span class="token comment">// 获取 a_Color 的存储位置，分配缓冲区并开启</span>
  <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这里需要注意的是，varying 变量只能是 float （以及相关的 vec2，vec3，vec4，mat2，mat3 和 mat4） 类型的；片元着色器接收变量 v_Color，只需要在片元着色器中也声明同样的变量名即可。</p> <h2 id="彩色三角形-几何形状的装配和光栅化"><a href="#彩色三角形-几何形状的装配和光栅化" class="header-anchor">#</a> 彩色三角形——几何形状的装配和光栅化</h2> <h3 id="几何形状的装配和光栅化"><a href="#几何形状的装配和光栅化" class="header-anchor">#</a> 几何形状的装配和光栅化</h3> <p>我们前面给顶点着色器传入顶点坐标后，片元着色器怎样处理每个片元呢；实际上在顶点着色器和片元着色器之间有下面两个步骤：</p> <ul><li>图形装配过程
这一步的任务是，将孤立的顶点坐标装配成几何图形。几何图形的类别由 gl.drawArrays() 函数的第一个参数决定。</li> <li>光栅化过程
这一步的任务是，将装配好的几何图形转化为片元</li></ul> <p><img src="/note/assets/img/webglguangshanhua.e71ec8e9.png" alt="avatar"></p> <p>gl_Position 实际上是几何图形装配阶段的输入数据。几何图形装配过程又称为图元装配过程，因为被装配出的基本图形又被成为图元。我们以绘制一个三角形为例，顶点着色器和片元着色器之间图形装配与光栅化的过程如下：</p> <ul><li>第一步：执行顶点着色器，缓冲区对象中的第一个坐标(0, 0, 0.5) 被传输给 attribute 变量 a_Position，一旦一个顶点的坐标复制给了 gl_Position，他就进入了图形装配区域，并暂时存储在那里。</li> <li>第二步：再次执行顶点着色器，类似地将第二个坐标传入并存储在装配区</li> <li>第三步：第三次执行顶点着色器，将第三个坐标传入并存储在装配区。现在，顶点着色器执行完毕，三个顶点的坐标都已经处于装配区了。</li> <li>第四步：开始装配图形。使用传入的点坐标，根据 gl.drawArrays() 的第一个参数信息（gl.TRIANGLES）来决定如何装配，这里是使用三个顶点装配出一个三角形。</li> <li>第五步：显示在屏幕上的三角形是由片元（像素）组成的。所以还需要将图形转化为片元，这个过程被称为光栅化。光栅化之后，我们就得到了组成这个三角形的所有片元。</li></ul> <p><img src="/note/assets/img/tuxiangzhuangpei.76758a92.png" alt="avatar">
上图只显示了 10 个片元，实际上，片元的数目就是这个三角形最终在屏幕上所覆盖的像素数。</p> <h3 id="调用片元着色器"><a href="#调用片元着色器" class="header-anchor">#</a> 调用片元着色器</h3> <p>一旦光栅化过程结束后，程序就开始逐片元调用片元着色器。没调用一次，就处理一个片元，对于每个片元，片元着色器计算出该片元的颜色，并写入颜色缓冲区。直到所有的片元被处理完成，浏览器渲染最终结果。</p> <p>我们可以根据每个片元的位置来确定片元的颜色。光栅化过程中生成的片元都是带有坐标信息的，调用片元着色器时这些坐标信息也随着片元传了进去，可以通过内置变量获取片元的坐标：
<img src="/note/assets/img/pianyuanzhuoseqneizhibianl.86cd3dfb.png" alt="avatar"></p> <p>修改片元着色器程序：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform float u_Width;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform float u_Height;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = vec4(gl_FragCoord.x/u_Width, 0.0, gl_FragCoord.y/u_Height, 1.0);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>
</code></pre></div><p>上面每个片元的颜色分量都是通过片元的位置计算得到的。注意，canvas 中的 Y 轴方向跟 webgl 系统的 Y 轴方向是相反的，而且 webgl 中的颜色分量值区间是 0.0 到 1.0 ，所以需要将 Y 轴坐标除以 canvas 的高度来将其处理在 0.0 到 1.0 之间。我们将 gl.drawingBufferWidth （颜色缓冲区的宽度） 和 gl.drawingBufferHeight （颜色缓冲区的高度）的值传给 u_Width 和 u_Height；</p> <h3 id="varying-变量的作用和内插过程"><a href="#varying-变量的作用和内插过程" class="header-anchor">#</a> varying 变量的作用和内插过程</h3> <p>其实定义的 varying 变量在顶点着色器与片元着色器之间传递，更准确的说，是顶点着色器的变量在传入片元着色器之前经过了内插过程。所以我们前面说的 v_Colr。顶点着色器中的 v-Color 变量在传入片元着色器之前经过了内插过程。更准确的说，我们在 varying 变量中为三角形的 3 个不同顶点指定了 3 中不同颜色，而三角形表面上这些片元的颜色值都是 webgl 系统用这 3 个顶点的颜色内插出来的。</p> <p>比如两个端点颜色不同的线段。一个为红色，另一个为蓝色，在顶点着色器中向 varying 传入这两个颜色，然后 webgl 就会自动计算线段上的所有点（片元）的颜色，并赋值给片元着色器中的 varying 变量 v_Color。</p> <p><img src="/note/assets/img/yansenaicha.9b1b649c.png" alt="avatar"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'attribute vec4 a_Color;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec4 v_Color;\n'</span> <span class="token operator">+</span> <span class="token comment">// varying 变量</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_PointSize = 10.0;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  v_Color = a_Color;\n'</span> <span class="token operator">+</span>  <span class="token comment">// 将数据传给片元着色器</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token comment">// 片元着色器程序</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec4 v_Color;\n'</span> <span class="token operator">+</span>    <span class="token comment">// 内插得到的颜色被赋值给 v_Color</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = v_Color;\n'</span> <span class="token operator">+</span>  <span class="token comment">// 再被赋值给 gl_FragColor</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="矩形表面贴上图像"><a href="#矩形表面贴上图像" class="header-anchor">#</a> 矩形表面贴上图像</h3> <p>将图形贴到一个几何图形上，一般叫做纹理映射。纹理映射的作用就是根据纹理图像，为之前光栅化后的每个片元涂上合适的颜色，组成纹理图像的像素又被成为纹素，每一个纹素的颜色都使用 RGB 或 RGBA 格式编码。</p> <p>在 webgl 中要进行纹理映射，需要下面几个步骤：</p> <ol><li>准备好映射到几个图像上的纹理图像</li> <li>为几何图形配置纹理映射方式；也就是确定几何图形的某个片元的颜色如何取决于纹理图像中哪个像素；我们利用图形的顶点坐标来确定屏幕上哪部分被纹理图像覆盖，使用纹理坐标来确定纹理图像的哪部分将覆盖到几何图形上。</li> <li>加载纹理图像，对其进行一些配置，以便在 webgl 中使用它</li> <li>在片元着色器中将相应的纹素从纹理中抽离出来，并将纹素的颜色赋给片元。</li></ol> <p>第二步指定映射方式，就是确定几何图形的某个片元的颜色如何取决于纹理图像中哪个像素的问题，我们利用图形的顶点坐标来确定屏幕上哪部分将覆盖到几何图形上。下面是纹理坐标。</p> <h4 id="纹理坐标"><a href="#纹理坐标" class="header-anchor">#</a> 纹理坐标</h4> <p>前面说的纹理坐标是一个新的坐标系统，纹理坐标就是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色；webgl 系统中的纹理坐标是二维的。
不管图像是多大，其右上角纹理坐标始终是(1.0, 1.0)
<img src="/note/assets/img/wenlizuobaio.170379bb.png" alt="avatar"></p> <h4 id="将纹理图像粘贴到几何图形上"><a href="#将纹理图像粘贴到几何图形上" class="header-anchor">#</a> 将纹理图像粘贴到几何图形上</h4> <p>我们将纹理坐标(0.0, 1.0)映射到顶点坐标(-0.5, -0.5, 0.0) 上，将纹理坐标 (1.0, 1.0) 映射到顶点坐标 (0.5, 0.5, 0.0) 上，来建立矩形四个顶点与纹理坐标的对应关系，就完成了几何图形的贴纹理操作：
<img src="/note/assets/img/wenlituxzhantiejihetux.6cdc47e7.png" alt="avatar"></p> <p>坐标值与图形的尺寸无关。不管多大，其右上角还是 (1.0, 1.0)</p> <h4 id="实现代码"><a href="#实现代码" class="header-anchor">#</a> 实现代码</h4> <p>首先在顶点着色器中为每个顶点指定纹理坐标，然后在片元着色器中根据每个片元的纹理坐标从纹理图像中抽取纹素颜色。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'attribute vec2 a_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec2 v_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  v_TexCoord = a_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'#ifdef GL_ES\n'</span> <span class="token operator">+</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'#endif\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform sampler2D u_Sampler;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec2 v_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = texture2D(u_Sampler, v_TexCoord);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置顶点信息</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 配置纹理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initTextures</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize the texture.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> verticesTexCoords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 顶点坐标，纹理坐标</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 顶点数目</span>
  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexTexCoordBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexTexCoordBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将顶点坐标与纹理坐标写入缓冲区对象</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexTexCoordBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticesTexCoords<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesTexCoords<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_Position <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取 a_TexCoord 位置</span>
  <span class="token keyword">var</span> a_TexCoord <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_TexCoord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_TexCoord <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_TexCoord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将纹理坐标分配给 a_TexCoord</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_TexCoord<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_TexCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initTextures</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 创建纹理对象</span>
  <span class="token comment">// 获取 u_Sampler 的存储位置</span>
  <span class="token keyword">var</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_Sampler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建一个 image 对象</span>
  <span class="token comment">// 注册图像加载事件的响应函数</span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> n<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> u_Sampler<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 浏览器开始加载图像</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'../resources/sky.jpg'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> n<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> u_Sampler<span class="token punctuation">,</span> image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 对纹理图像进行 y 轴反转</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// 开启 0 号纹理单元</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 向 target 绑定纹理对象</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 配置纹理参数</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 配置纹理图像</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 将 0 号纹理传递给着色器</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 绘制矩形</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面代码主要分五个部分：</p> <ol><li>顶点着色器中接收顶点的纹理坐标，光栅化后传递给片元着色器。</li> <li>片元着色器根据片元的纹理坐标，从纹理图像中抽取纹素颜色，赋给当前片元。</li> <li>设置顶点的纹理坐标（initVertexBuffers()）</li> <li>准备待加载的纹理图像，令浏览器读取它（initTextures()）。</li> <li>监听纹理图像的加载事件，一旦加载完成，就在 webgl 系统中使用纹理（loadTexture()）。</li></ol> <ul><li>设置点的纹理坐标</li></ul> <p>将纹理坐标传入顶点着色器，与将其他顶点数据（如颜色）传入顶点着色器的方法时相同的。可以将纹理坐标和顶点坐标写在同一个缓冲区中，定义数组 verticesTexCoords 记录顶点坐标和纹理坐标。</p> <p>然后将顶点坐标和纹理坐标写入缓冲区对象，将其中的顶点坐标分配给 a_Position 变量并开启。然后获取 a_TexCoord 变量的存储位置，将缓冲区中的纹理坐标分配给该变量。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 获取 a_TexCoord 位置</span>
  <span class="token keyword">var</span> a_TexCoord <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_TexCoord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_TexCoord <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_TexCoord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将纹理坐标分配给 a_TexCoord</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_TexCoord<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_TexCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>配置和加载纹理（initTextures()）</li></ul> <p>initTextures() 函数负责配置加载纹理，首先创建纹理对象 gl.createTexture()，然后调用 gl.getUniformLocation() 从片元着色器中获取 u_Sampler 的存储文职，该变量用来接收纹理图像：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 创建纹理对象</span>
  <span class="token comment">// 获取 u_Sampler 的存储位置</span>
  <span class="token keyword">var</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_Sampler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>gl.createTexture() 方法创建纹理对象：</p> <p><img src="/note/assets/img/chuangjianwenliduix.9c35dbc5.png" alt="avatar"></p> <p>创建纹理对象后，会有 8 个纹理单元 gl.TEXTURE0 到 gl.TEXTURE7，每一个都与 gl.TEXTURE_2D 相关联，后者就是绑定纹理时的纹理目标。</p> <p><img src="/note/assets/img/wenlidanyuan.f0efa671.png" alt="avatar"></p> <p>可以使用 gl.deleteTexture() 来删除一个纹理对象。如果删除一个已经被删除的纹理对象，不会报错。
<img src="/note/assets/img/shanchuwenliduix.e68b3594.png" alt="avatar"></p> <p>然后下面代码就是请求浏览器加载纹理供 webgl 使用，纹理图像将会映射到矩形上，所以需要使用 Image 对象。然后注册图像异步加载完之后执行 loadTexture() 函数。</p> <ul><li>为 webgl 配置纹理</li></ul> <p>loadTexture() 函数主要任务是配置纹理供 webgl 使用，使用纹理对象的方式与使用缓冲区很类似；</p> <ol><li>图像 Y 轴反转</li></ol> <p>webgl 纹理坐标系统中的 t 轴的方向和 png、bmp、jpg 等格式图片的坐标系统的 y 轴方向是相反的。因此，只有先将图像 y 轴进行反转，才能够正确地将图像映射到图形上。</p> <p><img src="/note/assets/img/yzhoufanzhuan.d8ad7764.png" alt="avatar"></p> <p>下面是 pixelStorei 函数语法：</p> <p><img src="/note/assets/img/pixelStoreiyufa.54d6a985.png" alt="avatar"></p> <ol start="2"><li>激活纹理单元(gl.activeTexture())</li></ol> <p>webgl 通过一种称作纹理单元的机制来同时使用多个纹理。每个纹理单元有一个单元有一个单元编号来管理一张纹理图像。即使程序只需要使用一张纹理图像，也得为其指定一个纹理单元。系统支持的纹理单元个数取决于硬件和浏览器的 webgl 实现，默认情况下，webgl 至少支持 8 个纹理单元，内置的变量 l.TEXTURE0 到 gl.TEXTURE7 各表示一个纹理单元。</p> <p><img src="/note/assets/img/wenlidanyuan1.7a27307b.png" alt="avatar"></p> <p>在使用纹理单元之前，需要 gl.activeTexture() 方法激活它：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 开启 0 号纹理单元</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/note/assets/img/jihuowenlidanyuan.8f799ee2.png" alt="avatar"></p> <ol start="3"><li>绑定纹理对象</li></ol> <p>这一步操作主要是告诉 webgl 系统纹理对象使用的是哪种类型的纹理。在对纹理对象进行操作之前，我们需要绑定纹理对象，这一点跟缓冲区对象很像：在对缓冲区对象进行操作之前，也需要绑定缓冲区对象。webgl 支持两种类型的纹理，如下：</p> <table><thead><tr><th>纹理类型</th> <th style="text-align:right;">描述</th></tr></thead> <tbody><tr><td>gl.TEXTURE_2D</td> <td style="text-align:right;">二维纹理</td></tr> <tr><td>gl.TEXTURE_CUBE_MAP</td> <td style="text-align:right;">立方体纹理</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 向 target 绑定纹理对象</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>gl.bindTexture 函数语法：</p> <p><img src="/note/assets/img/jihuowenlidanyuan.8f799ee2.png" alt="avatar"></p> <p>这个方法完成了两个任务：开启纹理对象，以及将纹理对象绑定到纹理单元上。在这个例子中，因为 0 号纹理单元已经被激活，所以在执行完绑定后，webgl 系统内部状态如下“</p> <p><img src="/note/assets/img/wenlibangdinddaontar.05020dd4.png" alt="avatar"></p> <ol start="4"><li>配置纹理对象的参数(gl.texParameteri())</li></ol> <p>gl.texParameteri() 函数设置了如何根据纹理坐标获取纹素颜色、按哪种方式重复填充纹理。
<img src="/note/assets/img/peizhiwenliduix.8a9ad1d7.png" alt="avatar"></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 配置纹理参数</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 pname 可以指定 4 个纹理参数：</p> <ul><li>放大方法(gl.TEXTURE_MAG_FILTER)：这个参数表示，当纹理的绘制范围比纹理本身更大时，如何获取纹素颜色。webgl 需要填充由于放大而造成的像素间的空隙，该参数就表示填充这些空隙的具体方法。</li> <li>缩小方法(gl.TEXTURE_MIN_FILTER)：这个参数表示，当纹理的绘制范围比纹理本身更小时，如何获取纹素颜色。webgl 需要剔除纹理图像中的部分像素，该参数就表示具体的剔除像素的方法。</li> <li>水平填充方法(gl.TEXTURE_WRAP_S)：这个参数表示，如何对纹理图像左侧或右侧的区域进行填充。</li> <li>垂直填充方法(gl.TEXTURE_WRAP_T)：这个参数表示，如何对纹理图像上方和下放的区域进行填充。</li></ul> <p><img src="/note/assets/img/wenli.c4ff21b4.png" alt="avatar"></p> <p>下表是每种纹理参数的默认值：</p> <table><thead><tr><th>纹理参数</th> <th style="text-align:right;">描述</th> <th style="text-align:right;">默认值</th></tr></thead> <tbody><tr><td>gl.TEXTURE_MAG_FILTER</td> <td style="text-align:right;">纹理放大</td> <td style="text-align:right;">gl.LINEAR</td></tr> <tr><td>gl.TEXTURE_MIN_FILTER</td> <td style="text-align:right;">纹理缩小</td> <td style="text-align:right;">gl.NEAREST_MIPMAP_LINEAR</td></tr> <tr><td>gl.TEXTURE_WRAP_S</td> <td style="text-align:right;">纹理水平填充</td> <td style="text-align:right;">gl.REPEAT</td></tr> <tr><td>gl.TEXTURE_WRAP_T</td> <td style="text-align:right;">纹理垂直填充</td> <td style="text-align:right;">gl.REPAET</td></tr></tbody></table> <p>下表是可以赋值给 gl.TEXTURE_MAG_FILTER 和 gl.TEXTURE_MIN_FILTER 的常量：
<img src="/note/assets/img/mag.8c81a66a.png" alt="avatar"></p> <p>下表是可以赋值给 gl.TEXTURE_WRAP_S 和 gl.TEXTURE_WRAP_T 的常量：
<img src="/note/assets/img/wrap.be6e472e.png" alt="avatar"></p> <p>我们前面代码是设置了 gl.TEXTURE_MIN_FILTER 的参数，设置为 gl.LINEAR，他是一种特殊的、被称为 MIPMAP（也称为金字塔）的纹理类型。MIPMAP 纹理实际上是一系列纹理，或者说是原始纹理图像的一系列不同分辨率的版本。</p> <p>设置完纹理参数后，webgl 系统的内部状态如下：</p> <p><img src="/note/assets/img/shezhiwenlicnashu.57bc195c.png" alt="avatar"></p> <ol start="5"><li>将纹理图像分配给纹理对象(gl.texImage2D())</li></ol> <p>使用 gl.texImage2D() 方法将纹理图像分配给纹理对象。
该方法的语法如下：</p> <p><img src="/note/assets/img/texImage2d.dbd28abd.png" alt="avatar"></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 配置纹理图像</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>format 参数表示纹理数据的格式，如下表，需要根据纹理图像的格式来选择这个参数：
这个例子中使用的纹理图片是 JPG 格式的，该格式将每个像素用 RGB 三个分量来表示，所以将参数指定为 gl.RGB，对其他格式的图像，如 PNG 格式的图形，通常使用 gl.RGBA ，BMP 格式的图像通常使用 gl.RGB，而 gl.LUMINANCE 和 gl.LUMINANCE_ALPHA 通常用在灰度图像上。</p> <table><thead><tr><th>纹理参数</th> <th style="text-align:right;">描述</th></tr></thead> <tbody><tr><td>gl.RGB</td> <td style="text-align:right;">红、绿、蓝</td></tr> <tr><td>gl.RGBA</td> <td style="text-align:right;">红、绿、蓝、透明度</td></tr> <tr><td>gl.ALPHA</td> <td style="text-align:right;">(0.0, 0.0, 0.0, 透明度)</td></tr> <tr><td>gl.LUMINANCE</td> <td style="text-align:right;">L、L、L、1L：流明</td></tr> <tr><td>gl.LUMINANCE_ALPHA</td> <td style="text-align:right;">L、L、L、透明度</td></tr></tbody></table> <p>这里的流明表示我们感知到的物体表面的亮度。通常使用物体表面红、绿、蓝颜色分量值的加权平均来计算流明。</p> <p>type 参数指定了纹理数据类型，通常我们使用 gl.UNSIGNED_BYTE 数据类型。当然也可以使用其他数据类型，如 gl.UNSIGNED_SHORT_5_6_5 (将 RGB 三分量压缩入 16 比特中)。后面的几种数据格式通常被用来压缩数据，以减少浏览器加载图像的时间。</p> <p>下面是纹理数据的数据格式</p> <table><thead><tr><th>格式</th> <th style="text-align:right;">描述</th></tr></thead> <tbody><tr><td>gl.UNSIGNED_BYTE</td> <td style="text-align:right;">无符号整型，每个颜色分量占据 1 字节</td></tr> <tr><td>gl.UNSIGNED_SHORT_5_6_5</td> <td style="text-align:right;">RGB：每个分量分别占据 5、6、5 比特</td></tr> <tr><td>gl.UNSIGNED_SHORT_4_4_4_4</td> <td style="text-align:right;">RGBA：每个分量分别占据 4、4、4、4 比特</td></tr> <tr><td>gl.UNSIGNED_SHORT_5_5_5_1</td> <td style="text-align:right;">RGBA：RGB 每个分量分别占据 5 比特，A 分量占据 1 比特</td></tr></tbody></table> <ol start="6"><li>将纹理单元传递给片元着色器(gl.uniform1i())</li></ol> <p>一旦将纹理图像传入了 webgl 系统，就必须将其传入片元着色器并映射到图形的表面上去。前面的例子使用 uniform 变量来表示纹理，因为纹理图像不会随着片元变化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'#ifdef GL_ES\n'</span> <span class="token operator">+</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'#endif\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform sampler2D u_Sampler;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec2 v_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = texture2D(u_Sampler, v_TexCoord);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>
</code></pre></div><p>必须将着色器中表示纹理对象的 uniform 变量声明为一种特殊的、专用于纹理对象的数据类型，如下表：</p> <table><thead><tr><th>类型</th> <th style="text-align:right;">描述</th></tr></thead> <tbody><tr><td>sampler2D</td> <td style="text-align:right;">绑定到 gl.TEXTURE_2D 上的纹理数据类型</td></tr> <tr><td>samplerCube</td> <td style="text-align:right;">绑定到 gl.TEXTURE_CUBE_MAP 上的纹理数据类型</td></tr></tbody></table> <ol start="7"><li>从顶点着色器向片元着色器传输纹理坐标</li></ol> <p>使用 varying 变量 v_TextCoord 将纹理坐标传入到片元着色器中。在片元着色器中，使用功能的是内插后的纹理坐标。</p> <p>这样就完成了在 webgl 系统中使用纹理的所有准备工作。
剩下的工作就是，根据片元的纹理坐标，从纹理图像上抽出纹素的颜色，然后涂到当前的片元上。</p> <ol start="7"><li>在片元着色器中获取纹理像素颜色(texture2D())</li></ol> <p>片元着色器从纹理图像上获取纹素的颜色；使用 GLSL ES 内置函数 texture2D() 来抽取纹素颜色。</p> <div class="language-js extra-class"><pre class="language-js"><code>gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_TexCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数的语法如下：
<img src="/note/assets/img/texture2d.6a786f2e.png" alt="avatar"></p> <p>下表是 texture2D() 的返回值</p> <table><thead><tr><th>internalformat</th> <th style="text-align:right;">返回值</th></tr></thead> <tbody><tr><td>gl.RGB</td> <td style="text-align:right;">(R,G,B,1.0)</td></tr> <tr><td>gl.RGBA</td> <td style="text-align:right;">(R,G,B,A)</td></tr> <tr><td>gl.ALPHA</td> <td style="text-align:right;">(0.0,0.0,0.0,0.0,A)</td></tr> <tr><td>gl.LUMINANCE</td> <td style="text-align:right;">(L,L,L,1.0)</td></tr> <tr><td>gl.LUMINANCE_ALPHA</td> <td style="text-align:right;">(L,L,L,A)</td></tr></tbody></table> <p>纹理放大和缩小方法的参数将决定 webgl 系统将以何种方式内插出片元。</p> <h3 id="使用多幅纹理"><a href="#使用多幅纹理" class="header-anchor">#</a> 使用多幅纹理</h3> <p>如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'#ifdef GL_ES\n'</span> <span class="token operator">+</span>
  <span class="token string">'precision mediump float;\n'</span> <span class="token operator">+</span>
  <span class="token string">'#endif\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform sampler2D u_Sampler0;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform sampler2D u_Sampler1;\n'</span> <span class="token operator">+</span>
  <span class="token string">'varying vec2 v_TexCoord;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  vec4 color0 = texture2D(u_Sampler0, v_TexCoord);\n'</span> <span class="token operator">+</span>
  <span class="token string">'  vec4 color1 = texture2D(u_Sampler1, v_TexCoord);\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = color0 * color1;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 配置纹理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initTextures</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize the texture.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> verticesTexCoords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 顶点坐标和纹理坐标</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 顶点数量</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initTextures</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建纹理对象</span>
  <span class="token keyword">var</span> texture0 <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">var</span> texture1 <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取 u_Sampler0 和 u_Sampler1 的存储位置</span>
  <span class="token keyword">var</span> u_Sampler0 <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_Sampler0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> u_Sampler1 <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_Sampler1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 创建 image 对象</span>
  <span class="token keyword">var</span> image0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> image1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册事件响应函数，在图形加载完成后调用</span>
  image0<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> n<span class="token punctuation">,</span> texture0<span class="token punctuation">,</span> u_Sampler0<span class="token punctuation">,</span> image0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  image1<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> n<span class="token punctuation">,</span> texture1<span class="token punctuation">,</span> u_Sampler1<span class="token punctuation">,</span> image1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  image0<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'../resources/sky.jpg'</span><span class="token punctuation">;</span>
  image1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'../resources/circle.gif'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 标记纹理单元是否已经就绪</span>
<span class="token keyword">var</span> g_texUnit0 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> g_texUnit1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
<span class="token keyword">function</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> n<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> u_Sampler<span class="token punctuation">,</span> image<span class="token punctuation">,</span> texUnit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 激活纹理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>texUnit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    g_texUnit0 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    g_texUnit1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 绑定纹理对象到目标</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>   

  <span class="token comment">// 设置纹理参数</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置纹理图像</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> texUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 将纹理单元编号传递给取样器</span>
  
  <span class="token comment">// Clear &lt;canvas&gt;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_texUnit0 <span class="token operator">&amp;&amp;</span> g_texUnit1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Draw the rectangle</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面是通过两个纹理中取出纹素颜色，来进行渲染的。使用两个纹素来计算最终的片元颜色（gl_FragColor）有很多方法，上面的例子是使用了颜色矢量的分量乘法。也就是两个矢量中对应的分量相乘作为新矢量的分量，如下图；在 GLSL ES 中，只需要将两个 vec4 变量简单相乘一下就可以达到目的：</p> <p><img src="/note/assets/img/vec4xiangcheng.c6aa22dc.png" alt="avatar"></p> <section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
    评 论：
  </h3> <div id="vcomments"></div></section></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新:</span> <span class="time">11/21/2020, 7:00:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/graphics/webgl高级变换与动画基础.html" class="prev">
        webgl高级变换与动画基础
      </a></span> <span class="next"><a href="/note/graphics/OpenGLES着色器语言.html">
        OpenGLES着色器语言
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.cf3e5064.js" defer></script><script src="/note/assets/js/2.bfd5325d.js" defer></script><script src="/note/assets/js/6.b5c9cb4a.js" defer></script><script src="/note/assets/js/72.8b48baa3.js" defer></script>
  </body>
</html>
