<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webGL 基础 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="学习笔记">
    <link rel="preload" href="/note/assets/css/0.styles.c9d983ba.css" as="style"><link rel="preload" href="/note/assets/js/app.f3710e1e.js" as="script"><link rel="preload" href="/note/assets/js/2.a05a71ea.js" as="script"><link rel="preload" href="/note/assets/js/4.a297dc64.js" as="script"><link rel="prefetch" href="/note/assets/js/10.a64fa943.js"><link rel="prefetch" href="/note/assets/js/100.b8de88e9.js"><link rel="prefetch" href="/note/assets/js/101.d75b1de8.js"><link rel="prefetch" href="/note/assets/js/102.8d08f712.js"><link rel="prefetch" href="/note/assets/js/103.b87ac91b.js"><link rel="prefetch" href="/note/assets/js/104.e158d7da.js"><link rel="prefetch" href="/note/assets/js/105.2e43fb0c.js"><link rel="prefetch" href="/note/assets/js/106.536b468d.js"><link rel="prefetch" href="/note/assets/js/107.67d90a50.js"><link rel="prefetch" href="/note/assets/js/108.25cee945.js"><link rel="prefetch" href="/note/assets/js/109.e490036d.js"><link rel="prefetch" href="/note/assets/js/11.5bdc95cd.js"><link rel="prefetch" href="/note/assets/js/110.8db368fb.js"><link rel="prefetch" href="/note/assets/js/111.dc7a5cee.js"><link rel="prefetch" href="/note/assets/js/112.fb10b9f8.js"><link rel="prefetch" href="/note/assets/js/113.8d049d1b.js"><link rel="prefetch" href="/note/assets/js/114.15bd48e9.js"><link rel="prefetch" href="/note/assets/js/115.f1115f03.js"><link rel="prefetch" href="/note/assets/js/116.b9fba6f5.js"><link rel="prefetch" href="/note/assets/js/117.a0f0f091.js"><link rel="prefetch" href="/note/assets/js/118.71c1fb29.js"><link rel="prefetch" href="/note/assets/js/119.07a978b6.js"><link rel="prefetch" href="/note/assets/js/12.8b81c3d8.js"><link rel="prefetch" href="/note/assets/js/120.71170567.js"><link rel="prefetch" href="/note/assets/js/121.f7390534.js"><link rel="prefetch" href="/note/assets/js/122.eb3aaeec.js"><link rel="prefetch" href="/note/assets/js/123.e002ffa5.js"><link rel="prefetch" href="/note/assets/js/124.b1a531fc.js"><link rel="prefetch" href="/note/assets/js/125.8f8892be.js"><link rel="prefetch" href="/note/assets/js/126.f473ea15.js"><link rel="prefetch" href="/note/assets/js/127.88d46a48.js"><link rel="prefetch" href="/note/assets/js/128.7e2a5c13.js"><link rel="prefetch" href="/note/assets/js/129.2c63873b.js"><link rel="prefetch" href="/note/assets/js/13.50e4862c.js"><link rel="prefetch" href="/note/assets/js/130.641fa751.js"><link rel="prefetch" href="/note/assets/js/131.74e6ab13.js"><link rel="prefetch" href="/note/assets/js/132.05de29a7.js"><link rel="prefetch" href="/note/assets/js/133.01ead98e.js"><link rel="prefetch" href="/note/assets/js/134.5d51770c.js"><link rel="prefetch" href="/note/assets/js/135.4d37d3bc.js"><link rel="prefetch" href="/note/assets/js/136.b8e969c2.js"><link rel="prefetch" href="/note/assets/js/137.964a7ea0.js"><link rel="prefetch" href="/note/assets/js/138.f3f9a446.js"><link rel="prefetch" href="/note/assets/js/139.cef76862.js"><link rel="prefetch" href="/note/assets/js/14.08c0da27.js"><link rel="prefetch" href="/note/assets/js/15.513243e9.js"><link rel="prefetch" href="/note/assets/js/16.75a49414.js"><link rel="prefetch" href="/note/assets/js/17.27c4032e.js"><link rel="prefetch" href="/note/assets/js/18.0aa1342f.js"><link rel="prefetch" href="/note/assets/js/19.30e88ecd.js"><link rel="prefetch" href="/note/assets/js/20.bb1b3780.js"><link rel="prefetch" href="/note/assets/js/21.86c24ca1.js"><link rel="prefetch" href="/note/assets/js/22.06d35504.js"><link rel="prefetch" href="/note/assets/js/23.12e25dfe.js"><link rel="prefetch" href="/note/assets/js/24.00efff3c.js"><link rel="prefetch" href="/note/assets/js/25.17cb9dc3.js"><link rel="prefetch" href="/note/assets/js/26.4d5d7743.js"><link rel="prefetch" href="/note/assets/js/27.d906d379.js"><link rel="prefetch" href="/note/assets/js/28.8de97cf3.js"><link rel="prefetch" href="/note/assets/js/29.58915b41.js"><link rel="prefetch" href="/note/assets/js/3.e0198381.js"><link rel="prefetch" href="/note/assets/js/30.54104fce.js"><link rel="prefetch" href="/note/assets/js/31.28fe5d0c.js"><link rel="prefetch" href="/note/assets/js/32.1750e77c.js"><link rel="prefetch" href="/note/assets/js/33.a2f30370.js"><link rel="prefetch" href="/note/assets/js/34.a9c3c2a7.js"><link rel="prefetch" href="/note/assets/js/35.39c7241b.js"><link rel="prefetch" href="/note/assets/js/36.eedad454.js"><link rel="prefetch" href="/note/assets/js/37.a2c809b5.js"><link rel="prefetch" href="/note/assets/js/38.10d4ed6c.js"><link rel="prefetch" href="/note/assets/js/39.e8b8db2b.js"><link rel="prefetch" href="/note/assets/js/40.2b5b33ad.js"><link rel="prefetch" href="/note/assets/js/41.2631f175.js"><link rel="prefetch" href="/note/assets/js/42.747be58d.js"><link rel="prefetch" href="/note/assets/js/43.40a7bcbc.js"><link rel="prefetch" href="/note/assets/js/44.3ea40ce5.js"><link rel="prefetch" href="/note/assets/js/45.7a80d7ca.js"><link rel="prefetch" href="/note/assets/js/46.836770a6.js"><link rel="prefetch" href="/note/assets/js/47.a52bdbf6.js"><link rel="prefetch" href="/note/assets/js/48.414dcfe8.js"><link rel="prefetch" href="/note/assets/js/49.d7cefa4e.js"><link rel="prefetch" href="/note/assets/js/5.5b5baac9.js"><link rel="prefetch" href="/note/assets/js/50.56ac26a0.js"><link rel="prefetch" href="/note/assets/js/51.0007e05b.js"><link rel="prefetch" href="/note/assets/js/52.f732e6cb.js"><link rel="prefetch" href="/note/assets/js/53.e474f510.js"><link rel="prefetch" href="/note/assets/js/54.18352a73.js"><link rel="prefetch" href="/note/assets/js/55.1e191d71.js"><link rel="prefetch" href="/note/assets/js/56.62353193.js"><link rel="prefetch" href="/note/assets/js/57.2bb047c7.js"><link rel="prefetch" href="/note/assets/js/58.0cd8fa53.js"><link rel="prefetch" href="/note/assets/js/59.de349ea5.js"><link rel="prefetch" href="/note/assets/js/6.caa615f9.js"><link rel="prefetch" href="/note/assets/js/60.6a8b8c29.js"><link rel="prefetch" href="/note/assets/js/61.c47027d1.js"><link rel="prefetch" href="/note/assets/js/62.c9b728e8.js"><link rel="prefetch" href="/note/assets/js/63.3aef3c58.js"><link rel="prefetch" href="/note/assets/js/64.f274394a.js"><link rel="prefetch" href="/note/assets/js/65.380d7630.js"><link rel="prefetch" href="/note/assets/js/66.0f94cf0d.js"><link rel="prefetch" href="/note/assets/js/67.9f7cbc10.js"><link rel="prefetch" href="/note/assets/js/68.be41584f.js"><link rel="prefetch" href="/note/assets/js/69.62dfb037.js"><link rel="prefetch" href="/note/assets/js/7.7e01e252.js"><link rel="prefetch" href="/note/assets/js/70.14dae2a4.js"><link rel="prefetch" href="/note/assets/js/71.506ee405.js"><link rel="prefetch" href="/note/assets/js/72.2ad6f7c7.js"><link rel="prefetch" href="/note/assets/js/73.dfbf98ca.js"><link rel="prefetch" href="/note/assets/js/74.b4c91d56.js"><link rel="prefetch" href="/note/assets/js/75.c95780c3.js"><link rel="prefetch" href="/note/assets/js/76.edc4f55d.js"><link rel="prefetch" href="/note/assets/js/77.f8a2a59c.js"><link rel="prefetch" href="/note/assets/js/78.37cc79d4.js"><link rel="prefetch" href="/note/assets/js/79.3133562a.js"><link rel="prefetch" href="/note/assets/js/8.8668d38f.js"><link rel="prefetch" href="/note/assets/js/80.ad51022d.js"><link rel="prefetch" href="/note/assets/js/81.babaa54f.js"><link rel="prefetch" href="/note/assets/js/82.a4f831c7.js"><link rel="prefetch" href="/note/assets/js/83.5afe7fc6.js"><link rel="prefetch" href="/note/assets/js/84.734ee63e.js"><link rel="prefetch" href="/note/assets/js/85.6e082d5f.js"><link rel="prefetch" href="/note/assets/js/86.0508b4a5.js"><link rel="prefetch" href="/note/assets/js/87.3cd80b10.js"><link rel="prefetch" href="/note/assets/js/88.716f3968.js"><link rel="prefetch" href="/note/assets/js/89.d287155e.js"><link rel="prefetch" href="/note/assets/js/9.044c3d55.js"><link rel="prefetch" href="/note/assets/js/90.98118a5b.js"><link rel="prefetch" href="/note/assets/js/91.ca7699c4.js"><link rel="prefetch" href="/note/assets/js/92.b1e16a2a.js"><link rel="prefetch" href="/note/assets/js/93.c73bb197.js"><link rel="prefetch" href="/note/assets/js/94.e82638ce.js"><link rel="prefetch" href="/note/assets/js/95.a62e885a.js"><link rel="prefetch" href="/note/assets/js/96.0609c6cd.js"><link rel="prefetch" href="/note/assets/js/97.7349a051.js"><link rel="prefetch" href="/note/assets/js/98.79bc737c.js"><link rel="prefetch" href="/note/assets/js/99.ebf6fd43.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.c9d983ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/css/css基础.html" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/note/react/react基础.html" class="nav-link">
  react 相关
</a></div><div class="nav-item"><a href="/note/js-patterns/代理模式.html" class="nav-link">
  js 设计模式
</a></div><div class="nav-item"><a href="/note/typescript/typescript基础语法.html" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/note/node/基础知识.html" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/javascript/知识体系.html" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/note/vue/相关笔记.html" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/note/webpack/基础知识.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/webgis/坐标系相关.html" class="nav-link">
  webgis
</a></div><div class="nav-item"><a href="/note/http/HTTP协议基础.html" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/note/Interview/forEach-forIn-forOf-map之间的区别.html" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/note/gisAlgorithm/数据结构-矢量.html" class="nav-link">
  gis 算法
</a></div><div class="nav-item"><a href="/note/graphics/图形学基础.html" class="nav-link">
  图形学相关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/graphics/图形学基础.html" class="sidebar-link">图形学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/图形学基础.html#图形学基础" class="sidebar-link">图形学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/图形学基础.html#三角形网格" class="sidebar-link">三角形网格</a></li></ul></li></ul></li><li><a href="/note/graphics/数学基础.html" class="sidebar-link">数学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#数学基础" class="sidebar-link">数学基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#什么是向量" class="sidebar-link">什么是向量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#三维直角坐标系" class="sidebar-link">三维直角坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的表示" class="sidebar-link">向量的表示</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量乘以常数" class="sidebar-link">向量乘以常数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的长度" class="sidebar-link">向量的长度</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#线性组合" class="sidebar-link">线性组合</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#单位圆" class="sidebar-link">单位圆</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#弧度和角度" class="sidebar-link">弧度和角度</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#极坐标" class="sidebar-link">极坐标</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#极坐标系" class="sidebar-link">极坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#三角函数的性质" class="sidebar-link">三角函数的性质</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#旋转" class="sidebar-link">旋转</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#向量的叉乘" class="sidebar-link">向量的叉乘</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_2d-叉乘符号的含义" class="sidebar-link">2d 叉乘符号的含义</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_3d-向量叉乘" class="sidebar-link">3d 向量叉乘</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#_3d-叉乘的意义" class="sidebar-link">3D 叉乘的意义</a></li><li class="sidebar-sub-header"><a href="/note/graphics/数学基础.html#矩阵" class="sidebar-link">矩阵</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl基础.html" class="active sidebar-link">webgl基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-基础" class="sidebar-link">webGL 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-程序的结构" class="sidebar-link">webGL 程序的结构</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-渲染管线" class="sidebar-link">webgl 渲染管线</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#渲染过程" class="sidebar-link">渲染过程</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#glsl" class="sidebar-link">GLSL</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-坐标系统" class="sidebar-link">webgl 坐标系统</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#webgl-机制-缓冲区对象（buffer-object）" class="sidebar-link">webgl 机制 —— 缓冲区对象（buffer object）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl基础.html#移动、旋转、缩放" class="sidebar-link">移动、旋转、缩放</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl高级变换与动画基础.html" class="sidebar-link">webgl高级变换与动画基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级变换与动画基础.html#动画" class="sidebar-link">动画</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl高级变换与动画基础.html#requestanimationframe-方法" class="sidebar-link">requestAnimationFrame 方法</a></li></ul></li></ul></li><li><a href="/note/graphics/webgl颜色与纹理.html" class="sidebar-link">webgl颜色与纹理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#颜色与纹理" class="sidebar-link">颜色与纹理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#将非坐标数据传入顶点着色器" class="sidebar-link">将非坐标数据传入顶点着色器</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#顶点着色器与片元着色器之间通讯" class="sidebar-link">顶点着色器与片元着色器之间通讯</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#彩色三角形-几何形状的装配和光栅化" class="sidebar-link">彩色三角形——几何形状的装配和光栅化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#几何形状的装配和光栅化" class="sidebar-link">几何形状的装配和光栅化</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#调用片元着色器" class="sidebar-link">调用片元着色器</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#varying-变量的作用和内插过程" class="sidebar-link">varying 变量的作用和内插过程</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#矩形表面贴上图像" class="sidebar-link">矩形表面贴上图像</a></li><li class="sidebar-sub-header"><a href="/note/graphics/webgl颜色与纹理.html#使用多幅纹理" class="sidebar-link">使用多幅纹理</a></li></ul></li></ul></li><li><a href="/note/graphics/OpenGLES着色器语言.html" class="sidebar-link">OpenGLES着色器语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#glsl-es-概述" class="sidebar-link">GLSL ES 概述</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#执行次序" class="sidebar-link">执行次序</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#注释" class="sidebar-link">注释</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#数据值类型（数值和布尔值）" class="sidebar-link">数据值类型（数值和布尔值）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#变量" class="sidebar-link">变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#glsl-es-是强类型语言" class="sidebar-link">GLSL ES 是强类型语言</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#基本类型" class="sidebar-link">基本类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和类型转换" class="sidebar-link">赋值和类型转换</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符" class="sidebar-link">运算符</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矢量和矩阵" class="sidebar-link">矢量和矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和构造" class="sidebar-link">赋值和构造</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矢量构造函数" class="sidebar-link">矢量构造函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵构造函数" class="sidebar-link">矩阵构造函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#访问元素" class="sidebar-link">访问元素</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-2" class="sidebar-link">运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-3" class="sidebar-link">[] 运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-4" class="sidebar-link">运算符</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵右乘矢量" class="sidebar-link">矩阵右乘矢量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵左乘矢量" class="sidebar-link">矩阵左乘矢量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#矩阵与矩阵相乘" class="sidebar-link">矩阵与矩阵相乘</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#结构体" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#赋值和构造-2" class="sidebar-link">赋值和构造</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#访问成员" class="sidebar-link">访问成员</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符-5" class="sidebar-link">运算符</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#数组" class="sidebar-link">数组</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#取样器（纹理）" class="sidebar-link">取样器（纹理）</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#运算符优先级" class="sidebar-link">运算符优先级</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#程序流程控制：分支和循环" class="sidebar-link">程序流程控制：分支和循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#if-语句和-if-else-语句" class="sidebar-link">if 语句和 if-else 语句</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#for-语句" class="sidebar-link">for 语句</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#continue、break-和-discard-语句" class="sidebar-link">continue、break 和 discard 语句</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#规范声明" class="sidebar-link">规范声明</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#参数限定词" class="sidebar-link">参数限定词</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#内置函数" class="sidebar-link">内置函数</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#存储限定字" class="sidebar-link">存储限定字</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#const-变量" class="sidebar-link">const 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#attribute-变量" class="sidebar-link">Attribute 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#uniform-变量" class="sidebar-link">uniform 变量</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#varying-变量" class="sidebar-link">varying 变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#精度限定字" class="sidebar-link">精度限定字</a></li><li class="sidebar-sub-header"><a href="/note/graphics/OpenGLES着色器语言.html#预处理指令" class="sidebar-link">预处理指令</a></li></ul></li><li><a href="/note/graphics/threejs基础.html" class="sidebar-link">threejs基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#例子-渲染三角形" class="sidebar-link">例子-渲染三角形</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#世界坐标系到观察者坐标系" class="sidebar-link">世界坐标系到观察者坐标系</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#视图矩阵" class="sidebar-link">视图矩阵</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#投影矩阵" class="sidebar-link">投影矩阵</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#透视投影" class="sidebar-link">透视投影</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#正交投影" class="sidebar-link">正交投影</a></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#正交相机" class="sidebar-link">正交相机</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/graphics/threejs基础.html#shadow" class="sidebar-link">shadow</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webgl-基础"><a href="#webgl-基础" class="header-anchor">#</a> webGL 基础</h2> <h3 id="webgl-程序的结构"><a href="#webgl-程序的结构" class="header-anchor">#</a> webGL 程序的结构</h3> <p>在 HTML 中，动态网页包含 HTML 和 JavaScript 两种语言，引入 webgl 后，还需要加入着色器语言 GLSL ES。
<img src="/note/assets/img/webglchengxujiegou.0b1b0e27.png" alt="avatar"></p> <p>我们是通过对 GPU 进行编程，进行渲染图形：对于 GPU 编程主要从下面两个方面进行编程：</p> <ul><li>webgl：API glTranslate/glRotatef</li> <li>GLSL：顶点着色器 - gl_Position 和 片元着色器 - gl_FragColor</li></ul> <h3 id="webgl-渲染管线"><a href="#webgl-渲染管线" class="header-anchor">#</a> webgl 渲染管线</h3> <p>JavaScript 通过显存的 Buffer 来实现顶点着色器与片元着色器的数据传递。
<img src="/note/assets/img/webglxuanran.e524ef1a.png" alt="avatar"></p> <p>frame Buffer 是帧缓冲区，保存顶点着色器与片元着色器渲染后的结果，可以进行进一步的操作。</p> <h3 id="渲染过程"><a href="#渲染过程" class="header-anchor">#</a> 渲染过程</h3> <p>首先运行 JavaScript 程序,调用 webgl 的相关 方法，然后顶点着色器和片元着色器就会指向，在颜色缓冲区内进行绘制，这时就清空了绘图区，最后，颜色缓冲区的内容会自动在浏览器的 canvas 上显示出来。
<img src="/note/assets/img/xuanranbook.80b4b712.png" alt="avatar"></p> <p><img src="/note/assets/img/weglxuanranguocheng.35a20b95.png" alt="avatar"></p> <ol><li>传入坐标</li> <li>计算显示坐标</li> <li>图元装备（根据坐标，组成图形）</li> <li>将装备好的图元变成像素的形式；（顶点着色器）</li> <li>片元着色器对每一个像素点进行渲染</li></ol> <p>顶点着色器的作用：将逻辑上的传入的顶点坐标，根据空间上的变换，进行计算屏幕上展示点的坐标。</p> <h3 id="glsl"><a href="#glsl" class="header-anchor">#</a> GLSL</h3> <ul><li>OpenGL 着色器语言</li> <li>让开发者可以对渲染过程拥有更多的控制</li></ul> <p><img src="/note/assets/img/glsl.f99a1d4f.png" alt="avatar"></p> <blockquote><p>GLSL 参考：https://colin1994.github.io/2017/11/11/OpenGLES-Lesson04/</p></blockquote> <h4 id="存储限定符"><a href="#存储限定符" class="header-anchor">#</a> 存储限定符</h4> <p>对于着色器语言，具有三种数据类型：</p> <ul><li>attribute：只能在 vertex shader 中使用的变量，一般用于传递顶点数据；</li> <li>uniform：常量，不能被 shader 修改，uniform 变量在 vertex 和 fragment 两者之间声明方式完全一致，则他可以在 vertex 和 fragment 共享使用，相当于一个被 vertex 和 fragment shader 共享的全局变量。</li> <li>varying：varying 变量是vertex 和 fragment shader 之间做数据传递用的。</li></ul> <p>如下代码，声明一个背景色为红色的三角形：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>var VSHADER_SOURCE, FSHADER_SOURCE

VSHADER_SOURCE <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;<span class="token entity" title="\n">\n</span>'</span> + 
  <span class="token string">'uniform mat4 u_ModelMatrix;<span class="token entity" title="\n">\n</span>'</span> +
  <span class="token string">'uniform mat4 u_ViewMatrix;<span class="token entity" title="\n">\n</span>'</span> +
  <span class="token string">'uniform mat4 u_ProjectionMatrix;<span class="token entity" title="\n">\n</span>'</span> + 
  <span class="token string">'void main () {<span class="token entity" title="\n">\n</span>'</span> + 
    <span class="token string">'gl_Position = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * a_Position;<span class="token entity" title="\n">\n</span>'</span> + 
  <span class="token string">'}<span class="token entity" title="\n">\n</span>'</span>

FSHADER_SOURCE <span class="token operator">=</span>
  <span class="token string">'void main () {<span class="token entity" title="\n">\n</span>'</span> + 
    <span class="token string">'gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);<span class="token entity" title="\n">\n</span>'</span> + 
  <span class="token string">'}<span class="token entity" title="\n">\n</span>'</span>

</code></pre></div><p>也可以直接写在页面 script 标签中：</p> <div class="language-html extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notjs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>vertex-shader<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      # 传入坐标 vec4 是代表一个 <span class="token number">4</span>x4 的浮点型矩阵
      attribute vec4 a_Position<span class="token punctuation">;</span>

      uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
      uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
      uniform mat4 u_ProjectionMatrix<span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        # 顶点位置<span class="token operator">-</span>webgl 内置 <span class="token constant">API</span>
        gl_Position <span class="token operator">=</span> u_ProjectionMatrix <span class="token operator">*</span> u_ViewMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notjs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fragment-shader<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        # 设置背景色
        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
</code></pre></div><p>然后通过 dom 操作获取内容：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vertex-shader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
  <span class="token keyword">const</span> fragShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fragment-shader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre></div><h4 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h4> <ul><li>精度限定
使用精度限定词来指定变量的范围（最大值和最小值）和精度，下面代码表示中等精度：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>precision mediump float<span class="token punctuation">;</span>
</code></pre></div><h3 id="webgl-坐标系统"><a href="#webgl-坐标系统" class="header-anchor">#</a> webgl 坐标系统</h3> <p>遵循右手法则：</p> <p><img src="/note/assets/img/webglzuobiaoxi.42c3012f.png" alt="avatar"> <img src="/note/assets/img/youshouzuobiaoxi.4d5d9c3b.png" alt="avatar"></p> <h3 id="webgl-机制-缓冲区对象（buffer-object）"><a href="#webgl-机制-缓冲区对象（buffer-object）" class="header-anchor">#</a> webgl 机制 —— 缓冲区对象（buffer object）</h3> <p>我们绘制一个点的时候是不需要用到缓冲区对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器程序</span>
<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> 
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span> <span class="token comment">// Set the vertex coordinates of the point</span>
  <span class="token string">'  gl_PointSize = 10.0;\n'</span> <span class="token operator">+</span>                    <span class="token comment">// Set the point size</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token comment">// 片元着色器程序</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span> <span class="token comment">// Set the point color</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取 canvas 元素</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取 WebGL 绘图上下文</span>
  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the rendering context for WebGL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建 shader 对象</span>
  <span class="token keyword">function</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create shader object</span>
    <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unable to create shader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Set the shader program</span>
    gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Compile the shader</span>
    gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check the result of compilation</span>
    <span class="token keyword">var</span> compiled <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>compiled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> error <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to compile shader: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建程序</span>
  <span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vshader<span class="token punctuation">,</span> fshader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create shader object</span>
    <span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vshader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fshader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexShader <span class="token operator">||</span> <span class="token operator">!</span>fragmentShader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create a program object</span>
    <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>program<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Attach the shader objects</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Link the program object</span>
    gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check the result of linking</span>
    <span class="token keyword">var</span> linked <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>linked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> error <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to link program: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> program<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 初始化着色器方法</span>
  <span class="token keyword">function</span> <span class="token function">initShaders</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vshader<span class="token punctuation">,</span> fshader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vshader<span class="token punctuation">,</span> fshader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>program<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create program'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span>program <span class="token operator">=</span> program<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 初始化着色器</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize shaders.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置 canvas 的背景色</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 清空 canvas</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 绘制一个点</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>我们只需要一个 gl.drawArrays(gl.POINTS, 0, 1) 进行每次绘制一个点，但是如果我们需要绘制多个点，就需要用到缓冲区对象，他可以一次性向着色器传入多个顶点的数据，缓冲区对象是 webgl 系统中的一块内存区域，我们可以一次性地向缓冲区对象中填充大量的顶点数据，然后将这些数据保存在其中，供顶点着色器使用。</p> <p>下面代码是绘制一个三角形并增加旋转动画：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span>
<span class="token comment">// 获取 webgl 绘图上下文</span>
<span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span>
<span class="token comment">// 一个程序，可以绑定顶点着色器跟片源着色器</span>
<span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span>
<span class="token comment">// 顶点着色器程序</span>
<span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span> 
  <span class="token string">'uniform mat4 u_ModelMatrix;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform mat4 u_ViewMatrix;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform mat4 u_ProjectionMatrix;\n'</span> <span class="token operator">+</span> 
  <span class="token string">'void main () {\n'</span> <span class="token operator">+</span> 
    <span class="token string">'gl_Position = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * a_Position;\n'</span> <span class="token operator">+</span> 
  <span class="token string">'}\n'</span>
<span class="token comment">// 片元着色器程序</span>
<span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'void main () {\n'</span> <span class="token operator">+</span> 
    <span class="token string">'gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span> 
  <span class="token string">'}\n'</span>

<span class="token keyword">var</span> vertexShader<span class="token punctuation">,</span> fragmentShader

<span class="token keyword">function</span> <span class="token function">createShader</span> <span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> sourceCode<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// create shader</span>
  <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> sourceCode<span class="token punctuation">)</span>
  <span class="token comment">// 编译 shader</span>
  gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
  <span class="token keyword">return</span> shader
<span class="token punctuation">}</span>

<span class="token comment">// 定义顶点着色器</span>
vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">)</span>
<span class="token comment">// 定义片段着色器</span>
fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">)</span>

<span class="token comment">// 和 shader 绑定</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span>

<span class="token comment">// 连接 program</span>
gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
gl<span class="token punctuation">.</span>program <span class="token operator">=</span> program

<span class="token keyword">var</span> currentAngle <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">var</span> g_last <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// update the new rotation angle</span>
  <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// draw</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span> <span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义顶点</span>
  <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// 点的个数</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 将缓冲区对象绑定到目标</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span>
  <span class="token comment">// 向缓冲区对象中写入数据</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token comment">// 在顶点着色器中获取 a_Position 的地址；gl.program 为包含顶点着色器和片元着色器的着色器程序对象</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span>
  <span class="token comment">// 将缓冲区对象分配给 a_Position 变量</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token comment">// 连接 a_Position 变量与分配给他的缓冲区对象</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>
  <span class="token keyword">return</span> n
<span class="token punctuation">}</span>

<span class="token comment">// 将顶点的位置写入顶点着色器</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
<span class="token comment">// 指定清空 canvas 的颜色</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_ModelMatrix'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viewMatrix<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> u_ProjectionMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_ProjectionMatrix'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> projectionMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// projectionMatrix.perspective(120, 1, 0.1, 1000)</span>
projectionMatrix<span class="token punctuation">.</span><span class="token function">ortho</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">animate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> duration <span class="token operator">=</span> now <span class="token operator">-</span> g_last
  g_last <span class="token operator">=</span> now
  currentAngle <span class="token operator">=</span> currentAngle <span class="token operator">+</span> duration <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">180</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">draw</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// clear canvas and add background color</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span>currentAngle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ProjectionMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> projectionMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span>
  <span class="token comment">// 清空 canvas，清空区域，实际上是在清空颜色缓冲区（color buffer）</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
  <span class="token comment">// 第一个参数为绘制的类型，第二个参数是指定从哪个顶点开始绘制（整数型），第三个参数是指定绘制需要用到多少个顶点（整数型）</span>
  <span class="token comment">// 当程序调用 l.drawArrays 方法时，顶点着色器将被执行 n 次，每次处理一个顶点。执行顶点着色器代码中的 main 函数。</span>
  <span class="token comment">// 一旦顶点着色器执行完之后,片元着色器开始执行。</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>渲染流程如下：</p> <p><img src="/note/assets/img/duodianxuanrean.c5b2ab0d.png" alt="avatar"></p> <p>使用缓冲区对象向顶点着色器传入多个顶点的数据，需要遵循下面五个步骤：</p> <ol><li>创建缓冲区对象(gl.createBuffer())</li> <li>绑定缓冲区对象(gl.bindBuffer())</li> <li>将数据写入缓冲区对象(gl.bufferData())</li> <li>将缓冲区对象分配给一个 attribute 变量(gl.vertexAttributPointer())</li> <li>开启 attribute 变量(gl.enableVertexAttribArray())</li></ol> <p>对应代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initVertexBuffers</span> <span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义顶点</span>
  <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// 点的个数</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token comment">// 创建缓冲区对象</span>
  <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 将缓冲区对象绑定到目标</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span>
  <span class="token comment">// 向缓冲区对象中写入数据</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token comment">// 在顶点着色器中获取 a_Position 的地址；gl.program 为包含顶点着色器和片元着色器的着色器程序对象</span>
  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span>
  <span class="token comment">// 将缓冲区对象分配给 a_Position 变量</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token comment">// 连接 a_Position 变量与分配给他的缓冲区对象</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>
  <span class="token keyword">return</span> n
<span class="token punctuation">}</span>
</code></pre></div><ul><li>创建缓冲区对象：gl.createBuffer() 是创建缓冲区对象；gl.deleteBuffer() 函数用来删除 gl.createBuffer() 创建出来的缓冲区对象。</li> <li>绑定缓冲区：将缓冲区对象绑定到 webgl 系统中已经存在的目标上。这个目标表示缓冲区对象的用途（在这里，就是向顶点着色器提供传给 attribute 变量的数据），这样 webgl 才能够正确处理其中的内容；</li></ul> <p><img src="/note/assets/img/bindbuffer.47cdd8c8.png" alt="avatar"></p> <ul><li><p>缓冲区中写入数据：gl.bufferData()，该方法时将第二个参数中的数据写入到第一个参数 gl.ARRAY.BUFFER 上的缓冲区对象。我们不能直接向缓冲区写入数据，而只能向目标写入数据，所以要向缓冲区写数据，必须要先绑定；
<img src="/note/assets/img/bufferData.0d01a3c6.png" alt="avatar"></p></li> <li><p>使用类型化数组 Float32Array：为了绘制三维图形，webgl 通常需要同时处理大量相同类型的数据，例如顶点的坐标和颜色数据。为了优化性能，webgl 为每种基本数据类型引入了一种特殊的数组（类型化数组）。浏览器事先知道数组中的数据类型，所以处理起来也更加有效率。Float32Array 与普通数组不同，类数组不支持 push() 和 pop() 方法。注意创建类型化数组的唯一方法就是使用 new 操作符。不能使用 [] 运算符，那样创建的就是普通数组。
下面是类型化数组的方法、属性以及常量：
<img src="/note/assets/img/leishuzuff.41d67f79.png" alt="avatar"></p></li> <li><p>将缓冲区对象分配给 attribute 变量：gl.vertexAttributPointer()，之前可以使用 gl.vertexAttrib[1, 2, 3, 4]f 系列函数为 attribute 变量分配至，但是这些方法一次只能向 attribute 变量分配一个值，gl.vertexAttributPointer() 可以将整个数组一次性分配给 attribute 变量。</p></li></ul> <p><img src="/note/assets/img/vertexAttributPointer.1caaa265.png" alt="avatar"></p> <ul><li><p>开启 attribute 变量：gl.enableVertexAttribArray()，为了使顶点着色器能够访问缓冲区内的数据，需要使用 gl.enableVertexAttribArray() 开启 attribute 变量。同样可以使用 gl.disableVertexAttribArray() 来关闭分配。开启了 attribute 变量后，就不能使用 gl.vertexAttrib[1, 2, 3, 4]f 向他传递数据了，除非显式地关闭该 attribute 变量。</p></li> <li><p>gl.drawArrays()：</p></li></ul> <p><img src="/note/assets/img/drawArrays.ef2e5238.png" alt="avatar"></p> <p>webgl 方法通过 gl.drawArrays() 的第一个参数指定不同的值，绘制不同的图形。下表的 v0，v1 等表示缓冲区
中的顶点，顶点的顺序将影响绘制的结果：
<img src="/note/assets/img/drawAraysparams.892ae927.png" alt="avatar"> <img src="/note/assets/img/xubiao.dd6c6c4a.png" alt="avatar"></p> <p>下面就是绘制这些基本的图形：</p> <p><img src="/note/assets/img/huizhidejibentux.8cd6fdc2.png" alt="avatar"></p> <ul><li>gl_PointSize 顶点着色器中设置点的大小，只有在绘制单个点的时候才起作用。</li></ul> <h3 id="移动、旋转、缩放"><a href="#移动、旋转、缩放" class="header-anchor">#</a> 移动、旋转、缩放</h3> <h4 id="移动"><a href="#移动" class="header-anchor">#</a> 移动</h4> <p>只需要传入坐标偏移量即可：
u_Translation 就是传入的偏移量，每次 a_Position 加上偏移量之后，就会移动图形</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform vec4 u_Translation;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position = a_Position + u_Translation;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token comment">// Fragment shader program</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Retrieve &lt;canvas&gt; element</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the rendering context for WebGL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize shaders.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to set the positions of the vertices'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 偏移量传值</span>
  <span class="token keyword">var</span> u_Translation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_Translation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u_Translation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of u_Translation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_Translation<span class="token punctuation">,</span> Tx<span class="token punctuation">,</span> Ty<span class="token punctuation">,</span> Tz<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="旋转"><a href="#旋转" class="header-anchor">#</a> 旋转</h4> <p>旋转必须要指明：</p> <ul><li>旋转轴：图形将围绕旋转轴旋转</li> <li>旋转方向：方向是顺时针还是逆时针</li> <li>旋转角度：图形旋转经过的角度</li></ul> <p>描述旋转：绕 Z 轴旋转了 β 角度，如果 β 是正值，那么看到的物体就是逆时针旋转的。这种情况又称为正旋转。正旋转又称为右手法则旋转。</p> <p><img src="/note/assets/img/xuanzhuanzuobiaoxi.f25dcb53.png" alt="avatar"></p> <p>设点 p(x, y, z) 旋转 β 角度后变成 p'(x', y', z')：首先旋转是绕 Z 轴信息的，所以 z 坐标不会变化，可以直接忽略；然后 x 坐标和 y 坐标如下：
<img src="/note/assets/img/xyzxuanzhuan.d195621a.png" alt="avatar"></p> <p>上图，r 是从圆点到点 p 的距离，而 α 是 X 轴旋转到 p 的角度，用这两个变量计算出点 p 的坐标，如下：</p> <ul><li>x = r cos α</li> <li>y = r sin α</li></ul> <p>类似地，可以使用 α 、r、β 来表示 p' 的坐标：</p> <ul><li>x' = r cos(α + β)</li> <li>y' = r sin(α + β)</li></ul> <p>利用三角函数两角和公示，可得：</p> <ul><li>x' = r (cos α cos β - sin α sin β))</li> <li>y' = r (sin α cos β + cos α sin β))</li></ul> <p>消除 r 和 α 后：</p> <ul><li>x' = x cosβ - y sinβ</li> <li>y' = x sinβ - y cosβ</li> <li>z' = z</li></ul> <p>我们可以将 sin β 和 cos β 的值传给顶点着色器，然后在着色器中根据上面的式子计算旋转后的点坐标，就可以实现旋转了。使用 JavaScript 内置的 Math 对象的 sin() 和 cos() 方法来进行三角函数运算。</p> <p>代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token comment">// x' = x cosβ - y sinβ</span>
  <span class="token comment">// y' = x sinβ + y cosβ　Equation 3.3</span>
  <span class="token comment">// z' = z</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'uniform float u_CosB, u_SinB;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position.x = a_Position.x * u_CosB - a_Position.y * u_SinB;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position.y = a_Position.x * u_SinB + a_Position.y * u_CosB;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position.z = a_Position.z;\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_Position.w = 1.0;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>
  <span class="token comment">// 旋转角度</span>
<span class="token keyword">var</span> <span class="token constant">ANGLE</span> <span class="token operator">=</span> <span class="token number">90.0</span><span class="token punctuation">;</span> 

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the rendering context for WebGL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize shaders.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to set the positions of the vertices'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将旋转图形所需的数据传递给顶点着色器</span>
  <span class="token keyword">var</span> radian <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token constant">ANGLE</span> <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span> <span class="token comment">// 转换为弧度制</span>
  <span class="token keyword">var</span> cosB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sinB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> u_CosB <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_CosB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> u_SinB <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_SinB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u_CosB <span class="token operator">||</span> <span class="token operator">!</span>u_SinB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of u_CosB or u_SinB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>u_CosB<span class="token punctuation">,</span> cosB<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>u_SinB<span class="token punctuation">,</span> sinB<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_Position <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="变换矩阵旋转"><a href="#变换矩阵旋转" class="header-anchor">#</a> 变换矩阵旋转</h4> <p>我们可以将上面的操作看成是矩阵计算得到的结果：</p> <p><img src="/note/assets/img/juzhenyunsuan.7138345a.png" alt="avatar">
上面的这个矩阵通常称为旋转矩阵。</p> <h4 id="变换矩阵平移"><a href="#变换矩阵平移" class="header-anchor">#</a> 变换矩阵平移</h4> <p>平移时需要加上一个常量，来表示偏移量，可以使用 4 × 4 的矩阵以及具有第四个分量的矢量来表示，假设 p 的坐标为(x, y, z, 1)，平移之后的 p' 的坐标为(x', y', z', 1)；如下：
<img src="/note/assets/img/juzhnepingyi.f8e315b6.png" alt="avatar"></p> <p>该矩阵的乘法结果如下：</p> <ul><li>x' = ax + by + cz + d</li> <li>y' = ex + fy + gz + h</li> <li>z' = ix + jy + kz + l</li> <li>1 = mx + ny + oz + p</li></ul> <p>根据最后一个式子就可以计算出系数 m = 0, n = 0, o = 0, p = 1, 这些方式都有常数项 d、h、l 和 p，我们跟之前做平移的等式进行比较：</p> <ul><li>x' = x + Tx</li> <li>y' = y + Ty</li> <li>z' = z + Tz</li></ul> <p>比较两个等式，姐可以知道 a = 1，b = 0，c = 0， d = Tx，e = 0，f = 1，g = 0，h = Ty，i = 0，j = 0，k = 1，l = Tz。这样就可以表示平移矩阵，如下：</p> <p><img src="/note/assets/img/pingyijuzhen.096b921f.png" alt="avatar"></p> <h4 id="使用变换矩阵实现旋转平移"><a href="#使用变换矩阵实现旋转平移" class="header-anchor">#</a> 使用变换矩阵实现旋转平移</h4> <p>如果我们使用最开始计算点坐标在进行旋转平移变化，每次都需要进行一次新的变换。每次重新取一个新的等式，然后实现一个新的着色器，很不科学，我们可以通过变换矩阵来完成。
上面我们获取到旋转的矩阵为 3 × 3 的矩形，但是平移矩阵是 4 × 4 的矩阵，阶数不同不能进行计算，可以处理一下旋转矩阵为  4 × 4 的。
<img src="/note/assets/img/chulixuanzhuanjuzhen.88215094.png" alt="avatar"></p> <p>实现代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'attribute vec4 a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token comment">// mat4 表示 4 × 4 的矩阵</span>
  <span class="token string">'uniform mat4 u_xformMatrix;\n'</span> <span class="token operator">+</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token comment">// 矩阵相乘</span>
  <span class="token string">'  gl_Position = u_xformMatrix * a_Position;\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
  <span class="token string">'void main() {\n'</span> <span class="token operator">+</span>
  <span class="token string">'  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n'</span> <span class="token operator">+</span>
  <span class="token string">'}\n'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">ANGLE</span> <span class="token operator">=</span> <span class="token number">90.0</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the rendering context for WebGL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to intialize shaders.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to set the positions of the vertices'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建旋转矩阵</span>
  <span class="token keyword">var</span> radian <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token constant">ANGLE</span> <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span> <span class="token comment">// 角度转换为弧度制</span>
  <span class="token keyword">var</span> cosB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">,</span> sinB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注意 webgl 中矩阵是列主序的</span>
  <span class="token keyword">var</span> xformMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
     cosB<span class="token punctuation">,</span> sinB<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>sinB<span class="token punctuation">,</span> cosB<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 将旋转矩阵传输给顶点着色器</span>
  <span class="token keyword">var</span> u_xformMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_xformMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u_xformMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of u_xformMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将矩阵传递给着色器 v 表示可以向着色器传输多个数据值</span>
  <span class="token comment">// 第一个参数为 uniform 变量的存储位置，第二个参数在 webgl 中必须指定 false，第三个参数是待传输的类型化数组，4 × 4 矩阵按列主序存储在其中 </span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_xformMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> xformMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vertexBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to create the buffer object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a_Position <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get the storage location of a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意这里的矩阵表示法，数组为一维的，其元素排成一行，我们可以按照两种方式在数组中存储矩阵元素：按行主序和按列主序，如图：</p> <p><img src="/note/assets/img/zhuxutu.e169cb4a.png" alt="avatar"></p> <p>webgl 跟 opengl 一样，矩阵元素是按列主组存储在数组中的。</p> <h4 id="变换矩阵-缩放"><a href="#变换矩阵-缩放" class="header-anchor">#</a> 变换矩阵 - 缩放</h4> <p>假设 p 经过缩放操作变成了 p':</p> <p><img src="/note/assets/img/suofangtushi.9df39495.png" alt="avatar"></p> <p>假设在三个方向 X 轴，Y 轴，Z 轴的缩放因子 Sx，Sy，Sz 不相关，那么有：</p> <ul><li>x' = Sx × x</li> <li>y' = Sy × y</li> <li>z' = Sz × z</li></ul> <p>写成变换矩阵如下：</p> <p><img src="/note/assets/img/suofangjuzhen.af8d4f7b.png" alt="avatar"></p> <p>我们只需要修改前面代码的矩阵就可以实现缩放效果。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新:</span> <span class="time">9/28/2020, 5:58:25 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/graphics/数学基础.html" class="prev">
        数学基础
      </a></span> <span class="next"><a href="/note/graphics/webgl高级变换与动画基础.html">
        webgl高级变换与动画基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/note/assets/js/app.f3710e1e.js" defer></script><script src="/note/assets/js/2.a05a71ea.js" defer></script><script src="/note/assets/js/4.a297dc64.js" defer></script>
  </body>
</html>
